<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>百里长风</title>
  
  <subtitle>尚未执佩剑，转眼即江湖</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://xincan.github.io/"/>
  <updated>2020-07-30T04:25:37.904Z</updated>
  <id>https://xincan.github.io/</id>
  
  <author>
    <name>xincan</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Docker常用命令</title>
    <link href="https://xincan.github.io/posts/29dc6fe8/"/>
    <id>https://xincan.github.io/posts/29dc6fe8/</id>
    <published>2020-07-08T11:32:00.000Z</published>
    <updated>2020-07-30T04:25:37.904Z</updated>
    
    <content type="html"><![CDATA[<h3 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h3><p>准备一台带docker的虚拟机，请参照<a href="https://xincan.github.io/posts/cd183338/">centos构建docker基础环境</a></p><a id="more"></a><h4 id="一、-docker-swarm相关命令"><a href="#一、-docker-swarm相关命令" class="headerlink" title="一、 docker swarm相关命令"></a>一、 docker swarm相关命令</h4><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 初始化集群主节点</span></span></span><br><span class="line">docker swarm init</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 子节点加入集群中</span></span></span><br><span class="line">docker swarm join --token SWMTKN-1-4lzr2216s61ecbyayyqynjwybmxy5y5th5ru8aal2a0d1t2vn3-ekdgf4swlz8fiq4nnzgnbhr5u 192.168.1.10:2377</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 退出集群</span></span></span><br><span class="line">docker swarm leave</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 强制退出集群</span></span></span><br><span class="line">docker swarm leave --force</span><br></pre></td></tr></table></figure><h4 id="一、-docker-node相关命令"><a href="#一、-docker-node相关命令" class="headerlink" title="一、 docker node相关命令"></a>一、 docker node相关命令</h4><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 查看集群节点信息</span></span></span><br><span class="line">docker node ls</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 升级工作节点为管理节点</span></span></span><br><span class="line">docker node promote node1.draas.hatech.com.cn</span><br><span class="line">docker node promote node2.draas.hatech.com.cn</span><br></pre></td></tr></table></figure><h4 id="一、-docker-network相关命令"><a href="#一、-docker-network相关命令" class="headerlink" title="一、 docker network相关命令"></a>一、 docker network相关命令</h4><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 查看网络列表</span></span></span><br><span class="line">docker network ls</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 自定义overlay网络</span></span></span><br><span class="line">docker network create -d overlay my-overlay</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;环境准备&quot;&gt;&lt;a href=&quot;#环境准备&quot; class=&quot;headerlink&quot; title=&quot;环境准备&quot;&gt;&lt;/a&gt;环境准备&lt;/h3&gt;&lt;p&gt;准备一台带docker的虚拟机，请参照&lt;a href=&quot;https://xincan.github.io/posts/cd183338/&quot;&gt;centos构建docker基础环境&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="系统教程" scheme="https://xincan.github.io/categories/%E7%B3%BB%E7%BB%9F%E6%95%99%E7%A8%8B/"/>
    
      <category term="环境构建" scheme="https://xincan.github.io/categories/%E7%B3%BB%E7%BB%9F%E6%95%99%E7%A8%8B/%E7%8E%AF%E5%A2%83%E6%9E%84%E5%BB%BA/"/>
    
      <category term="开发教程" scheme="https://xincan.github.io/categories/%E7%B3%BB%E7%BB%9F%E6%95%99%E7%A8%8B/%E7%8E%AF%E5%A2%83%E6%9E%84%E5%BB%BA/%E5%BC%80%E5%8F%91%E6%95%99%E7%A8%8B/"/>
    
    
      <category term="开发教程" scheme="https://xincan.github.io/tags/%E5%BC%80%E5%8F%91%E6%95%99%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>centos+K8S群集监控环境构建</title>
    <link href="https://xincan.github.io/posts/2aa23666/"/>
    <id>https://xincan.github.io/posts/2aa23666/</id>
    <published>2020-06-16T01:15:25.000Z</published>
    <updated>2020-07-17T01:13:42.135Z</updated>
    
    <content type="html"><![CDATA[<h3 id="虚拟机配置"><a href="#虚拟机配置" class="headerlink" title="虚拟机配置"></a>虚拟机配置</h3><p>准备三台虚拟机，每台虚机请参照<a href="http://xincan.github.io/posts/d05af695/">centos基础环境构建</a>、<a href="http://xincan.github.io/posts/cd183338/">centos构建docker基础环境</a>进行安装构建</p><a id="more"></a><h4 id="一、-三台虚拟机配置表"><a href="#一、-三台虚拟机配置表" class="headerlink" title="一、 三台虚拟机配置表"></a>一、 三台虚拟机配置表</h4><ol><li>服务器配置</li></ol><table><thead><tr><th align="center">服务器IP</th><th align="center">域名</th><th align="center">别名</th><th align="center">服务器类别</th><th align="center">登录用户</th><th align="center">登录密码</th><th align="center">CPU</th><th align="center">内存</th></tr></thead><tbody><tr><td align="center">192.168.1.55</td><td align="center">master55.xincan.cn</td><td align="center">master55</td><td align="center">master</td><td align="center">root</td><td align="center">v*****t</td><td align="center">4核</td><td align="center">4G</td></tr><tr><td align="center">192.168.1.56</td><td align="center">slave56.xincan.cn</td><td align="center">slave56</td><td align="center">slave</td><td align="center">root</td><td align="center">v*****t</td><td align="center">2核</td><td align="center">2G</td></tr><tr><td align="center">192.168.1.57</td><td align="center">slave57.xincan.cn</td><td align="center">slave57</td><td align="center">slave</td><td align="center">root</td><td align="center">v*****t</td><td align="center">2核</td><td align="center">2G</td></tr></tbody></table><ol start="2"><li>工具版本</li></ol><p>docker version: v19.03.11<br>Kubernetes version: v1.18.2</p><p>参考地址<a href="https://www.cnblogs.com/skyflask/p/11480988.html">kubernetes监控中级方案</a></p><h4 id="二、-修改虚机域名"><a href="#二、-修改虚机域名" class="headerlink" title="二、 修改虚机域名"></a>二、 修改虚机域名</h4><p>依次修改各个虚拟机域名为master55.xincan.cn、 slave56.xincan.cn、 slave57.xincan.cn</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// master55服务器</span><br><span class="line">[root@localhost ~]# vi /etc/hostname</span><br><span class="line">master55.xincan.cn</span><br><span class="line">[root@localhost ~]#</span><br><span class="line"></span><br><span class="line">// slave56服务器</span><br><span class="line">[root@localhost ~]# vi /etc/hostname</span><br><span class="line">slave56.xincan.cn</span><br><span class="line">[root@localhost ~]#</span><br><span class="line"></span><br><span class="line">// slave57服务器</span><br><span class="line">[root@localhost ~]#  vi /etc/hostname</span><br><span class="line">slave57.xincan.cn</span><br><span class="line">[root@localhost ~]#</span><br></pre></td></tr></table></figure><h4 id="三、-配置三台机器互相用域名、别名访问"><a href="#三、-配置三台机器互相用域名、别名访问" class="headerlink" title="三、 配置三台机器互相用域名、别名访问"></a>三、 配置三台机器互相用域名、别名访问</h4><p>修改/etc/hosts文件设置，3台服务器同时增加如下代码<br>192.168.1.55 master55.xincan.cn master55<br>192.168.1.56 slave56.xincan.cn slave56<br>192.168.1.57 slave57.xincan.cn slave57</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost /]# cat /etc/hosts</span><br><span class="line">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line"></span><br><span class="line">192.168.1.55 master55.xincan.cn master55</span><br><span class="line">192.168.1.56 slave56.xincan.cn slave56</span><br><span class="line">192.168.1.57 slave57.xincan.cn slave57</span><br><span class="line">[root@localhost /]#</span><br></pre></td></tr></table></figure><h4 id="四、-重启三台虚拟机，执行reboot"><a href="#四、-重启三台虚拟机，执行reboot" class="headerlink" title="四、 重启三台虚拟机，执行reboot"></a>四、 重启三台虚拟机，执行reboot</h4><p>分别链接3台服务器，由之前的localhost已经改成服务器别名</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> // master55</span><br><span class="line">[root@master55 ~]#</span><br><span class="line"></span><br><span class="line"> // master55</span><br><span class="line">[root@slave56 ~]#</span><br><span class="line"></span><br><span class="line"> // master55</span><br><span class="line">[root@slave57 ~]#</span><br></pre></td></tr></table></figure><h4 id="五、-三台服务器时间同步"><a href="#五、-三台服务器时间同步" class="headerlink" title="五、 三台服务器时间同步"></a>五、 三台服务器时间同步</h4><ol><li>3台服务器都安装ntp，提示<strong>Complete!</strong>则安装成功</li></ol><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# sudo yum install -y ntp</span><br><span class="line">Loaded plugins: fastestmirror</span><br><span class="line">Determining fastest mirrors</span><br><span class="line"> * base: mirrors.huaweicloud.com</span><br><span class="line"> * extras: mirrors.huaweicloud.com</span><br><span class="line"> * updates: mirrors.ustc.edu.cn</span><br><span class="line">base                                                                                                                          | 3.6 kB  00:00:00</span><br><span class="line">extras                                                                                                                        | 2.9 kB  00:00:00</span><br><span class="line">updates                                                                                                                       | 2.9 kB  00:00:00</span><br><span class="line">(1/4): base/7/x86_64/group_gz                                                                                                 | 153 kB  00:00:00</span><br><span class="line">(2/4): extras/7/x86_64/primary_db                                                                                             | 194 kB  00:00:00</span><br><span class="line">(3/4): updates/7/x86_64/primary_db                                                                                            | 2.1 MB  00:00:01</span><br><span class="line">(4/4): base/7/x86_64/primary_db                                                                                               | 6.1 MB  00:00:05</span><br><span class="line">Resolving Dependencies</span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Running transaction check</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package ntp.x86_64 0:4.2.6p5-29.el7.centos will be installed</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Processing Dependency: ntpdate = 4.2.6p5-29.el7.centos <span class="keyword">for</span> package: ntp-4.2.6p5-29.el7.centos.x86_64</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Processing Dependency: libopts.so.25()(64bit) <span class="keyword">for</span> package: ntp-4.2.6p5-29.el7.centos.x86_64</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Running transaction check</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package autogen-libopts.x86_64 0:5.18-5.el7 will be installed</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package ntpdate.x86_64 0:4.2.6p5-29.el7.centos will be installed</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Finished Dependency Resolution</span></span><br><span class="line"></span><br><span class="line">Dependencies Resolved</span><br><span class="line"></span><br><span class="line">=====================================================================================================================================================</span><br><span class="line"> Package                                Arch                          Version                                      Repository                   Size</span><br><span class="line">=====================================================================================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> ntp                                    x86_64                        4.2.6p5-29.el7.centos                        base                        548 k</span><br><span class="line">Installing for dependencies:</span><br><span class="line"> autogen-libopts                        x86_64                        5.18-5.el7                                   base                         66 k</span><br><span class="line"> ntpdate                                x86_64                        4.2.6p5-29.el7.centos                        base                         86 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">=====================================================================================================================================================</span><br><span class="line">Install  1 Package (+2 Dependent packages)</span><br><span class="line"></span><br><span class="line">Total download size: 701 k</span><br><span class="line">Installed size: 1.6 M</span><br><span class="line">Downloading packages:</span><br><span class="line">warning: /var/cache/yum/x86_64/7/base/packages/ntpdate-4.2.6p5-29.el7.centos.x86_64.rpm: Header V3 RSA/SHA256 Signature, key ID f4a80eb5: NOKEY- ETA</span><br><span class="line">Public key for ntpdate-4.2.6p5-29.el7.centos.x86_64.rpm is not installed</span><br><span class="line">(1/3): ntpdate-4.2.6p5-29.el7.centos.x86_64.rpm                                                                               |  86 kB  00:00:00</span><br><span class="line">(2/3): autogen-libopts-5.18-5.el7.x86_64.rpm                                                                                  |  66 kB  00:00:00</span><br><span class="line">(3/3): ntp-4.2.6p5-29.el7.centos.x86_64.rpm                                                                                   | 548 kB  00:00:00</span><br><span class="line">-----------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line">Total                                                                                                                956 kB/s | 701 kB  00:00:00</span><br><span class="line">Retrieving key from file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br><span class="line">Importing GPG key 0xF4A80EB5:</span><br><span class="line"> Userid     : "CentOS-7 Key (CentOS 7 Official Signing Key) &lt;security@centos.org&gt;"</span><br><span class="line"> Fingerprint: 6341 ab27 53d7 8a78 a7c2 7bb1 24c6 a8a7 f4a8 0eb5</span><br><span class="line"> Package    : centos-release-7-6.1810.2.el7.centos.x86_64 (@anaconda)</span><br><span class="line"> From       : /etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br><span class="line">Running transaction check</span><br><span class="line">Running transaction test</span><br><span class="line">Transaction test succeeded</span><br><span class="line">Running transaction</span><br><span class="line">  Installing : autogen-libopts-5.18-5.el7.x86_64                                                                                                 1/3</span><br><span class="line">  Installing : ntpdate-4.2.6p5-29.el7.centos.x86_64                                                                                              2/3</span><br><span class="line">  Installing : ntp-4.2.6p5-29.el7.centos.x86_64                                                                                                  3/3</span><br><span class="line">  Verifying  : ntp-4.2.6p5-29.el7.centos.x86_64                                                                                                  1/3</span><br><span class="line">  Verifying  : ntpdate-4.2.6p5-29.el7.centos.x86_64                                                                                              2/3</span><br><span class="line">  Verifying  : autogen-libopts-5.18-5.el7.x86_64                                                                                                 3/3</span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  ntp.x86_64 0:4.2.6p5-29.el7.centos</span><br><span class="line"></span><br><span class="line">Dependency Installed:</span><br><span class="line">  autogen-libopts.x86_64 0:5.18-5.el7                                     ntpdate.x86_64 0:4.2.6p5-29.el7.centos</span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line">[root@localhost ~]#</span><br></pre></td></tr></table></figure><ol start="2"><li>3台服务器同时设置，查看当前系统时间、并设置当前时间为上海</li></ol><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost /]# date</span><br><span class="line">Thu Jun  4 05:28:48 UTC 2020</span><br><span class="line">[root@localhost /]# ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span><br><span class="line">[root@localhost /]# date</span><br><span class="line">Thu Jun  4 13:29:01 CST 2020</span><br><span class="line">[root@localhost /]#</span><br></pre></td></tr></table></figure><ol start="3"><li>master55配置<strong>server ntp.aliyun.com iburst</strong>，然后通过<strong>sudo systemctl start ntpd</strong>启动服务，稍等一会执行<strong>ntpq -p</strong>查看是否同步，如果出现前面的*则，同步成功</li></ol><p>systemctl start ntpd            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;启动ntp<br>systemctl restart ntpd          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;重启ntp<br>systemctl enable ntpd.service   &nbsp;&nbsp;开机启动<br>ntpdc -c loopinfo               &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;查看与时间同步服务器的时间差</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@master55 /]# vi /etc/ntp.conf</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> server 0.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> server 1.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> server 2.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> server 3.centos.pool.ntp.org iburst</span></span><br><span class="line"></span><br><span class="line">server ntp.aliyun.com iburst</span><br><span class="line"></span><br><span class="line">[root@master55 /]#</span><br><span class="line">[root@master55 /]# sudo systemctl start ntpd</span><br><span class="line">[root@master55 /]# systemctl enable ntpd.service</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/ntpd.service to /usr/lib/systemd/system/ntpd.service.</span><br><span class="line">[root@localhost /]# ntpq -p</span><br><span class="line">     remote           refid      st t when poll reach   delay   offset  jitter</span><br><span class="line">==============================================================================</span><br><span class="line">*203.107.6.88    10.137.38.86     2 u   37   64    1   53.476   -5.668   2.224</span><br><span class="line">[root@master55 /]#</span><br></pre></td></tr></table></figure><ol start="4"><li>slave56、slave57配置master55域名地址<strong>server master55.xincan.cn iburst</strong>，然后通过<strong>sudo systemctl start ntpd</strong>启动服务，稍等一会执行<strong>ntpq -p</strong>查看是否同步，如果出现前面的*则，同步成功</li></ol><p>slave56设置</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@slave56 /]# vi /etc/ntp.conf</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> server 0.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> server 1.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> server 2.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> server 3.centos.pool.ntp.org iburst</span></span><br><span class="line"></span><br><span class="line">server master55.xincan.cn iburst</span><br><span class="line"></span><br><span class="line">[root@slave56 /]#</span><br><span class="line">[root@slave56 /]# sudo systemctl start ntpd</span><br><span class="line">[root@slave56 /]# systemctl enable ntpd.service</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/ntpd.service to /usr/lib/systemd/system/ntpd.service.</span><br><span class="line">[root@slave56 /]# ntpq -p</span><br><span class="line">     remote           refid      st t when poll reach   delay   offset  jitter</span><br><span class="line">==============================================================================</span><br><span class="line">*master55.xincan 203.107.6.88     3 u   12   64    1    0.367   10.659   0.054</span><br><span class="line">[root@slave56 /]#</span><br></pre></td></tr></table></figure><p>slave57设置</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@slave57 /]# vi /etc/ntp.conf</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> server 0.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> server 1.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> server 2.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> server 3.centos.pool.ntp.org iburst</span></span><br><span class="line"></span><br><span class="line">server master55.xincan.cn iburst</span><br><span class="line"></span><br><span class="line">[root@slave57 /]#</span><br><span class="line">[root@slave57 /]# sudo systemctl start ntpd</span><br><span class="line">[root@slave57 /]# systemctl enable ntpd.service</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/ntpd.service to /usr/lib/systemd/system/ntpd.service.</span><br><span class="line">[root@slave57 /]# ntpq -p</span><br><span class="line">     remote           refid      st t when poll reach   delay   offset  jitter</span><br><span class="line">==============================================================================</span><br><span class="line">*master55.xincan 203.107.6.88     3 u   12   64    1    0.367   10.659   0.054</span><br><span class="line">[root@slave57 /]#</span><br></pre></td></tr></table></figure><h4 id="六、-三台服务器同时配置kubernetes网桥"><a href="#六、-三台服务器同时配置kubernetes网桥" class="headerlink" title="六、 三台服务器同时配置kubernetes网桥"></a>六、 三台服务器同时配置kubernetes网桥</h4><p>设置网桥为值为1</p><ol><li>master55设置</li></ol><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[root@master55 /]# sudo bash -c 'cat &lt;&lt;EOF &gt;  /etc/sysctl.d/k8s.conf</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="line">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="line">net.ipv4.ip_forward=1</span><br><span class="line">EOF'</span><br><span class="line"></span><br><span class="line">[root@master55 /]#</span><br><span class="line">[root@master55 /]# sysctl --system</span><br><span class="line">* Applying /usr/lib/sysctl.d/00-system.conf ...</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 0</span><br><span class="line">net.bridge.bridge-nf-call-iptables = 0</span><br><span class="line">net.bridge.bridge-nf-call-arptables = 0</span><br><span class="line">* Applying /usr/lib/sysctl.d/10-default-yama-scope.conf ...</span><br><span class="line">kernel.yama.ptrace_scope = 0</span><br><span class="line">* Applying /usr/lib/sysctl.d/50-default.conf ...</span><br><span class="line">kernel.sysrq = 16</span><br><span class="line">kernel.core_uses_pid = 1</span><br><span class="line">net.ipv4.conf.default.rp_filter = 1</span><br><span class="line">net.ipv4.conf.all.rp_filter = 1</span><br><span class="line">net.ipv4.conf.default.accept_source_route = 0</span><br><span class="line">net.ipv4.conf.all.accept_source_route = 0</span><br><span class="line">net.ipv4.conf.default.promote_secondaries = 1</span><br><span class="line">net.ipv4.conf.all.promote_secondaries = 1</span><br><span class="line">fs.protected_hardlinks = 1</span><br><span class="line">fs.protected_symlinks = 1</span><br><span class="line">* Applying /etc/sysctl.d/99-sysctl.conf ...</span><br><span class="line">* Applying /etc/sysctl.d/k8s.conf ...</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="line">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="line">net.ipv4.ip_forward = 1</span><br><span class="line">* Applying /etc/sysctl.conf ...</span><br><span class="line">[root@master55 /]#</span><br></pre></td></tr></table></figure><ol start="2"><li>slave56设置</li></ol><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[root@slave56 /]# sudo bash -c 'cat &lt;&lt;EOF &gt;  /etc/sysctl.d/k8s.conf</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="line">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="line">net.ipv4.ip_forward=1</span><br><span class="line">EOF'</span><br><span class="line"></span><br><span class="line">[root@slave56 /]#</span><br><span class="line">[root@slave56 /]# sysctl --system</span><br><span class="line">* Applying /usr/lib/sysctl.d/00-system.conf ...</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 0</span><br><span class="line">net.bridge.bridge-nf-call-iptables = 0</span><br><span class="line">net.bridge.bridge-nf-call-arptables = 0</span><br><span class="line">* Applying /usr/lib/sysctl.d/10-default-yama-scope.conf ...</span><br><span class="line">kernel.yama.ptrace_scope = 0</span><br><span class="line">* Applying /usr/lib/sysctl.d/50-default.conf ...</span><br><span class="line">kernel.sysrq = 16</span><br><span class="line">kernel.core_uses_pid = 1</span><br><span class="line">net.ipv4.conf.default.rp_filter = 1</span><br><span class="line">net.ipv4.conf.all.rp_filter = 1</span><br><span class="line">net.ipv4.conf.default.accept_source_route = 0</span><br><span class="line">net.ipv4.conf.all.accept_source_route = 0</span><br><span class="line">net.ipv4.conf.default.promote_secondaries = 1</span><br><span class="line">net.ipv4.conf.all.promote_secondaries = 1</span><br><span class="line">fs.protected_hardlinks = 1</span><br><span class="line">fs.protected_symlinks = 1</span><br><span class="line">* Applying /etc/sysctl.d/99-sysctl.conf ...</span><br><span class="line">* Applying /etc/sysctl.d/k8s.conf ...</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="line">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="line">net.ipv4.ip_forward = 1</span><br><span class="line">* Applying /etc/sysctl.conf ...</span><br><span class="line">[root@slave56 /]#</span><br></pre></td></tr></table></figure><ol start="3"><li>slave57设置</li></ol><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[root@slave57 /]# sudo bash -c 'cat &lt;&lt;EOF &gt;  /etc/sysctl.d/k8s.conf</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="line">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="line">net.ipv4.ip_forward=1</span><br><span class="line">EOF'</span><br><span class="line"></span><br><span class="line">[root@slave57 /]#</span><br><span class="line">[root@slave57 /]# sysctl --system</span><br><span class="line">* Applying /usr/lib/sysctl.d/00-system.conf ...</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 0</span><br><span class="line">net.bridge.bridge-nf-call-iptables = 0</span><br><span class="line">net.bridge.bridge-nf-call-arptables = 0</span><br><span class="line">* Applying /usr/lib/sysctl.d/10-default-yama-scope.conf ...</span><br><span class="line">kernel.yama.ptrace_scope = 0</span><br><span class="line">* Applying /usr/lib/sysctl.d/50-default.conf ...</span><br><span class="line">kernel.sysrq = 16</span><br><span class="line">kernel.core_uses_pid = 1</span><br><span class="line">net.ipv4.conf.default.rp_filter = 1</span><br><span class="line">net.ipv4.conf.all.rp_filter = 1</span><br><span class="line">net.ipv4.conf.default.accept_source_route = 0</span><br><span class="line">net.ipv4.conf.all.accept_source_route = 0</span><br><span class="line">net.ipv4.conf.default.promote_secondaries = 1</span><br><span class="line">net.ipv4.conf.all.promote_secondaries = 1</span><br><span class="line">fs.protected_hardlinks = 1</span><br><span class="line">fs.protected_symlinks = 1</span><br><span class="line">* Applying /etc/sysctl.d/99-sysctl.conf ...</span><br><span class="line">* Applying /etc/sysctl.d/k8s.conf ...</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="line">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="line">net.ipv4.ip_forward = 1</span><br><span class="line">* Applying /etc/sysctl.conf ...</span><br><span class="line">[root@slave57 /]#</span><br></pre></td></tr></table></figure><h4 id="七、-三台服务器同时配置kubernetes下载源，关闭SELinux"><a href="#七、-三台服务器同时配置kubernetes下载源，关闭SELinux" class="headerlink" title="七、 三台服务器同时配置kubernetes下载源，关闭SELinux"></a>七、 三台服务器同时配置kubernetes下载源，关闭SELinux</h4><ol><li>master55设置</li></ol><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@master55 /]# sudo bash -c 'cat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo</span><br><span class="line">[kubernetes]</span><br><span class="line">name=Kubernetes</span><br><span class="line">baseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">repo_gpgcheck=1</span><br><span class="line">gpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span><br><span class="line">EOF'</span><br><span class="line"></span><br><span class="line">[root@master55 /]#</span><br><span class="line">[root@master55 /]# sudo setenforce 0</span><br><span class="line">setenforce: SELinux is disabled</span><br><span class="line">[root@master55 /]#</span><br></pre></td></tr></table></figure><ol start="2"><li>slave56设置</li></ol><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@slave56 /]# sudo bash -c 'cat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo</span><br><span class="line">[kubernetes]</span><br><span class="line">name=Kubernetes</span><br><span class="line">baseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">repo_gpgcheck=1</span><br><span class="line">gpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span><br><span class="line">EOF'</span><br><span class="line"></span><br><span class="line">[root@slave56 /]#</span><br><span class="line">setenforce: SELinux is disabled</span><br><span class="line">[root@slave56 /]# sudo setenforce 0</span><br><span class="line">[root@slave56 /]#</span><br></pre></td></tr></table></figure><ol start="3"><li>slave57设置</li></ol><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@slave57 /]# sudo bash -c 'cat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo</span><br><span class="line">[kubernetes]</span><br><span class="line">name=Kubernetes</span><br><span class="line">baseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">repo_gpgcheck=1</span><br><span class="line">gpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span><br><span class="line">EOF'</span><br><span class="line"></span><br><span class="line">[root@slave57 /]#</span><br><span class="line">[root@slave57 /]# sudo setenforce 0</span><br><span class="line">setenforce: SELinux is disabled</span><br><span class="line">[root@slave57 /]#</span><br></pre></td></tr></table></figure><h4 id="八、-查看三台服务器下载源列表，如下成功"><a href="#八、-查看三台服务器下载源列表，如下成功" class="headerlink" title="八、 查看三台服务器下载源列表，如下成功"></a>八、 查看三台服务器下载源列表，如下成功</h4><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">drwxr-xr-x. 2 root root  187 Jun 16 13:05 backup</span><br><span class="line">-rw-r--r--. 1 root root 2523 Jun 16  2018 CentOS-Base.repo</span><br><span class="line">-rw-r--r--. 1 root root 2424 Oct 19  2019 docker-ce.repo</span><br><span class="line">-rw-r--r--. 1 root root  272 Jun 16 16:34 kubernetes.repo</span><br></pre></td></tr></table></figure><h4 id="九、-三台服务器设置免密登录"><a href="#九、-三台服务器设置免密登录" class="headerlink" title="九、 三台服务器设置免密登录"></a>九、 三台服务器设置免密登录</h4><p>1：manager节点执行：ssh-keygen -t rsa 一路回车到结束，在/root/.ssh/下面会生成一个公钥文件id_rsa.pub</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@master55 /]# ssh-keygen -t rsa</span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file in which to save the key (/root/.ssh/id_rsa):</span><br><span class="line">Created directory '/root/.ssh'.</span><br><span class="line">Enter passphrase (empty for no passphrase):</span><br><span class="line">Enter same passphrase again:</span><br><span class="line">Your identification has been saved in /root/.ssh/id_rsa.</span><br><span class="line">Your public key has been saved in /root/.ssh/id_rsa.pub.</span><br><span class="line">The key fingerprint is:</span><br><span class="line">SHA256:I0PR5fMj01uGGb1Z3pbRFjzwTIFb2ONyZ1M2I9OVTNY root@master55.xincan.cn</span><br><span class="line">The key's randomart image is:</span><br><span class="line">+---[RSA 2048]----+</span><br><span class="line">|      .. ..  .X**|</span><br><span class="line">|       ...   *=%E|</span><br><span class="line">|      .   o . B=X|</span><br><span class="line">|     .     + * X*|</span><br><span class="line">|      o S o * Bo*|</span><br><span class="line">|       o . o = . |</span><br><span class="line">|            .    |</span><br><span class="line">|                 |</span><br><span class="line">|                 |</span><br><span class="line">+----[SHA256]-----+</span><br><span class="line">[root@master55 /]#</span><br></pre></td></tr></table></figure><ol start="2"><li>将公钥追加到authorized_keys</li></ol><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@master55 /]# cat ~/.ssh/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys</span><br><span class="line">[root@master55 /]# cd ~/.ssh/</span><br><span class="line">[root@master55 .ssh]# ll</span><br><span class="line">total 12</span><br><span class="line">-rw-r--r-- 1 root root  405 Jun 16 17:03 authorized_keys</span><br><span class="line">-rw------- 1 root root 1675 Jun 16 17:01 id_rsa</span><br><span class="line">-rw-r--r-- 1 root root  405 Jun 16 17:01 id_rsa.pub</span><br><span class="line">[root@master55 .ssh]#</span><br></pre></td></tr></table></figure><ol start="3"><li>修改authorized_keys权限：</li></ol><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master55 /]# chmod 600 ~/.ssh/authorized_keys</span><br><span class="line">[root@master55 /]#</span><br></pre></td></tr></table></figure><ol start="4"><li>将~/.ssh从master55节点分发到slave56、slave57节点，执行：<br>scp -r ~/.ssh/ root@slave56:~/.ssh/<br>scp -r ~/.ssh/ root@slave57:~/.ssh/<br>过程中需要填写yes，然后提示输入slave56、slave57两个节点的登录密码</li></ol><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@master55 .ssh]# scp -r ~/.ssh/ root@slave56:~/.ssh/</span><br><span class="line">The authenticity of host 'slave56 (192.168.1.56)' can't be established.</span><br><span class="line">ECDSA key fingerprint is SHA256:KhL6Vyv6q5fHHcZ3+xoLn6W/mZ7SBAFD+n/TCXEHtSM.</span><br><span class="line">ECDSA key fingerprint is MD5:71:35:87:3d:ff:73:04:fc:d7:a2:07:30:68:b8:62:5b.</span><br><span class="line">Are you sure you want to continue connecting (yes/no)? yes</span><br><span class="line">Warning: Permanently added 'slave56,192.168.1.56' (ECDSA) to the list of known hosts.</span><br><span class="line">root@slave56's password:</span><br><span class="line">id_rsa                                                                                             100% 1675     1.1MB/s   00:00</span><br><span class="line">id_rsa.pub                                                                                         100%  405   282.4KB/s   00:00</span><br><span class="line">authorized_keys                                                                                    100%  405   277.0KB/s   00:00</span><br><span class="line">known_hosts                                                                                        100%  182   104.6KB/s   00:00</span><br><span class="line">[root@master55 .ssh]# scp -r ~/.ssh/ root@slave57:~/.ssh/</span><br><span class="line">The authenticity of host 'slave57 (192.168.1.57)' can't be established.</span><br><span class="line">ECDSA key fingerprint is SHA256:Gfz+xXR217Yb2ZWOIMsRzSe+iynRvpxLnt98cI4kBRA.</span><br><span class="line">ECDSA key fingerprint is MD5:8b:1d:cd:1d:24:79:de:80:c3:53:7c:d3:87:e0:d4:96.</span><br><span class="line">Are you sure you want to continue connecting (yes/no)? yes</span><br><span class="line">Warning: Permanently added 'slave57,192.168.1.57' (ECDSA) to the list of known hosts.</span><br><span class="line">root@slave57's password:</span><br><span class="line">id_rsa                                                                                             100% 1675     1.0MB/s   00:00</span><br><span class="line">id_rsa.pub                                                                                         100%  405   304.6KB/s   00:00</span><br><span class="line">authorized_keys                                                                                    100%  405   352.7KB/s   00:00</span><br><span class="line">known_hosts                                                                                        100%  364   271.2KB/s   00:00</span><br><span class="line">[root@master55 .ssh]#</span><br></pre></td></tr></table></figure><ol start="5"><li>验证master55、slave56、slave57三个节点免密登录<br>master55节点验证</li></ol><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@master55 /]# ssh root@slave56</span><br><span class="line">Last login: Tue Jun 16 15:11:10 2020 from 192.168.1.182</span><br><span class="line">[root@slave56 ~]# exit</span><br><span class="line">logout</span><br><span class="line">Connection to slave56 closed.</span><br><span class="line">[root@master55 /]# ssh root@slave57</span><br><span class="line">Last login: Tue Jun 16 15:11:23 2020 from 192.168.1.182</span><br><span class="line">[root@slave57 ~]# exit</span><br><span class="line">logout</span><br><span class="line">Connection to slave57 closed.</span><br><span class="line">[root@master55 /]#</span><br></pre></td></tr></table></figure><p>slave56节点验证,第一次链接需要输入目标服务密码，后续则不用</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[root@slave56 ~]# ssh root@master55</span><br><span class="line">The authenticity of host 'master55 (192.168.1.55)' can't be established.</span><br><span class="line">ECDSA key fingerprint is SHA256:Dv4+42UAUC3FCEqZjwxJECtUHMgAYUtD2UsRASyffFw.</span><br><span class="line">ECDSA key fingerprint is MD5:fe:0b:32:39:20:9c:e1:3e:67:b7:3d:42:a1:22:df:2a.</span><br><span class="line">Are you sure you want to continue connecting (yes/no)? yes</span><br><span class="line">Warning: Permanently added 'master55,192.168.1.55' (ECDSA) to the list of known hosts.</span><br><span class="line">Last login: Tue Jun 16 15:58:21 2020 from 192.168.1.182</span><br><span class="line">[root@master55 ~]# exit</span><br><span class="line">logout</span><br><span class="line">Connection to master55 closed.</span><br><span class="line">[root@slave56 ~]# ssh root@master55</span><br><span class="line">Last login: Tue Jun 16 17:17:38 2020 from 192.168.1.56</span><br><span class="line">[root@master55 ~]# exit</span><br><span class="line">logout</span><br><span class="line">Connection to master55 closed.</span><br><span class="line">[root@slave56 ~]# ssh root@slave57</span><br><span class="line">The authenticity of host 'slave57 (192.168.1.57)' can't be established.</span><br><span class="line">ECDSA key fingerprint is SHA256:Gfz+xXR217Yb2ZWOIMsRzSe+iynRvpxLnt98cI4kBRA.</span><br><span class="line">ECDSA key fingerprint is MD5:8b:1d:cd:1d:24:79:de:80:c3:53:7c:d3:87:e0:d4:96.</span><br><span class="line">Are you sure you want to continue connecting (yes/no)? yes</span><br><span class="line">Warning: Permanently added 'slave57,192.168.1.57' (ECDSA) to the list of known hosts.</span><br><span class="line">Last login: Tue Jun 16 17:15:27 2020 from 192.168.1.55</span><br><span class="line">[root@slave57 ~]# exit</span><br><span class="line">logout</span><br><span class="line">Connection to slave57 closed.</span><br><span class="line">[root@slave56 ~]# ssh root@slave57</span><br><span class="line">Last login: Tue Jun 16 17:17:59 2020 from 192.168.1.56</span><br><span class="line">[root@slave57 ~]# exit</span><br><span class="line">logout</span><br><span class="line">Connection to slave57 closed.</span><br><span class="line">[root@slave56 ~]#</span><br></pre></td></tr></table></figure><p>slave57节点验证,第一次链接需要输入目标服务密码，后续则不用</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@slave57 /]# ssh root@master55</span><br><span class="line">The authenticity of host 'master55 (192.168.1.55)' can't be established.</span><br><span class="line">ECDSA key fingerprint is SHA256:Dv4+42UAUC3FCEqZjwxJECtUHMgAYUtD2UsRASyffFw.</span><br><span class="line">ECDSA key fingerprint is MD5:fe:0b:32:39:20:9c:e1:3e:67:b7:3d:42:a1:22:df:2a.</span><br><span class="line">Are you sure you want to continue connecting (yes/no)? yes</span><br><span class="line">Warning: Permanently added 'master55,192.168.1.55' (ECDSA) to the list of known hosts.</span><br><span class="line">Last login: Tue Jun 16 17:17:42 2020 from 192.168.1.56</span><br><span class="line">[root@master55 ~]# exit</span><br><span class="line">logout</span><br><span class="line">Connection to master55 closed.</span><br><span class="line">[root@slave57 yum.repos.d]# ssh root@master55</span><br><span class="line">Last login: Tue Jun 16 17:19:31 2020 from 192.168.1.57</span><br><span class="line">[root@master55 ~]# exit</span><br><span class="line">logout</span><br><span class="line">Connection to master55 closed.</span><br><span class="line">[root@slave57 yum.repos.d]# ssh root@slave56</span><br><span class="line">Last login: Tue Jun 16 17:15:11 2020 from 192.168.1.55</span><br><span class="line">[root@slave56 ~]# exit</span><br><span class="line">logout</span><br><span class="line">Connection to slave56 closed.</span><br><span class="line">[root@slave57 /]#</span><br></pre></td></tr></table></figure><h4 id="十、-三台服务器同时安装kubelet-kubeadm-kubectl"><a href="#十、-三台服务器同时安装kubelet-kubeadm-kubectl" class="headerlink" title="十、 三台服务器同时安装kubelet kubeadm kubectl"></a>十、 三台服务器同时安装kubelet kubeadm kubectl</h4><p>安装完成之后，启动，并设置开机启动</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y kubelet-1.18.2 kubeadm-1.18.2 kubectl-1.18.2</span><br><span class="line">systemctl enable kubelet &amp;&amp; sudo systemctl start kubelet</span><br></pre></td></tr></table></figure><h4 id="十一、以master55为Kubernetes主节点进行Kubernetes初始化"><a href="#十一、以master55为Kubernetes主节点进行Kubernetes初始化" class="headerlink" title="十一、以master55为Kubernetes主节点进行Kubernetes初始化"></a>十一、以master55为Kubernetes主节点进行Kubernetes初始化</h4><ol><li>执行命令进行初始化<br>sudo kubeadm init &minus;&minus;image-repository registry.aliyuncs.com/google_containers &minus;&minus;kubernetes-version v1.18.2 &minus;&minus;apiserver-advertise-address 192.168.1.55 &minus;&minus;pod-network-cidr=10.244.0.0/16 &minus;&minus;token-ttl 0</li></ol><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">[root@master55 /]# sudo kubeadm init --image-repository registry.aliyuncs.com/google_containers --kubernetes-version v1.18.2 --apiserver-advertise-address 192.168.1.55 --pod-network-cidr=10.244.0.0/16 --token-ttl 0</span><br><span class="line">W0616 17:24:47.742105    8831 configset.go:202] WARNING: kubeadm cannot validate component configs for API groups [kubelet.config.k8s.io kubeproxy.config.k8s.io]</span><br><span class="line">[init] Using Kubernetes version: v1.18.2</span><br><span class="line">[preflight] Running pre-flight checks</span><br><span class="line">[preflight] Pulling images required for setting up a Kubernetes cluster</span><br><span class="line">[preflight] This might take a minute or two, depending on the speed of your internet connection</span><br><span class="line">[preflight] You can also perform this action in beforehand using 'kubeadm config images pull'</span><br><span class="line">[kubelet-start] Writing kubelet environment file with flags to file "/var/lib/kubelet/kubeadm-flags.env"</span><br><span class="line">[kubelet-start] Writing kubelet configuration to file "/var/lib/kubelet/config.yaml"</span><br><span class="line">[kubelet-start] Starting the kubelet</span><br><span class="line">[certs] Using certificateDir folder "/etc/kubernetes/pki"</span><br><span class="line">[certs] Generating "ca" certificate and key</span><br><span class="line">[certs] Generating "apiserver" certificate and key</span><br><span class="line">[certs] apiserver serving cert is signed for DNS names [master55.xincan.cn kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local] and IPs [10.96.0.1 192.168.1.55]</span><br><span class="line">[certs] Generating "apiserver-kubelet-client" certificate and key</span><br><span class="line">[certs] Generating "front-proxy-ca" certificate and key</span><br><span class="line">[certs] Generating "front-proxy-client" certificate and key</span><br><span class="line">[certs] Generating "etcd/ca" certificate and key</span><br><span class="line">[certs] Generating "etcd/server" certificate and key</span><br><span class="line">[certs] etcd/server serving cert is signed for DNS names [master55.xincan.cn localhost] and IPs [192.168.1.55 127.0.0.1 ::1]</span><br><span class="line">[certs] Generating "etcd/peer" certificate and key</span><br><span class="line">[certs] etcd/peer serving cert is signed for DNS names [master55.xincan.cn localhost] and IPs [192.168.1.55 127.0.0.1 ::1]</span><br><span class="line">[certs] Generating "etcd/healthcheck-client" certificate and key</span><br><span class="line">[certs] Generating "apiserver-etcd-client" certificate and key</span><br><span class="line">[certs] Generating "sa" key and public key</span><br><span class="line">[kubeconfig] Using kubeconfig folder "/etc/kubernetes"</span><br><span class="line">[kubeconfig] Writing "admin.conf" kubeconfig file</span><br><span class="line">[kubeconfig] Writing "kubelet.conf" kubeconfig file</span><br><span class="line">[kubeconfig] Writing "controller-manager.conf" kubeconfig file</span><br><span class="line">[kubeconfig] Writing "scheduler.conf" kubeconfig file</span><br><span class="line">[control-plane] Using manifest folder "/etc/kubernetes/manifests"</span><br><span class="line">[control-plane] Creating static Pod manifest for "kube-apiserver"</span><br><span class="line">[control-plane] Creating static Pod manifest for "kube-controller-manager"</span><br><span class="line">W0616 17:29:47.640484    8831 manifests.go:225] the default kube-apiserver authorization-mode is "Node,RBAC"; using "Node,RBAC"</span><br><span class="line">[control-plane] Creating static Pod manifest for "kube-scheduler"</span><br><span class="line">W0616 17:29:47.646613    8831 manifests.go:225] the default kube-apiserver authorization-mode is "Node,RBAC"; using "Node,RBAC"</span><br><span class="line">[etcd] Creating static Pod manifest for local etcd in "/etc/kubernetes/manifests"</span><br><span class="line">[wait-control-plane] Waiting for the kubelet to boot up the control plane as static Pods from directory "/etc/kubernetes/manifests". This can take up to 4m0s</span><br><span class="line">[apiclient] All control plane components are healthy after 31.505848 seconds</span><br><span class="line">[upload-config] Storing the configuration used in ConfigMap "kubeadm-config" in the "kube-system" Namespace</span><br><span class="line">[kubelet] Creating a ConfigMap "kubelet-config-1.18" in namespace kube-system with the configuration for the kubelets in the cluster</span><br><span class="line">[upload-certs] Skipping phase. Please see --upload-certs</span><br><span class="line">[mark-control-plane] Marking the node master55.xincan.cn as control-plane by adding the label "node-role.kubernetes.io/master=''"</span><br><span class="line">[mark-control-plane] Marking the node master55.xincan.cn as control-plane by adding the taints [node-role.kubernetes.io/master:NoSchedule]</span><br><span class="line">[bootstrap-token] Using token: 991hr9.scqkkyphn1cjjcl7</span><br><span class="line">[bootstrap-token] Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles</span><br><span class="line">[bootstrap-token] configured RBAC rules to allow Node Bootstrap tokens to get nodes</span><br><span class="line">[bootstrap-token] configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order for nodes to get long term certificate credentials</span><br><span class="line">[bootstrap-token] configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token</span><br><span class="line">[bootstrap-token] configured RBAC rules to allow certificate rotation for all node client certificates in the cluster</span><br><span class="line">[bootstrap-token] Creating the "cluster-info" ConfigMap in the "kube-public" namespace</span><br><span class="line">[kubelet-finalize] Updating "/etc/kubernetes/kubelet.conf" to point to a rotatable kubelet client certificate and key</span><br><span class="line">[addons] Applied essential addon: CoreDNS</span><br><span class="line">[addons] Applied essential addon: kube-proxy</span><br><span class="line"></span><br><span class="line">Your Kubernetes control-plane has initialized successfully!</span><br><span class="line"></span><br><span class="line">To start using your cluster, you need to run the following as a regular user:</span><br><span class="line"></span><br><span class="line">  mkdir -p $HOME/.kube</span><br><span class="line">  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span><br><span class="line">  sudo chown $(id -u):$(id -g) $HOME/.kube/config</span><br><span class="line"></span><br><span class="line">You should now deploy a pod network to the cluster.</span><br><span class="line">Run "kubectl apply -f [podnetwork].yaml" with one of the options listed at:</span><br><span class="line">  https://kubernetes.io/docs/concepts/cluster-administration/addons/</span><br><span class="line"></span><br><span class="line">Then you can join any number of worker nodes by running the following on each as root:</span><br><span class="line"></span><br><span class="line">kubeadm join 192.168.1.55:6443 --token 991hr9.scqkkyphn1cjjcl7 \</span><br><span class="line">    --discovery-token-ca-cert-hash sha256:1dcf2607e09f83160ce9bc99a941d9a6bd74e99b6b8d3adb63af800ffee19baf</span><br><span class="line">[root@master55 /]#</span><br></pre></td></tr></table></figure><ol start="2"><li>根据初始化提示，在master55节点上执行如下命令<br>mkdir -p $HOME/.kube<br>sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config<br>sudo chown $(id -u):$(id -g) $HOME/.kube/config</li></ol><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@master55 /]# mkdir -p $HOME/.kube</span><br><span class="line">[root@master55 /]# sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span><br><span class="line">[root@master55 /]# sudo chown $(id -u):$(id -g) $HOME/.kube/config</span><br><span class="line">[root@master55 /]#</span><br></pre></td></tr></table></figure><ol start="3"><li>根据初始化提示，在slave56、slave57节点上分别执行如下命令<br>kubeadm join 192.168.1.55:6443 &minus;&minus;token 991hr9.scqkkyphn1cjjcl7 &minus;&minus;discovery-token-ca-cert-hash sha256:1dcf2607e09f83160ce9bc99a941d9a6bd74e99b6b8d3adb63af800ffee19baf</li></ol><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">W0616 17:50:09.914108    4585 join.go:346] [preflight] WARNING: JoinControlPane.controlPlane settings will be ignored when control-plane flag is not set.</span><br><span class="line">[preflight] Running pre-flight checks</span><br><span class="line">[preflight] Reading configuration from the cluster...</span><br><span class="line">[preflight] FYI: You can look at this config file with 'kubectl -n kube-system get cm kubeadm-config -oyaml'</span><br><span class="line">[kubelet-start] Downloading configuration for the kubelet from the "kubelet-config-1.18" ConfigMap in the kube-system namespace</span><br><span class="line">[kubelet-start] Writing kubelet configuration to file "/var/lib/kubelet/config.yaml"</span><br><span class="line">[kubelet-start] Writing kubelet environment file with flags to file "/var/lib/kubelet/kubeadm-flags.env"</span><br><span class="line">[kubelet-start] Starting the kubelet</span><br><span class="line">[kubelet-start] Waiting for the kubelet to perform the TLS Bootstrap...</span><br><span class="line"></span><br><span class="line">This node has joined the cluster:</span><br><span class="line">* Certificate signing request was sent to apiserver and a response was received.</span><br><span class="line">* The Kubelet was informed of the new secure connection details.</span><br><span class="line"></span><br><span class="line">Run 'kubectl get nodes' on the control-plane to see this node join the cluster.</span><br></pre></td></tr></table></figure><h4 id="十二、Kubernetes命令自动补全（墙裂建议）"><a href="#十二、Kubernetes命令自动补全（墙裂建议）" class="headerlink" title="十二、Kubernetes命令自动补全（墙裂建议）"></a>十二、Kubernetes命令自动补全（墙裂建议）</h4><figure class="highlight shell"><figcaption><span>SCRIPT</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">[root@master55 ~]# yum install -y epel-release bash-completion</span><br><span class="line">Loaded plugins: fastestmirror</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line"> * base: mirrors.aliyun.com</span><br><span class="line"> * extras: mirrors.aliyun.com</span><br><span class="line"> * updates: mirrors.aliyun.com</span><br><span class="line">kubernetes/signature                                                                                                                                                   |  454 B  00:00:00</span><br><span class="line">kubernetes/signature                                                                                                                                                   | 1.4 kB  00:00:00 !!!</span><br><span class="line">Resolving Dependencies</span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Running transaction check</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package bash-completion.noarch 1:2.1-6.el7 will be updated</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package bash-completion.noarch 1:2.1-8.el7 will be an update</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package epel-release.noarch 0:7-11 will be installed</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Finished Dependency Resolution</span></span><br><span class="line"></span><br><span class="line">Dependencies Resolved</span><br><span class="line"></span><br><span class="line">==============================================================================================================================================================================================</span><br><span class="line"> Package                                            Arch                                      Version                                         Repository                                 Size</span><br><span class="line">==============================================================================================================================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> epel-release                                       noarch                                    7-11                                            extras                                     15 k</span><br><span class="line">Updating:</span><br><span class="line"> bash-completion                                    noarch                                    1:2.1-8.el7                                     base                                       87 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">==============================================================================================================================================================================================</span><br><span class="line">Install  1 Package</span><br><span class="line">Upgrade  1 Package</span><br><span class="line"></span><br><span class="line">Total download size: 101 k</span><br><span class="line">Downloading packages:</span><br><span class="line">No Presto metadata available for base</span><br><span class="line">(1/2): bash-completion-2.1-8.el7.noarch.rpm                                                                                                                            |  87 kB  00:00:00</span><br><span class="line">(2/2): epel-release-7-11.noarch.rpm                                                                                                                                    |  15 kB  00:00:00</span><br><span class="line">----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line">Total                                                                                                                                                         225 kB/s | 101 kB  00:00:00</span><br><span class="line">Running transaction check</span><br><span class="line">Running transaction test</span><br><span class="line">Transaction test succeeded</span><br><span class="line">Running transaction</span><br><span class="line">  Installing : epel-release-7-11.noarch                                                                                                                                                   1/3</span><br><span class="line">  Updating   : 1:bash-completion-2.1-8.el7.noarch                                                                                                                                         2/3</span><br><span class="line">  Cleanup    : 1:bash-completion-2.1-6.el7.noarch                                                                                                                                         3/3</span><br><span class="line">  Verifying  : 1:bash-completion-2.1-8.el7.noarch                                                                                                                                         1/3</span><br><span class="line">  Verifying  : epel-release-7-11.noarch                                                                                                                                                   2/3</span><br><span class="line">  Verifying  : 1:bash-completion-2.1-6.el7.noarch                                                                                                                                         3/3</span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  epel-release.noarch 0:7-11</span><br><span class="line"></span><br><span class="line">Updated:</span><br><span class="line">  bash-completion.noarch 1:2.1-8.el7</span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line">[root@master55 ~]# source /usr/share/bash-completion/bash_completion</span><br><span class="line">[root@master55 ~]#</span><br><span class="line">[root@master55 ~]# source &lt;(kubectl completion bash)</span><br><span class="line">[root@master55 ~]#</span><br><span class="line">[root@master55 ~]# echo "source &lt;(kubectl completion bash)" &gt;&gt; ~/.bashrc</span><br><span class="line">// 输入kubectl, 双击Tab</span><br><span class="line">[root@master55 ~]# kubectl</span><br><span class="line">alpha          apply          certificate    convert        delete         edit           get            options        proxy          scale          uncordon</span><br><span class="line">annotate       attach         cluster-info   cordon         describe       exec           kustomize      patch          replace        set            version</span><br><span class="line">api-resources  auth           completion     cp             diff           explain        label          plugin         rollout        taint          wait</span><br><span class="line">api-versions   autoscale      config         create         drain          expose         logs           port-forward   run            top</span><br><span class="line">[root@master55 ~]# kubectl</span><br></pre></td></tr></table></figure><h4 id="十三、k8s查看所有节点"><a href="#十三、k8s查看所有节点" class="headerlink" title="十三、k8s查看所有节点"></a>十三、k8s查看所有节点</h4><p>master55节点查看所有节点，当前三台服务器的状态都是NotReady</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@master55 /]# kubectl get nodes</span><br><span class="line">NAME                 STATUS     ROLES    AGE   VERSION</span><br><span class="line">master55.xincan.cn   NotReady   master   16h   v1.18.3</span><br><span class="line">slave56.xincan.cn    NotReady   &lt;none&gt;   15h   v1.18.3</span><br><span class="line">slave57.xincan.cn    NotReady   &lt;none&gt;   16h   v1.18.3</span><br><span class="line">[root@master55 /]#</span><br></pre></td></tr></table></figure><h4 id="十四、k8s查看所有命名空间下所有pod"><a href="#十四、k8s查看所有命名空间下所有pod" class="headerlink" title="十四、k8s查看所有命名空间下所有pod"></a>十四、k8s查看所有命名空间下所有pod</h4><p>发现coredns一直处在pending状态，需要安装k8s网络插件</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@master55 /]# kubectl get pod --all-namespaces</span><br><span class="line">NAMESPACE     NAME                                         READY   STATUS    RESTARTS   AGE</span><br><span class="line">kube-system   coredns-7ff77c879f-hz59h                     0/1     Pending   0          16h</span><br><span class="line">kube-system   coredns-7ff77c879f-kkdpn                     0/1     Pending   0          16h</span><br><span class="line">kube-system   etcd-master55.xincan.cn                      1/1     Running   2          16h</span><br><span class="line">kube-system   kube-apiserver-master55.xincan.cn            1/1     Running   2          16h</span><br><span class="line">kube-system   kube-controller-manager-master55.xincan.cn   1/1     Running   2          16h</span><br><span class="line">kube-system   kube-proxy-kdxlv                             1/1     Running   2          16h</span><br><span class="line">kube-system   kube-proxy-mxm5n                             1/1     Running   2          16h</span><br><span class="line">kube-system   kube-proxy-sdnxb                             1/1     Running   2          15h</span><br><span class="line">kube-system   kube-scheduler-master55.xincan.cn            1/1     Running   2          16h</span><br><span class="line">[root@master55 /]#</span><br></pre></td></tr></table></figure><h4 id="十五、k8s安装网络插件"><a href="#十五、k8s安装网络插件" class="headerlink" title="十五、k8s安装网络插件"></a>十五、k8s安装网络插件</h4><p>我们这里选取calico网络插件（提供企业级支持）</p><ol><li>在master55节点上创建文件夹，用于存放下载的网络插件，我这里下载的是calico-3.13.1.yaml</li></ol><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@master55 /]# mkdir k8s</span><br><span class="line">[root@master55 /]# cd k8s/</span><br><span class="line">[root@master55 k8s]# mkdir calico &amp;&amp; cd calico</span><br><span class="line">[root@master55 calico]# wget https://kuboard.cn/install-script/calico/calico-3.13.1.yaml</span><br><span class="line">--2020-06-17 17:42:44--  https://kuboard.cn/install-script/calico/calico-3.13.1.yaml</span><br><span class="line">Resolving kuboard.cn (kuboard.cn)... 119.3.92.138, 122.112.240.69</span><br><span class="line">Connecting to kuboard.cn (kuboard.cn)|119.3.92.138|:443... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 21079 (21K) [application/octet-stream]</span><br><span class="line">Saving to: ‘calico-3.13.1.yaml’</span><br><span class="line"></span><br><span class="line"><span class="meta">100%</span><span class="bash">[====================================================================================================================================================&gt;] 21,079      --.-K/s   <span class="keyword">in</span> 0s</span></span><br><span class="line"></span><br><span class="line">2020-06-17 17:42:51 (221 MB/s) - ‘calico-3.13.1.yaml’ saved [21079/21079]</span><br><span class="line"></span><br><span class="line">[root@master55 calico]# ls</span><br><span class="line">calico-3.13.1.yaml</span><br><span class="line">[root@master55 calico]#</span><br></pre></td></tr></table></figure><ol start="2"><li>安装calico-3.13.1.yaml</li></ol><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@master55 calico]# kubectl apply -f calico-3.13.1.yaml</span><br><span class="line">configmap/calico-config created</span><br><span class="line">customresourcedefinition.apiextensions.k8s.io/bgpconfigurations.crd.projectcalico.org created</span><br><span class="line">customresourcedefinition.apiextensions.k8s.io/bgppeers.crd.projectcalico.org created</span><br><span class="line">customresourcedefinition.apiextensions.k8s.io/blockaffinities.crd.projectcalico.org created</span><br><span class="line">customresourcedefinition.apiextensions.k8s.io/clusterinformations.crd.projectcalico.org created</span><br><span class="line">customresourcedefinition.apiextensions.k8s.io/felixconfigurations.crd.projectcalico.org created</span><br><span class="line">customresourcedefinition.apiextensions.k8s.io/globalnetworkpolicies.crd.projectcalico.org created</span><br><span class="line">customresourcedefinition.apiextensions.k8s.io/globalnetworksets.crd.projectcalico.org created</span><br><span class="line">customresourcedefinition.apiextensions.k8s.io/hostendpoints.crd.projectcalico.org created</span><br><span class="line">customresourcedefinition.apiextensions.k8s.io/ipamblocks.crd.projectcalico.org created</span><br><span class="line">customresourcedefinition.apiextensions.k8s.io/ipamconfigs.crd.projectcalico.org created</span><br><span class="line">customresourcedefinition.apiextensions.k8s.io/ipamhandles.crd.projectcalico.org created</span><br><span class="line">customresourcedefinition.apiextensions.k8s.io/ippools.crd.projectcalico.org created</span><br><span class="line">customresourcedefinition.apiextensions.k8s.io/networkpolicies.crd.projectcalico.org created</span><br><span class="line">customresourcedefinition.apiextensions.k8s.io/networksets.crd.projectcalico.org created</span><br><span class="line">clusterrole.rbac.authorization.k8s.io/calico-kube-controllers created</span><br><span class="line">clusterrolebinding.rbac.authorization.k8s.io/calico-kube-controllers created</span><br><span class="line">clusterrole.rbac.authorization.k8s.io/calico-node created</span><br><span class="line">clusterrolebinding.rbac.authorization.k8s.io/calico-node created</span><br><span class="line">daemonset.apps/calico-node created</span><br><span class="line">serviceaccount/calico-node created</span><br><span class="line">deployment.apps/calico-kube-controllers created</span><br><span class="line">serviceaccount/calico-kube-controllers created</span><br><span class="line">[root@master55 calico]#</span><br></pre></td></tr></table></figure><h4 id="十六、再次查看node和pod"><a href="#十六、再次查看node和pod" class="headerlink" title="十六、再次查看node和pod"></a>十六、再次查看node和pod</h4><p>需要等待一会时间</p><ol><li>查看nodes，发现状态已经为Ready</li></ol><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@master55 /]# kubectl get nodes</span><br><span class="line">NAME                 STATUS   ROLES    AGE   VERSION</span><br><span class="line">master55.xincan.cn   Ready    master   16h   v1.18.3</span><br><span class="line">slave56.xincan.cn    Ready    &lt;none&gt;   16h   v1.18.3</span><br><span class="line">slave57.xincan.cn    Ready    &lt;none&gt;   16h   v1.18.3</span><br><span class="line">[root@master55 /]#</span><br></pre></td></tr></table></figure><ol start="2"><li>查看pods，发现状态都为Running</li></ol><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@master55 /]# kubectl get pod --all-namespaces</span><br><span class="line">NAMESPACE     NAME                                         READY   STATUS    RESTARTS   AGE</span><br><span class="line">kube-system   calico-kube-controllers-5b8b769fcd-cbqpr     1/1     Running   0          6m21s</span><br><span class="line">kube-system   calico-node-fnv55                            1/1     Running   0          6m21s</span><br><span class="line">kube-system   calico-node-rbpc8                            1/1     Running   0          6m21s</span><br><span class="line">kube-system   calico-node-xrsbf                            1/1     Running   0          6m21s</span><br><span class="line">kube-system   coredns-7ff77c879f-hz59h                     1/1     Running   0          16h</span><br><span class="line">kube-system   coredns-7ff77c879f-kkdpn                     1/1     Running   0          16h</span><br><span class="line">kube-system   etcd-master55.xincan.cn                      1/1     Running   2          16h</span><br><span class="line">kube-system   kube-apiserver-master55.xincan.cn            1/1     Running   2          16h</span><br><span class="line">kube-system   kube-controller-manager-master55.xincan.cn   1/1     Running   2          16h</span><br><span class="line">kube-system   kube-proxy-kdxlv                             1/1     Running   2          16h</span><br><span class="line">kube-system   kube-proxy-mxm5n                             1/1     Running   2          16h</span><br><span class="line">kube-system   kube-proxy-sdnxb                             1/1     Running   2          16h</span><br><span class="line">kube-system   kube-scheduler-master55.xincan.cn            1/1     Running   2          16h</span><br><span class="line">[root@master55 /]#</span><br></pre></td></tr></table></figure><h4 id="十七、安装git"><a href="#十七、安装git" class="headerlink" title="十七、安装git"></a>十七、安装git</h4><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@master55 /]# yum install curl-devel expat-devel gettext-devel openssl-devel zlib-devel gcc perl-ExtUtils-MakeMaker</span><br><span class="line">[root@master55 /]# cd /usr/local/src/</span><br><span class="line">[root@master55 src]# wget https://mirrors.edge.kernel.org/pub/software/scm/git/git-2.23.0.tar.xz</span><br><span class="line">[root@master55 src]# tar -xvf git-2.23.0.tar.xz</span><br><span class="line">[root@master55 src]# cd git-2.23.0/</span><br><span class="line">[root@master55 src]# make prefix=/usr/local/git all</span><br><span class="line">[root@master55 src]# make prefix=/usr/local/git install</span><br><span class="line">[root@master55 src]# echo "export PATH=$PATH:/usr/local/git/bin" &gt;&gt; /etc/profile</span><br><span class="line">[root@master55 src]# source  /etc/profile</span><br></pre></td></tr></table></figure><h4 id="十八、kube-promethues部署"><a href="#十八、kube-promethues部署" class="headerlink" title="十八、kube-promethues部署"></a>十八、kube-promethues部署</h4><ol><li>下载安装源码，切换到上述创建的k8s目录下，进行git clone <a href="https://github.com/coreos/kube-prometheus.git拉取">https://github.com/coreos/kube-prometheus.git拉取</a></li><li>安装文件都在kube-prometheus/manifests/ 目录下，切换到此目录</li></ol><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@master55 k8s]# git clone https://github.com/coreos/kube-prometheus.git</span><br><span class="line">Cloning into 'kube-prometheus'...</span><br><span class="line">remote: Enumerating objects: 8381, done.</span><br><span class="line">remote: Total 8381 (delta 0), reused 0 (delta 0), pack-reused 8381</span><br><span class="line">Receiving objects: 100% (8381/8381), 4.70 MiB | 421.00 KiB/s, done.</span><br><span class="line">Resolving deltas: 100% (5082/5082), done.</span><br><span class="line">[root@master55 k8s]# ls</span><br><span class="line">calico  kube-prometheus</span><br><span class="line">[root@master55 k8s]# cd kube-prometheus/manifests/</span><br><span class="line">[root@master55 manifests]# ls</span><br><span class="line">alertmanager-alertmanager.yaml              node-exporter-clusterRoleBinding.yaml                       prometheus-clusterRole.yaml</span><br><span class="line">alertmanager-secret.yaml                    node-exporter-clusterRole.yaml                              prometheus-operator-serviceMonitor.yaml</span><br><span class="line">alertmanager-serviceAccount.yaml            node-exporter-daemonset.yaml                                prometheus-prometheus.yaml</span><br><span class="line">alertmanager-serviceMonitor.yaml            node-exporter-serviceAccount.yaml                           prometheus-roleBindingConfig.yaml</span><br><span class="line">alertmanager-service.yaml                   node-exporter-serviceMonitor.yaml                           prometheus-roleBindingSpecificNamespaces.yaml</span><br><span class="line">grafana-dashboardDatasources.yaml           node-exporter-service.yaml                                  prometheus-roleConfig.yaml</span><br><span class="line">grafana-dashboardDefinitions.yaml           prometheus-adapter-apiService.yaml                          prometheus-roleSpecificNamespaces.yaml</span><br><span class="line">grafana-dashboardSources.yaml               prometheus-adapter-clusterRoleAggregatedMetricsReader.yaml  prometheus-rules.yaml</span><br><span class="line">grafana-deployment.yaml                     prometheus-adapter-clusterRoleBindingDelegator.yaml         prometheus-serviceAccount.yaml</span><br><span class="line">grafana-serviceAccount.yaml                 prometheus-adapter-clusterRoleBinding.yaml                  prometheus-serviceMonitorApiserver.yaml</span><br><span class="line">grafana-serviceMonitor.yaml                 prometheus-adapter-clusterRoleServerResources.yaml          prometheus-serviceMonitorCoreDNS.yaml</span><br><span class="line">grafana-service.yaml                        prometheus-adapter-clusterRole.yaml                         prometheus-serviceMonitorKubeControllerManager.yaml</span><br><span class="line">kube-state-metrics-clusterRoleBinding.yaml  prometheus-adapter-configMap.yaml                           prometheus-serviceMonitorKubelet.yaml</span><br><span class="line">kube-state-metrics-clusterRole.yaml         prometheus-adapter-deployment.yaml                          prometheus-serviceMonitorKubeScheduler.yaml</span><br><span class="line">kube-state-metrics-deployment.yaml          prometheus-adapter-roleBindingAuthReader.yaml               prometheus-serviceMonitor.yaml</span><br><span class="line">kube-state-metrics-serviceAccount.yaml      prometheus-adapter-serviceAccount.yaml                      prometheus-service.yaml</span><br><span class="line">kube-state-metrics-serviceMonitor.yaml      prometheus-adapter-service.yaml                             setup</span><br><span class="line">kube-state-metrics-service.yaml             prometheus-clusterRoleBinding.yaml</span><br><span class="line">[root@master55 manifests]#</span><br></pre></td></tr></table></figure><ol start="3"><li>官方把所有文件都放在一起,这里我复制了然后分类下，切换到k8s目录下进行操作</li></ol><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@master55 k8s]# mkdir prometheus</span><br><span class="line">[root@master55 k8s]# cp kube-prometheus/manifests/* prometheus/</span><br><span class="line">[root@master55 k8s]# cd prometheus/</span><br><span class="line">[root@master55 prometheus]# mkdir -p operator node-exporter alertmanager grafana kube-state-metrics prometheus serviceMonitor adapter</span><br></pre></td></tr></table></figure><ol start="4"><li>将kube-prometheus/manifests/setup下的文件都复制到/prometheus/operator/下</li></ol><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master55 k8s]# cp -f kube-prometheus/manifests/setup/* /k8s/prometheus/operator/</span><br></pre></td></tr></table></figure><ol start="5"><li>将prometheus/operator/下0namespace-namespace.yaml文件移动到/k8s/prometheus/下</li></ol><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master55 k8s]# mv prometheus/operator/0namespace-namespace.yaml prometheus/</span><br></pre></td></tr></table></figure><ol start="6"><li>切换到prometheus/目录下，进行文件归置</li></ol><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@master55 k8s]# cd prometheus/</span><br><span class="line">[root@master55 prometheus]# mv *-serviceMonitor* serviceMonitor/</span><br><span class="line">[root@master55 prometheus]# mv grafana-* grafana/</span><br><span class="line">[root@master55 prometheus]# mv kube-state-metrics-* kube-state-metrics/</span><br><span class="line">[root@master55 prometheus]# mv alertmanager-* alertmanager/</span><br><span class="line">[root@master55 prometheus]# mv node-exporter-* node-exporter/</span><br><span class="line">[root@master55 prometheus]# mv prometheus-adapter* adapter/</span><br><span class="line">[root@master55 prometheus]# mv prometheus-* prometheus/</span><br></pre></td></tr></table></figure><ol start="7"><li>注意：新版本的默认label变了，需要修改选择器为beta.kubernetes.io/os，不然安装的时候会卡住,修改选择器</li></ol><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@master55 prometheus]# sed -ri '/linux/s#kubernetes.io#beta.&amp;#' \</span><br><span class="line">     alertmanager/alertmanager-alertmanager.yaml \</span><br><span class="line">     prometheus/prometheus-prometheus.yaml \</span><br><span class="line">     node-exporter/node-exporter-daemonset.yaml \</span><br><span class="line">     kube-state-metrics/kube-state-metrics-deployment.yaml</span><br><span class="line">[root@master55 prometheus]#</span><br></pre></td></tr></table></figure><ol start="7"><li>注意：镜像使用dockerhub上的</li></ol><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@master55 prometheus]# sed -ri '/quay.io/s#quay.io/prometheus#prom#' \</span><br><span class="line">  alertmanager/alertmanager-alertmanager.yaml \</span><br><span class="line">  prometheus/prometheus-prometheus.yaml \</span><br><span class="line">  node-exporter/node-exporter-daemonset.yaml</span><br><span class="line">[root@master55 prometheus]#</span><br></pre></td></tr></table></figure><ol start="8"><li>注意：镜像使用dockerhub上的</li></ol><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master55 prometheus]# find -type f -exec sed -ri 's#k8s.gcr.io#gcr.azk8s.cn/google_containers#' &#123;&#125; \; </span><br><span class="line">[root@master55 prometheus]#</span><br></pre></td></tr></table></figure><ol start="9"><li>生成namespace</li></ol><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@master55 prometheus]# kubectl apply -f .</span><br><span class="line">namespace/monitoring created</span><br><span class="line">[root@master55 prometheus]#</span><br></pre></td></tr></table></figure><ol start="10"><li>安装operater</li></ol><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@master55 prometheus]# kubectl apply -f operator/</span><br><span class="line">customresourcedefinition.apiextensions.k8s.io/alertmanagers.monitoring.coreos.com created</span><br><span class="line">customresourcedefinition.apiextensions.k8s.io/podmonitors.monitoring.coreos.com created</span><br><span class="line">customresourcedefinition.apiextensions.k8s.io/prometheuses.monitoring.coreos.com created</span><br><span class="line">customresourcedefinition.apiextensions.k8s.io/prometheusrules.monitoring.coreos.com created</span><br><span class="line">customresourcedefinition.apiextensions.k8s.io/servicemonitors.monitoring.coreos.com created</span><br><span class="line">customresourcedefinition.apiextensions.k8s.io/thanosrulers.monitoring.coreos.com created</span><br><span class="line">clusterrole.rbac.authorization.k8s.io/prometheus-operator created</span><br><span class="line">clusterrolebinding.rbac.authorization.k8s.io/prometheus-operator created</span><br><span class="line">deployment.apps/prometheus-operator created</span><br><span class="line">service/prometheus-operator created</span><br><span class="line">serviceaccount/prometheus-operator created</span><br><span class="line">[root@master55 prometheus]#</span><br></pre></td></tr></table></figure><ol start="11"><li>依次安装其他组件</li></ol><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@master55 prometheus]# kubectl apply -f adapter/</span><br><span class="line">[root@master55 prometheus]# kubectl apply -f alertmanager/</span><br><span class="line">[root@master55 prometheus]# kubectl apply -f node-exporter/</span><br><span class="line">[root@master55 prometheus]# kubectl apply -f kube-state-metrics/</span><br><span class="line">[root@master55 prometheus]# kubectl apply -f grafana/</span><br><span class="line">[root@master55 prometheus]# kubectl apply -f prometheus/</span><br><span class="line">[root@master55 prometheus]# kubectl apply -f serviceMonitor/</span><br><span class="line">[root@master55 prometheus]#</span><br></pre></td></tr></table></figure><ol start="12"><li>查看整体状态</li></ol><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">[root@master55 /]# kubectl -n monitoring get all</span><br><span class="line">NAME                                       READY   STATUS    RESTARTS   AGE</span><br><span class="line">pod/alertmanager-main-0                    2/2     Running   0          28m</span><br><span class="line">pod/alertmanager-main-1                    2/2     Running   0          28m</span><br><span class="line">pod/alertmanager-main-2                    2/2     Running   0          28m</span><br><span class="line">pod/grafana-5c55845445-hzhbk               1/1     Running   0          38m</span><br><span class="line">pod/kube-state-metrics-665c856fb9-7ggrg    3/3     Running   0          38m</span><br><span class="line">pod/node-exporter-dqfd7                    2/2     Running   0          39m</span><br><span class="line">pod/node-exporter-gf8gr                    2/2     Running   0          39m</span><br><span class="line">pod/node-exporter-mcl79                    2/2     Running   0          39m</span><br><span class="line">pod/prometheus-adapter-5cdcdf9c8d-665fj    1/1     Running   0          39m</span><br><span class="line">pod/prometheus-operator-6f98f66b89-6spkk   2/2     Running   0          32m</span><br><span class="line"></span><br><span class="line">NAME                            TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)                      AGE</span><br><span class="line">service/alertmanager-main       ClusterIP   10.111.117.158   &lt;none&gt;        9093/TCP                     39m</span><br><span class="line">service/alertmanager-operated   ClusterIP   None             &lt;none&gt;        9093/TCP,9094/TCP,9094/UDP   28m</span><br><span class="line">service/grafana                 ClusterIP   10.111.25.63     &lt;none&gt;        3000/TCP                     38m</span><br><span class="line">service/kube-state-metrics      ClusterIP   None             &lt;none&gt;        8443/TCP,9443/TCP            38m</span><br><span class="line">service/node-exporter           ClusterIP   None             &lt;none&gt;        9100/TCP                     39m</span><br><span class="line">service/prometheus-adapter      ClusterIP   10.109.99.195    &lt;none&gt;        443/TCP                      39m</span><br><span class="line">service/prometheus-k8s          ClusterIP   10.110.243.126   &lt;none&gt;        9090/TCP                     38m</span><br><span class="line">service/prometheus-operator     ClusterIP   None             &lt;none&gt;        8443/TCP                     32m</span><br><span class="line"></span><br><span class="line">NAME                           DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR                 AGE</span><br><span class="line">daemonset.apps/node-exporter   3         3         3       3            3           beta.kubernetes.io/os=linux   39m</span><br><span class="line"></span><br><span class="line">NAME                                  READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">deployment.apps/grafana               1/1     1            1           38m</span><br><span class="line">deployment.apps/kube-state-metrics    1/1     1            1           38m</span><br><span class="line">deployment.apps/prometheus-adapter    1/1     1            1           39m</span><br><span class="line">deployment.apps/prometheus-operator   1/1     1            1           32m</span><br><span class="line"></span><br><span class="line">NAME                                             DESIRED   CURRENT   READY   AGE</span><br><span class="line">replicaset.apps/grafana-5c55845445               1         1         1       38m</span><br><span class="line">replicaset.apps/kube-state-metrics-665c856fb9    1         1         1       38m</span><br><span class="line">replicaset.apps/prometheus-adapter-5cdcdf9c8d    1         1         1       39m</span><br><span class="line">replicaset.apps/prometheus-operator-6f98f66b89   1         1         1       32m</span><br><span class="line"></span><br><span class="line">NAME                                 READY   AGE</span><br><span class="line">statefulset.apps/alertmanager-main   3/3     28m</span><br><span class="line">[root@master55 /]#</span><br></pre></td></tr></table></figure><ol start="13"><li>k8s查看所有svc</li></ol><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@master55 prometheus]# kubectl -n monitoring get svc</span><br><span class="line">NAME                    TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)                      AGE</span><br><span class="line">alertmanager-main       ClusterIP   10.111.117.158   &lt;none&gt;        9093/TCP                     115m</span><br><span class="line">alertmanager-operated   ClusterIP   None             &lt;none&gt;        9093/TCP,9094/TCP,9094/UDP   104m</span><br><span class="line">grafana                 NodePort    10.111.25.63     &lt;none&gt;        3000:31533/TCP               114m</span><br><span class="line">kube-state-metrics      ClusterIP   None             &lt;none&gt;        8443/TCP,9443/TCP            115m</span><br><span class="line">node-exporter           ClusterIP   None             &lt;none&gt;        9100/TCP                     115m</span><br><span class="line">prometheus-adapter      ClusterIP   10.109.99.195    &lt;none&gt;        443/TCP                      115m</span><br><span class="line">prometheus-k8s          ClusterIP   10.110.243.126   &lt;none&gt;        9090/TCP                     114m</span><br><span class="line">prometheus-operator     ClusterIP   None             &lt;none&gt;        8443/TCP                     108m</span><br><span class="line">[root@master55 prometheus]#</span><br></pre></td></tr></table></figure><ol start="13"><li>k8s暴露grafana外网访问端口<br> 修改type: ClusterIP为 type: NodePort ,默认外网端口NodePort对应的是31533，找到如下代码，</li></ol><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@master55 prometheus]# kubectl -n monitoring edit svc grafana</span><br><span class="line"></span><br><span class="line">spec:</span><br><span class="line">  clusterIP: 10.111.25.63</span><br><span class="line">  externalTrafficPolicy: Cluster</span><br><span class="line">  ports:</span><br><span class="line">  - name: http</span><br><span class="line">    nodePort: 31533</span><br><span class="line">    port: 3000</span><br><span class="line">    protocol: TCP</span><br><span class="line">    targetPort: http</span><br><span class="line">  selector:</span><br><span class="line">    app: grafana</span><br><span class="line">  sessionAffinity: None</span><br><span class="line">  type: NodePort</span><br></pre></td></tr></table></figure><ol start="14"><li>最终效果图（部分效果图）</li></ol><p><img src="https://cdn.jsdelivr.net/gh/xincan/blog-database/blog/centos-k8s-5.png" alt="效果图一"><br><img src="https://cdn.jsdelivr.net/gh/xincan/blog-database/blog/centos-k8s-4.png" alt="效果图一"><br><img src="https://cdn.jsdelivr.net/gh/xincan/blog-database/blog/centos-k8s-3.png" alt="效果图一"></p><h4 id="十九、-安装kubernetes-dashboard"><a href="#十九、-安装kubernetes-dashboard" class="headerlink" title="十九、 安装kubernetes-dashboard"></a>十九、 安装kubernetes-dashboard</h4><p>下载dashboard所需资源<br>    git clone <a href="https://github.com/xincan/kubernetes.git">https://github.com/xincan/kubernetes.git</a></p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">[root@xincan /]#cd /k8s/</span><br><span class="line">[root@xincan k8s]#git clone https://github.com/xincan/kubernetes.git</span><br><span class="line">[root@xincan k8s]#ls</span><br><span class="line">calico  kube-prometheus  kubernetes-dashboard  prometheus</span><br><span class="line">[root@master55 k8s]# cd kubernetes-dashboard/</span><br><span class="line">[root@master55 kubernetes-dashboard]# ls</span><br><span class="line">login-token  recommended.yaml</span><br><span class="line">[root@master55 kubernetes-dashboard]#kubectl create -f recommended.yaml</span><br><span class="line">namespace/kubernetes-dashboard created</span><br><span class="line">serviceaccount/kubernetes-dashboard created</span><br><span class="line">service/kubernetes-dashboard created</span><br><span class="line">secret/kubernetes-dashboard-certs created</span><br><span class="line">secret/kubernetes-dashboard-csrf created</span><br><span class="line">secret/kubernetes-dashboard-key-holder created</span><br><span class="line">configmap/kubernetes-dashboard-settings created</span><br><span class="line">role.rbac.authorization.k8s.io/kubernetes-dashboard created</span><br><span class="line">clusterrole.rbac.authorization.k8s.io/kubernetes-dashboard created</span><br><span class="line">rolebinding.rbac.authorization.k8s.io/kubernetes-dashboard created</span><br><span class="line">clusterrolebinding.rbac.authorization.k8s.io/kubernetes-dashboard created</span><br><span class="line">deployment.apps/kubernetes-dashboard created</span><br><span class="line">service/dashboard-metrics-scraper created</span><br><span class="line">deployment.apps/dashboard-metrics-scraper created</span><br><span class="line">[root@master55 kubernetes-dashboard]#</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 查看kubernetes-dashboard命名空间下pod，svc</span></span></span><br><span class="line">[root@master55 kubernetes-dashboard]# kubectl get pod,svc -n kubernetes-dashboard</span><br><span class="line">NAME                                             READY   STATUS              RESTARTS   AGE</span><br><span class="line">pod/dashboard-metrics-scraper-779f5454cb-hzgc4   1/1     ContainerCreating   0          30s</span><br><span class="line">pod/kubernetes-dashboard-857bb4c778-gsf2q        1/1     ContainerCreating   0          30s</span><br><span class="line"></span><br><span class="line">NAME                                TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE</span><br><span class="line">service/dashboard-metrics-scraper   ClusterIP   10.105.54.169   &lt;none&gt;        8000/TCP   30s</span><br><span class="line">service/kubernetes-dashboard        ClusterIP   10.110.40.170   &lt;none&gt;        443/TCP    31s</span><br><span class="line">[root@master55 kubernetes-dashboard]#</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 增加nodePort: 30001,设置dashboard访问端口，修改type: NodePort,保存退出自动更新</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 也可以使用kubectl patch svc -n kube-system kubernetes-dashboard -p '&#123;"spec":&#123;"type":"NodePort"&#125;&#125;'进行修改</span></span></span><br><span class="line">[root@master55 kubernetes-dashboard]#kubectl edit svc -n kubernetes-dashboard kubernetes-dashboard</span><br><span class="line">spec:</span><br><span class="line">  clusterIP: 10.110.40.170</span><br><span class="line">  externalTrafficPolicy: Cluster</span><br><span class="line">  ports:</span><br><span class="line">  - nodePort: 30000</span><br><span class="line">    port: 443</span><br><span class="line">    protocol: TCP</span><br><span class="line">    targetPort: 8443</span><br><span class="line">  selector:</span><br><span class="line">    k8s-app: kubernetes-dashboard</span><br><span class="line">  sessionAffinity: None</span><br><span class="line">  type: NodePort</span><br><span class="line"></span><br><span class="line">dit cancelled, no changes made.</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 修改完成后，可以看到kubernetes-dashboard的type为NodePort，端口为30000</span></span></span><br><span class="line">[root@master55 kubernetes-dashboard]# kubectl get svc -n kubernetes-dashboard kubernetes-dashboard</span><br><span class="line">NAME                   TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)         AGE</span><br><span class="line">kubernetes-dashboard   NodePort   10.110.40.170   &lt;none&gt;        443:30001/TCP   14m</span><br><span class="line">[root@master55 kubernetes-dashboard]#</span><br></pre></td></tr></table></figure><h4 id="二十、-Token令牌登录"><a href="#二十、-Token令牌登录" class="headerlink" title="二十、 Token令牌登录"></a>二十、 Token令牌登录</h4><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 在kube-system命名空间下创建xincan-dashboard-admin用户</span></span></span><br><span class="line">[root@master55 k8s]# kubectl create serviceaccount xincan-dashboard-admin -n kube-system</span><br><span class="line">serviceaccount/xincan-dashboard-admin created</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 查看用户</span></span></span><br><span class="line">[root@master55 k8s]# kubectl get serviceaccount xincan-dashboard-admin -n kube-system</span><br><span class="line">NAME                     SECRETS   AGE</span><br><span class="line">xincan-dashboard-admin   1         7s</span><br><span class="line">[root@master55 k8s]#</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 在kube-system命名空间下，创建xincan-dashboard-admin权限</span></span></span><br><span class="line">[root@master55 k8s]# kubectl create clusterrolebinding dashboard-cluster-admin --clusterrole=cluster-admin --serviceaccount=kube-system:xincan-dashboard-admin</span><br><span class="line">clusterrolebinding.rbac.authorization.k8s.io/dashboard-cluster-admin created</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 查看权限xincan-dashboard-admin是否生效</span></span></span><br><span class="line">[root@master55 k8s]# kubectl get secret -n kube-system</span><br><span class="line">NAME                                             TYPE                                  DATA   AGE</span><br><span class="line">attachdetach-controller-token-fk6c9              kubernetes.io/service-account-token   3      91m</span><br><span class="line">bootstrap-signer-token-kjw62                     kubernetes.io/service-account-token   3      91m</span><br><span class="line">bootstrap-token-90s06v                           bootstrap.kubernetes.io/token         7      91m</span><br><span class="line">calico-kube-controllers-token-6824q              kubernetes.io/service-account-token   3      85m</span><br><span class="line">calico-node-token-22rkl                          kubernetes.io/service-account-token   3      85m</span><br><span class="line">certificate-controller-token-4zhbc               kubernetes.io/service-account-token   3      91m</span><br><span class="line">clusterrole-aggregation-controller-token-vzbqs   kubernetes.io/service-account-token   3      91m</span><br><span class="line">coredns-token-xrqs4                              kubernetes.io/service-account-token   3      91m</span><br><span class="line">xincan-dashboard-admin-token-jkhl2               kubernetes.io/service-account-token   3      3m35s</span><br><span class="line">[root@master55 k8s]#</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 获取xincan-dashboard-admin-token-jkhl2的token令牌</span></span></span><br><span class="line">[root@master55 k8s]# kubectl describe secret -n kube-system xincan-dashboard-admin-token-jkhl2</span><br><span class="line">Name:         xincan-dashboard-admin-token-jkhl2</span><br><span class="line">Namespace:    kube-system</span><br><span class="line">Labels:       &lt;none&gt;</span><br><span class="line">Annotations:  kubernetes.io/service-account.name: xincan-dashboard-admin</span><br><span class="line">              kubernetes.io/service-account.uid: c257c2f8-57cf-41d7-b8e6-b833a8ef0790</span><br><span class="line"></span><br><span class="line">Type:  kubernetes.io/service-account-token</span><br><span class="line"></span><br><span class="line">Data</span><br><span class="line">====</span><br><span class="line">ca.crt:     1025 bytes</span><br><span class="line">namespace:  11 bytes</span><br><span class="line">token:      eyJhbGciOiJSUzI1NiIsImtpZCI6IkFfZDQ5YTBkcTIwVG1xdF9rWFJxWDJfblFMd1lfdWQwdllVVjFxZTVtcTQifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJ4aW5jYW4tZGFzaGJvYXJkLWFkbWluLXRva2VuLWpraGwyIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6InhpbmNhbi1kYXNoYm9hcmQtYWRtaW4iLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiJjMjU3YzJmOC01N2NmLTQxZDctYjhlNi1iODMzYThlZjA3OTAiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZS1zeXN0ZW06eGluY2FuLWRhc2hib2FyZC1hZG1pbiJ9.rPDqRpuVrQmTXJ7FHKz8isG4IqYs7aN5QgZCLVRLK1Ul0677pmPfFTgZpVzf5R9f6_h7kFLGFej9wq5QJ3NZn71jv1qhn9rYgabyZ9KsDZsE6SDwQQuHcVDz7iQ9prFezyqdiyBIxqoFEFhZyZe8pn-Ua53a7-P4Dm2xs2xMgbvrLt6b_b8--H_plV-6xrLKrM5BhG15HDi5MA7MXBZJzxTyuNC8CtjQ6ShuQFv5I3Fwqgugu9tqxGBk9Xjy82JGrdnvoSNRNThCMzlVZmClzrsT6CZ4BUw4t0x4dYhvbdo6IS5nnW0u_EOsaDdi1gqBjpeMX_tNT1ChqN55TnnPPw</span><br><span class="line">[root@master55 k8s]#</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 复制令牌然后到登录界面进行粘贴</span></span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/xincan/blog-database/blog/k8s-token-login.png" alt="token登录方式"></p><h4 id="二十、-KubeConfig登录"><a href="#二十、-KubeConfig登录" class="headerlink" title="二十、 KubeConfig登录"></a>二十、 KubeConfig登录</h4><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[root@master55 k8s]# DASH_TOCKEN=$(kubectl get secret -n kube-system xincan-dashboard-admin-token-jkhl2 -o jsonpath=&#123;.data.token&#125;|base64 -d)</span><br><span class="line">[root@master55 k8s]# kubectl config set-cluster kubernetes --server=https://kubernetes.docker.internal:6443 --kubeconfig=/k8s/xincan-dashbord-admin.conf</span><br><span class="line">Cluster "kubernetes" set.</span><br><span class="line">[root@master55 k8s]# kubectl config set-credentials xincan-dashboard-admin --token=$DASH_TOCKEN --kubeconfig=/k8s/xincan-dashbord-admin.conf</span><br><span class="line">User "xincan-dashboard-admin" set.</span><br><span class="line">[root@master55 k8s]# kubectl config set-context dashboard-admin@kubernetes --cluster=kubernetes --user=xincan-dashboard-admin --kubeconfig=/k8s/xincan-dashbord-admin.conf</span><br><span class="line">Context "dashboard-admin@kubernetes" created.</span><br><span class="line">[root@master55 k8s]# kubectl config use-context dashboard-admin@kubernetes --kubeconfig=/k8s/xincan-dashbord-admin.conf</span><br><span class="line">Switched to context "dashboard-admin@kubernetes".</span><br><span class="line">[root@master55 k8s]# ll</span><br><span class="line">total 710420</span><br><span class="line">-rw-r--r-- 1 root root     21079 Jul 12 22:24 calico-3.13.1.yaml</span><br><span class="line">-rwxr-xr-x 1 root root      2051 Jul 16 14:40 get-k8s-images.sh</span><br><span class="line">-rw-r--r-- 1 root root 727422976 Jul 16 14:57 k8s-imagesV1.18.5.tar</span><br><span class="line">-rw-r--r-- 1 root root       901 Jul 16 15:54 k8s-token</span><br><span class="line">drwxr-xr-x 3 root root      4096 Jul 16 17:47 kube-prometheus</span><br><span class="line">drwxr-xr-x 2 root root        30 Jul 16 17:47 kubernetes-dashboard</span><br><span class="line">-rw------- 1 root root      1321 Jul 16 17:01 xincan-dashbord-admin.conf</span><br><span class="line">[root@master55 k8s]#</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 将生成后的xincan-dashbord-admin.conf复制到登录的主机，在需要时，上传这个配置文件即可</span></span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/xincan/blog-database/blog/k8s-kubeconfig-login.png" alt="token登录方式"></p><p><img src="https://cdn.jsdelivr.net/gh/xincan/blog-database/blog/k8s-main.png" alt="kubernetes主界面"></p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;虚拟机配置&quot;&gt;&lt;a href=&quot;#虚拟机配置&quot; class=&quot;headerlink&quot; title=&quot;虚拟机配置&quot;&gt;&lt;/a&gt;虚拟机配置&lt;/h3&gt;&lt;p&gt;准备三台虚拟机，每台虚机请参照&lt;a href=&quot;http://xincan.github.io/posts/d05af695/&quot;&gt;centos基础环境构建&lt;/a&gt;、&lt;a href=&quot;http://xincan.github.io/posts/cd183338/&quot;&gt;centos构建docker基础环境&lt;/a&gt;进行安装构建&lt;/p&gt;
    
    </summary>
    
    
      <category term="系统教程" scheme="https://xincan.github.io/categories/%E7%B3%BB%E7%BB%9F%E6%95%99%E7%A8%8B/"/>
    
      <category term="环境构建" scheme="https://xincan.github.io/categories/%E7%B3%BB%E7%BB%9F%E6%95%99%E7%A8%8B/%E7%8E%AF%E5%A2%83%E6%9E%84%E5%BB%BA/"/>
    
    
      <category term="系统教程" scheme="https://xincan.github.io/tags/%E7%B3%BB%E7%BB%9F%E6%95%99%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>centos构建docker基础环境</title>
    <link href="https://xincan.github.io/posts/cd183338/"/>
    <id>https://xincan.github.io/posts/cd183338/</id>
    <published>2020-06-03T11:32:00.000Z</published>
    <updated>2020-07-16T05:38:37.680Z</updated>
    
    <content type="html"><![CDATA[<h3 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h3><p>准备一台虚拟机，请参照<a href="http://xincan.github.io/posts/d05af695/">centos基础环境构建</a></p><a id="more"></a><h4 id="一、-检查是否之前安装过docker，如果有则清除docker环境"><a href="#一、-检查是否之前安装过docker，如果有则清除docker环境" class="headerlink" title="一、 检查是否之前安装过docker，如果有则清除docker环境"></a>一、 检查是否之前安装过docker，如果有则清除docker环境</h4><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost /]# sudo yum remove docker docker-client docker-client-latest docker-common docker-latest docker-latest-logrotate docker-logrotate docker-engine</span><br><span class="line">Loaded plugins: fastestmirror</span><br><span class="line">No Match for argument: docker</span><br><span class="line">No Match for argument: docker-client</span><br><span class="line">No Match for argument: docker-client-latest</span><br><span class="line">No Match for argument: docker-common</span><br><span class="line">No Match for argument: docker-latest</span><br><span class="line">No Match for argument: docker-latest-logrotate</span><br><span class="line">No Match for argument: docker-logrotate</span><br><span class="line">No Match for argument: docker-engine</span><br><span class="line">No Packages marked for removal</span><br><span class="line">[root@localhost /]#</span><br></pre></td></tr></table></figure><h4 id="二、-安装yum、docker环境依赖"><a href="#二、-安装yum、docker环境依赖" class="headerlink" title="二、 安装yum、docker环境依赖"></a>二、 安装yum、docker环境依赖</h4><p>见到<strong>Complete!</strong>，则安装成功</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost /]# sudo yum install -y yum-utils device-mapper-persistent-data lvm2</span><br><span class="line">Loaded plugins: fastestmirror</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line"> * base: mirrors.aliyun.com</span><br><span class="line"> * extras: mirrors.aliyun.com</span><br><span class="line"> * updates: mirrors.aliyun.com</span><br><span class="line">Resolving Dependencies</span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Running transaction check</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package device-mapper-persistent-data.x86_64 0:0.8.5-2.el7 will be installed</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Processing Dependency: libaio.so.1(LIBAIO_0.4)(64bit) <span class="keyword">for</span> package: device-mapper-persistent-data-0.8.5-2.el7.x86_64</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Processing Dependency: libaio.so.1(LIBAIO_0.1)(64bit) <span class="keyword">for</span> package: device-mapper-persistent-data-0.8.5-2.el7.x86_64</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Processing Dependency: libaio.so.1()(64bit) <span class="keyword">for</span> package: device-mapper-persistent-data-0.8.5-2.el7.x86_64</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package lvm2.x86_64 7:2.02.186-7.el7_8.2 will be installed</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Processing Dependency: lvm2-libs = 7:2.02.186-7.el7_8.2 <span class="keyword">for</span> package: 7:lvm2-2.02.186-7.el7_8.2.x86_64</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Processing Dependency: liblvm2app.so.2.2(Base)(64bit) <span class="keyword">for</span> package: 7:lvm2-2.02.186-7.el7_8.2.x86_64</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Processing Dependency: libdevmapper-event.so.1.02(Base)(64bit) <span class="keyword">for</span> package: 7:lvm2-2.02.186-7.el7_8.2.x86_64</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Processing Dependency: liblvm2app.so.2.2()(64bit) <span class="keyword">for</span> package: 7:lvm2-2.02.186-7.el7_8.2.x86_64</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Processing Dependency: libdevmapper-event.so.1.02()(64bit) <span class="keyword">for</span> package: 7:lvm2-2.02.186-7.el7_8.2.x86_64</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package yum-utils.noarch 0:1.1.31-50.el7 will be updated</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package yum-utils.noarch 0:1.1.31-54.el7_8 will be an update</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Running transaction check</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package device-mapper-event-libs.x86_64 7:1.02.164-7.el7_8.2 will be installed</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package libaio.x86_64 0:0.3.109-13.el7 will be installed</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package lvm2-libs.x86_64 7:2.02.186-7.el7_8.2 will be installed</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Processing Dependency: device-mapper-event = 7:1.02.164-7.el7_8.2 <span class="keyword">for</span> package: 7:lvm2-libs-2.02.186-7.el7_8.2.x86_64</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Running transaction check</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package device-mapper-event.x86_64 7:1.02.164-7.el7_8.2 will be installed</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Processing Dependency: device-mapper = 7:1.02.164-7.el7_8.2 <span class="keyword">for</span> package: 7:device-mapper-event-1.02.164-7.el7_8.2.x86_64</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Running transaction check</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package device-mapper.x86_64 7:1.02.149-10.el7_6.7 will be updated</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Processing Dependency: device-mapper = 7:1.02.149-10.el7_6.7 <span class="keyword">for</span> package: 7:device-mapper-libs-1.02.149-10.el7_6.7.x86_64</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package device-mapper.x86_64 7:1.02.164-7.el7_8.2 will be an update</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Running transaction check</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package device-mapper-libs.x86_64 7:1.02.149-10.el7_6.7 will be updated</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package device-mapper-libs.x86_64 7:1.02.164-7.el7_8.2 will be an update</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Finished Dependency Resolution</span></span><br><span class="line"></span><br><span class="line">Dependencies Resolved</span><br><span class="line"></span><br><span class="line">===================================================================================================================================================================================================================</span><br><span class="line"> Package                                                         Arch                                     Version                                                  Repository                                 Size</span><br><span class="line">===================================================================================================================================================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> device-mapper-persistent-data                                   x86_64                                   0.8.5-2.el7                                              base                                      422 k</span><br><span class="line"> lvm2                                                            x86_64                                   7:2.02.186-7.el7_8.2                                     updates                                   1.3 M</span><br><span class="line">Updating:</span><br><span class="line"> yum-utils                                                       noarch                                   1.1.31-54.el7_8                                          updates                                   122 k</span><br><span class="line">Installing for dependencies:</span><br><span class="line"> device-mapper-event                                             x86_64                                   7:1.02.164-7.el7_8.2                                     updates                                   191 k</span><br><span class="line"> device-mapper-event-libs                                        x86_64                                   7:1.02.164-7.el7_8.2                                     updates                                   190 k</span><br><span class="line"> libaio                                                          x86_64                                   0.3.109-13.el7                                           base                                       24 k</span><br><span class="line"> lvm2-libs                                                       x86_64                                   7:2.02.186-7.el7_8.2                                     updates                                   1.1 M</span><br><span class="line">Updating for dependencies:</span><br><span class="line"> device-mapper                                                   x86_64                                   7:1.02.164-7.el7_8.2                                     updates                                   295 k</span><br><span class="line"> device-mapper-libs                                              x86_64                                   7:1.02.164-7.el7_8.2                                     updates                                   324 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">===================================================================================================================================================================================================================</span><br><span class="line">Install  2 Packages (+4 Dependent packages)</span><br><span class="line">Upgrade  1 Package  (+2 Dependent packages)</span><br><span class="line"></span><br><span class="line">Total download size: 3.9 M</span><br><span class="line">Downloading packages:</span><br><span class="line">No Presto metadata available for updates</span><br><span class="line">(1/9): device-mapper-1.02.164-7.el7_8.2.x86_64.rpm                                                                                                                                          | 295 kB  00:00:00</span><br><span class="line">(2/9): device-mapper-event-1.02.164-7.el7_8.2.x86_64.rpm                                                                                                                                    | 191 kB  00:00:00</span><br><span class="line">(3/9): device-mapper-event-libs-1.02.164-7.el7_8.2.x86_64.rpm                                                                                                                               | 190 kB  00:00:00</span><br><span class="line">(4/9): device-mapper-libs-1.02.164-7.el7_8.2.x86_64.rpm                                                                                                                                     | 324 kB  00:00:00</span><br><span class="line">(5/9): libaio-0.3.109-13.el7.x86_64.rpm                                                                                                                                                     |  24 kB  00:00:00</span><br><span class="line">(6/9): device-mapper-persistent-data-0.8.5-2.el7.x86_64.rpm                                                                                                                                 | 422 kB  00:00:00</span><br><span class="line">(7/9): lvm2-2.02.186-7.el7_8.2.x86_64.rpm                                                                                                                                                   | 1.3 MB  00:00:01</span><br><span class="line">(8/9): lvm2-libs-2.02.186-7.el7_8.2.x86_64.rpm                                                                                                                                              | 1.1 MB  00:00:00</span><br><span class="line">(9/9): yum-utils-1.1.31-54.el7_8.noarch.rpm                                                                                                                                                 | 122 kB  00:00:00</span><br><span class="line">-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line">Total                                                                                                                                                                              2.3 MB/s | 3.9 MB  00:00:01</span><br><span class="line">Running transaction check</span><br><span class="line">Running transaction test</span><br><span class="line">Transaction test succeeded</span><br><span class="line">Running transaction</span><br><span class="line">  Installing : libaio-0.3.109-13.el7.x86_64                                                                                                                                                                   1/12</span><br><span class="line">  Updating   : 7:device-mapper-libs-1.02.164-7.el7_8.2.x86_64                                                                                                                                                 2/12</span><br><span class="line">  Updating   : 7:device-mapper-1.02.164-7.el7_8.2.x86_64                                                                                                                                                      3/12</span><br><span class="line">  Installing : 7:device-mapper-event-libs-1.02.164-7.el7_8.2.x86_64                                                                                                                                           4/12</span><br><span class="line">  Installing : 7:device-mapper-event-1.02.164-7.el7_8.2.x86_64                                                                                                                                                5/12</span><br><span class="line">  Installing : 7:lvm2-libs-2.02.186-7.el7_8.2.x86_64                                                                                                                                                          6/12</span><br><span class="line">  Installing : device-mapper-persistent-data-0.8.5-2.el7.x86_64                                                                                                                                               7/12</span><br><span class="line">  Installing : 7:lvm2-2.02.186-7.el7_8.2.x86_64                                                                                                                                                               8/12</span><br><span class="line">  Updating   : yum-utils-1.1.31-54.el7_8.noarch                                                                                                                                                               9/12</span><br><span class="line">  Cleanup    : yum-utils-1.1.31-50.el7.noarch                                                                                                                                                                10/12</span><br><span class="line">  Cleanup    : 7:device-mapper-libs-1.02.149-10.el7_6.7.x86_64                                                                                                                                               11/12</span><br><span class="line">  Cleanup    : 7:device-mapper-1.02.149-10.el7_6.7.x86_64                                                                                                                                                    12/12</span><br><span class="line">  Verifying  : 7:device-mapper-1.02.164-7.el7_8.2.x86_64                                                                                                                                                      1/12</span><br><span class="line">  Verifying  : device-mapper-persistent-data-0.8.5-2.el7.x86_64                                                                                                                                               2/12</span><br><span class="line">  Verifying  : 7:lvm2-libs-2.02.186-7.el7_8.2.x86_64                                                                                                                                                          3/12</span><br><span class="line">  Verifying  : 7:device-mapper-event-1.02.164-7.el7_8.2.x86_64                                                                                                                                                4/12</span><br><span class="line">  Verifying  : 7:lvm2-2.02.186-7.el7_8.2.x86_64                                                                                                                                                               5/12</span><br><span class="line">  Verifying  : 7:device-mapper-libs-1.02.164-7.el7_8.2.x86_64                                                                                                                                                 6/12</span><br><span class="line">  Verifying  : libaio-0.3.109-13.el7.x86_64                                                                                                                                                                   7/12</span><br><span class="line">  Verifying  : yum-utils-1.1.31-54.el7_8.noarch                                                                                                                                                               8/12</span><br><span class="line">  Verifying  : 7:device-mapper-event-libs-1.02.164-7.el7_8.2.x86_64                                                                                                                                           9/12</span><br><span class="line">  Verifying  : 7:device-mapper-libs-1.02.149-10.el7_6.7.x86_64                                                                                                                                               10/12</span><br><span class="line">  Verifying  : yum-utils-1.1.31-50.el7.noarch                                                                                                                                                                11/12</span><br><span class="line">  Verifying  : 7:device-mapper-1.02.149-10.el7_6.7.x86_64                                                                                                                                                    12/12</span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  device-mapper-persistent-data.x86_64 0:0.8.5-2.el7                                                                lvm2.x86_64 7:2.02.186-7.el7_8.2</span><br><span class="line"></span><br><span class="line">Dependency Installed:</span><br><span class="line">  device-mapper-event.x86_64 7:1.02.164-7.el7_8.2           device-mapper-event-libs.x86_64 7:1.02.164-7.el7_8.2           libaio.x86_64 0:0.3.109-13.el7           lvm2-libs.x86_64 7:2.02.186-7.el7_8.2</span><br><span class="line"></span><br><span class="line">Updated:</span><br><span class="line">  yum-utils.noarch 0:1.1.31-54.el7_8</span><br><span class="line"></span><br><span class="line">Dependency Updated:</span><br><span class="line">  device-mapper.x86_64 7:1.02.164-7.el7_8.2                                                             device-mapper-libs.x86_64 7:1.02.164-7.el7_8.2</span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line">[root@localhost /]#</span><br></pre></td></tr></table></figure><h4 id="三、-配置docker源"><a href="#三、-配置docker源" class="headerlink" title="三、 配置docker源"></a>三、 配置docker源</h4><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost /]# sudo yum-config-manager -y --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class="line">Loaded plugins: fastestmirror</span><br><span class="line">adding repo from: https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class="line">grabbing file https://download.docker.com/linux/centos/docker-ce.repo to /etc/yum.repos.d/docker-ce.repo</span><br><span class="line">repo saved to /etc/yum.repos.d/docker-ce.repo</span><br><span class="line">[root@localhost /]#</span><br><span class="line">[root@localhost /]# cd /etc/yum.repos.d/</span><br><span class="line">[root@localhost yum.repos.d]# ls</span><br><span class="line">backup  CentOS-Base.repo  docker-ce.repo</span><br><span class="line">[root@localhost yum.repos.d]#</span><br></pre></td></tr></table></figure><h4 id="四、-安装docker-ce-cli客户端、docker-ce服务端"><a href="#四、-安装docker-ce-cli客户端、docker-ce服务端" class="headerlink" title="四、 安装docker-ce-cli客户端、docker-ce服务端"></a>四、 安装docker-ce-cli客户端、docker-ce服务端</h4><p>见到<strong>Complete!</strong>，则安装成功</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost /]# sudo yum install -y docker-ce docker-ce-cli containerd.io</span><br><span class="line">Loaded plugins: fastestmirror</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line"> * base: mirrors.aliyun.com</span><br><span class="line"> * extras: mirrors.aliyun.com</span><br><span class="line"> * updates: mirrors.aliyun.com</span><br><span class="line">docker-ce-stable                                                                                                                                                                            | 3.5 kB  00:00:00</span><br><span class="line">(1/2): docker-ce-stable/x86_64/updateinfo                                                                                                                                                   |   55 B  00:00:00</span><br><span class="line">(2/2): docker-ce-stable/x86_64/primary_db                                                                                                                                                   |  44 kB  00:00:01</span><br><span class="line">Resolving Dependencies</span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Running transaction check</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package containerd.io.x86_64 0:1.2.13-3.2.el7 will be installed</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Processing Dependency: container-selinux &gt;= 2:2.74 <span class="keyword">for</span> package: containerd.io-1.2.13-3.2.el7.x86_64</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package docker-ce.x86_64 3:19.03.11-3.el7 will be installed</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Processing Dependency: libcgroup <span class="keyword">for</span> package: 3:docker-ce-19.03.11-3.el7.x86_64</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package docker-ce-cli.x86_64 1:19.03.11-3.el7 will be installed</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Running transaction check</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package container-selinux.noarch 2:2.119.1-1.c57a6f9.el7 will be installed</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Processing Dependency: policycoreutils-python <span class="keyword">for</span> package: 2:container-selinux-2.119.1-1.c57a6f9.el7.noarch</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package libcgroup.x86_64 0:0.41-21.el7 will be installed</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Running transaction check</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package policycoreutils-python.x86_64 0:2.5-34.el7 will be installed</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Processing Dependency: policycoreutils = 2.5-34.el7 <span class="keyword">for</span> package: policycoreutils-python-2.5-34.el7.x86_64</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Processing Dependency: setools-libs &gt;= 3.3.8-4 <span class="keyword">for</span> package: policycoreutils-python-2.5-34.el7.x86_64</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Processing Dependency: libsemanage-python &gt;= 2.5-14 <span class="keyword">for</span> package: policycoreutils-python-2.5-34.el7.x86_64</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Processing Dependency: audit-libs-python &gt;= 2.1.3-4 <span class="keyword">for</span> package: policycoreutils-python-2.5-34.el7.x86_64</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Processing Dependency: python-IPy <span class="keyword">for</span> package: policycoreutils-python-2.5-34.el7.x86_64</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Processing Dependency: libqpol.so.1(VERS_1.4)(64bit) <span class="keyword">for</span> package: policycoreutils-python-2.5-34.el7.x86_64</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Processing Dependency: libqpol.so.1(VERS_1.2)(64bit) <span class="keyword">for</span> package: policycoreutils-python-2.5-34.el7.x86_64</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Processing Dependency: libapol.so.4(VERS_4.0)(64bit) <span class="keyword">for</span> package: policycoreutils-python-2.5-34.el7.x86_64</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Processing Dependency: checkpolicy <span class="keyword">for</span> package: policycoreutils-python-2.5-34.el7.x86_64</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Processing Dependency: libqpol.so.1()(64bit) <span class="keyword">for</span> package: policycoreutils-python-2.5-34.el7.x86_64</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Processing Dependency: libapol.so.4()(64bit) <span class="keyword">for</span> package: policycoreutils-python-2.5-34.el7.x86_64</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Running transaction check</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package audit-libs-python.x86_64 0:2.8.5-4.el7 will be installed</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Processing Dependency: audit-libs(x86-64) = 2.8.5-4.el7 <span class="keyword">for</span> package: audit-libs-python-2.8.5-4.el7.x86_64</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package checkpolicy.x86_64 0:2.5-8.el7 will be installed</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package libsemanage-python.x86_64 0:2.5-14.el7 will be installed</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package policycoreutils.x86_64 0:2.5-29.el7_6.1 will be updated</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package policycoreutils.x86_64 0:2.5-34.el7 will be an update</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package python-IPy.noarch 0:0.75-6.el7 will be installed</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package setools-libs.x86_64 0:3.3.8-4.el7 will be installed</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Running transaction check</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package audit-libs.x86_64 0:2.8.4-4.el7 will be updated</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Processing Dependency: audit-libs(x86-64) = 2.8.4-4.el7 <span class="keyword">for</span> package: audit-2.8.4-4.el7.x86_64</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package audit-libs.x86_64 0:2.8.5-4.el7 will be an update</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Running transaction check</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package audit.x86_64 0:2.8.4-4.el7 will be updated</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package audit.x86_64 0:2.8.5-4.el7 will be an update</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Finished Dependency Resolution</span></span><br><span class="line"></span><br><span class="line">Dependencies Resolved</span><br><span class="line"></span><br><span class="line">===================================================================================================================================================================================================================</span><br><span class="line"> Package                                                 Arch                                    Version                                                   Repository                                         Size</span><br><span class="line">===================================================================================================================================================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> containerd.io                                           x86_64                                  1.2.13-3.2.el7                                            docker-ce-stable                                   25 M</span><br><span class="line"> docker-ce                                               x86_64                                  3:19.03.11-3.el7                                          docker-ce-stable                                   24 M</span><br><span class="line"> docker-ce-cli                                           x86_64                                  1:19.03.11-3.el7                                          docker-ce-stable                                   38 M</span><br><span class="line">Installing for dependencies:</span><br><span class="line"> audit-libs-python                                       x86_64                                  2.8.5-4.el7                                               base                                               76 k</span><br><span class="line"> checkpolicy                                             x86_64                                  2.5-8.el7                                                 base                                              295 k</span><br><span class="line"> container-selinux                                       noarch                                  2:2.119.1-1.c57a6f9.el7                                   extras                                             40 k</span><br><span class="line"> libcgroup                                               x86_64                                  0.41-21.el7                                               base                                               66 k</span><br><span class="line"> libsemanage-python                                      x86_64                                  2.5-14.el7                                                base                                              113 k</span><br><span class="line"> policycoreutils-python                                  x86_64                                  2.5-34.el7                                                base                                              457 k</span><br><span class="line"> python-IPy                                              noarch                                  0.75-6.el7                                                base                                               32 k</span><br><span class="line"> setools-libs                                            x86_64                                  3.3.8-4.el7                                               base                                              620 k</span><br><span class="line">Updating for dependencies:</span><br><span class="line"> audit                                                   x86_64                                  2.8.5-4.el7                                               base                                              256 k</span><br><span class="line"> audit-libs                                              x86_64                                  2.8.5-4.el7                                               base                                              102 k</span><br><span class="line"> policycoreutils                                         x86_64                                  2.5-34.el7                                                base                                              917 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">===================================================================================================================================================================================================================</span><br><span class="line">Install  3 Packages (+8 Dependent packages)</span><br><span class="line">Upgrade             ( 3 Dependent packages)</span><br><span class="line"></span><br><span class="line">Total download size: 91 M</span><br><span class="line">Downloading packages:</span><br><span class="line">No Presto metadata available for base</span><br><span class="line">(1/14): audit-libs-2.8.5-4.el7.x86_64.rpm                                                                                                                                                   | 102 kB  00:00:00</span><br><span class="line">(2/14): audit-libs-python-2.8.5-4.el7.x86_64.rpm                                                                                                                                            |  76 kB  00:00:00</span><br><span class="line">(3/14): audit-2.8.5-4.el7.x86_64.rpm                                                                                                                                                        | 256 kB  00:00:00</span><br><span class="line">(4/14): checkpolicy-2.5-8.el7.x86_64.rpm                                                                                                                                                    | 295 kB  00:00:00</span><br><span class="line">(5/14): container-selinux-2.119.1-1.c57a6f9.el7.noarch.rpm                                                                                                                                  |  40 kB  00:00:00</span><br><span class="line">warning: /var/cache/yum/x86_64/7/docker-ce-stable/packages/containerd.io-1.2.13-3.2.el7.x86_64.rpm: Header V4 RSA/SHA512 Signature, key ID 621e9f35: NOKEY                       ] 2.0 MB/s |  45 MB  00:00:22 ETA</span><br><span class="line">Public key for containerd.io-1.2.13-3.2.el7.x86_64.rpm is not installed</span><br><span class="line">(6/14): containerd.io-1.2.13-3.2.el7.x86_64.rpm                                                                                                                                             |  25 MB  00:00:32</span><br><span class="line">(7/14): libcgroup-0.41-21.el7.x86_64.rpm                                                                                                                                                    |  66 kB  00:00:00</span><br><span class="line">(8/14): libsemanage-python-2.5-14.el7.x86_64.rpm                                                                                                                                            | 113 kB  00:00:00</span><br><span class="line">(9/14): policycoreutils-python-2.5-34.el7.x86_64.rpm                                                                                                                                        | 457 kB  00:00:01</span><br><span class="line">(10/14): python-IPy-0.75-6.el7.noarch.rpm                                                                                                                                                   |  32 kB  00:00:00</span><br><span class="line">(11/14): setools-libs-3.3.8-4.el7.x86_64.rpm                                                                                                                                                | 620 kB  00:00:00</span><br><span class="line">(12/14): policycoreutils-2.5-34.el7.x86_64.rpm                                                                                                                                              | 917 kB  00:00:02</span><br><span class="line">(13/14): docker-ce-19.03.11-3.el7.x86_64.rpm                                                                                                                                                |  24 MB  00:00:36</span><br><span class="line">(14/14): docker-ce-cli-19.03.11-3.el7.x86_64.rpm                                                                                                                                            |  38 MB  00:00:28</span><br><span class="line">-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line">Total                                                                                                                                                                              1.5 MB/s |  91 MB  00:01:01</span><br><span class="line">Retrieving key from https://download.docker.com/linux/centos/gpg</span><br><span class="line">Importing GPG key 0x621E9F35:</span><br><span class="line"> Userid     : "Docker Release (CE rpm) &lt;docker@docker.com&gt;"</span><br><span class="line"> Fingerprint: 060a 61c5 1b55 8a7f 742b 77aa c52f eb6b 621e 9f35</span><br><span class="line"> From       : https://download.docker.com/linux/centos/gpg</span><br><span class="line">Running transaction check</span><br><span class="line">Running transaction test</span><br><span class="line">Transaction test succeeded</span><br><span class="line">Running transaction</span><br><span class="line">  Updating   : audit-libs-2.8.5-4.el7.x86_64                                                                                                                                                                  1/17</span><br><span class="line">  Updating   : policycoreutils-2.5-34.el7.x86_64                                                                                                                                                              2/17</span><br><span class="line">  Installing : libcgroup-0.41-21.el7.x86_64                                                                                                                                                                   3/17</span><br><span class="line">  Installing : audit-libs-python-2.8.5-4.el7.x86_64                                                                                                                                                           4/17</span><br><span class="line">  Installing : python-IPy-0.75-6.el7.noarch                                                                                                                                                                   5/17</span><br><span class="line">  Installing : setools-libs-3.3.8-4.el7.x86_64                                                                                                                                                                6/17</span><br><span class="line">  Installing : libsemanage-python-2.5-14.el7.x86_64                                                                                                                                                           7/17</span><br><span class="line">  Installing : 1:docker-ce-cli-19.03.11-3.el7.x86_64                                                                                                                                                          8/17</span><br><span class="line">  Installing : checkpolicy-2.5-8.el7.x86_64                                                                                                                                                                   9/17</span><br><span class="line">  Installing : policycoreutils-python-2.5-34.el7.x86_64                                                                                                                                                      10/17</span><br><span class="line">  Installing : 2:container-selinux-2.119.1-1.c57a6f9.el7.noarch                                                                                                                                              11/17</span><br><span class="line">  Installing : containerd.io-1.2.13-3.2.el7.x86_64                                                                                                                                                           12/17</span><br><span class="line">  Installing : 3:docker-ce-19.03.11-3.el7.x86_64                                                                                                                                                             13/17</span><br><span class="line">  Updating   : audit-2.8.5-4.el7.x86_64                                                                                                                                                                      14/17</span><br><span class="line">  Cleanup    : policycoreutils-2.5-29.el7_6.1.x86_64                                                                                                                                                         15/17</span><br><span class="line">  Cleanup    : audit-2.8.4-4.el7.x86_64                                                                                                                                                                      16/17</span><br><span class="line">  Cleanup    : audit-libs-2.8.4-4.el7.x86_64                                                                                                                                                                 17/17</span><br><span class="line">  Verifying  : 2:container-selinux-2.119.1-1.c57a6f9.el7.noarch                                                                                                                                               1/17</span><br><span class="line">  Verifying  : audit-libs-2.8.5-4.el7.x86_64                                                                                                                                                                  2/17</span><br><span class="line">  Verifying  : checkpolicy-2.5-8.el7.x86_64                                                                                                                                                                   3/17</span><br><span class="line">  Verifying  : audit-2.8.5-4.el7.x86_64                                                                                                                                                                       4/17</span><br><span class="line">  Verifying  : 1:docker-ce-cli-19.03.11-3.el7.x86_64                                                                                                                                                          5/17</span><br><span class="line">  Verifying  : policycoreutils-2.5-34.el7.x86_64                                                                                                                                                              6/17</span><br><span class="line">  Verifying  : libsemanage-python-2.5-14.el7.x86_64                                                                                                                                                           7/17</span><br><span class="line">  Verifying  : containerd.io-1.2.13-3.2.el7.x86_64                                                                                                                                                            8/17</span><br><span class="line">  Verifying  : setools-libs-3.3.8-4.el7.x86_64                                                                                                                                                                9/17</span><br><span class="line">  Verifying  : python-IPy-0.75-6.el7.noarch                                                                                                                                                                  10/17</span><br><span class="line">  Verifying  : policycoreutils-python-2.5-34.el7.x86_64                                                                                                                                                      11/17</span><br><span class="line">  Verifying  : audit-libs-python-2.8.5-4.el7.x86_64                                                                                                                                                          12/17</span><br><span class="line">  Verifying  : 3:docker-ce-19.03.11-3.el7.x86_64                                                                                                                                                             13/17</span><br><span class="line">  Verifying  : libcgroup-0.41-21.el7.x86_64                                                                                                                                                                  14/17</span><br><span class="line">  Verifying  : audit-libs-2.8.4-4.el7.x86_64                                                                                                                                                                 15/17</span><br><span class="line">  Verifying  : audit-2.8.4-4.el7.x86_64                                                                                                                                                                      16/17</span><br><span class="line">  Verifying  : policycoreutils-2.5-29.el7_6.1.x86_64                                                                                                                                                         17/17</span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  containerd.io.x86_64 0:1.2.13-3.2.el7                                  docker-ce.x86_64 3:19.03.11-3.el7                                  docker-ce-cli.x86_64 1:19.03.11-3.el7</span><br><span class="line"></span><br><span class="line">Dependency Installed:</span><br><span class="line">  audit-libs-python.x86_64 0:2.8.5-4.el7        checkpolicy.x86_64 0:2.5-8.el7    container-selinux.noarch 2:2.119.1-1.c57a6f9.el7    libcgroup.x86_64 0:0.41-21.el7    libsemanage-python.x86_64 0:2.5-14.el7</span><br><span class="line">  policycoreutils-python.x86_64 0:2.5-34.el7    python-IPy.noarch 0:0.75-6.el7    setools-libs.x86_64 0:3.3.8-4.el7</span><br><span class="line"></span><br><span class="line">Dependency Updated:</span><br><span class="line">  audit.x86_64 0:2.8.5-4.el7                                       audit-libs.x86_64 0:2.8.5-4.el7                                       policycoreutils.x86_64 0:2.5-34.el7</span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line">[root@localhost /]#</span><br></pre></td></tr></table></figure><h4 id="五、-将当前用户添加到docker用户组"><a href="#五、-将当前用户添加到docker用户组" class="headerlink" title="五、 将当前用户添加到docker用户组"></a>五、 将当前用户添加到docker用户组</h4><p>vagrant为登录用户名称，根据自己机器登录名称设定</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost /]# sudo usermod -aG docker vagrant</span><br><span class="line">[root@localhost /]# sudo usermod -aG docker root</span><br><span class="line">[root@localhost /]#</span><br></pre></td></tr></table></figure><h4 id="六、-设置docker镜像下载源，指定cgroup驱动"><a href="#六、-设置docker镜像下载源，指定cgroup驱动" class="headerlink" title="六、 设置docker镜像下载源，指定cgroup驱动"></a>六、 设置docker镜像下载源，指定cgroup驱动</h4><p>查看/etc/docker下是否有daemon.json文件，如果有手动修改，如果没有则直接执行如下命令</p><ol><li>查看daemon.json是否存在，我这里不存在，执行第2步增加docker配置</li></ol><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost /]# cd /etc/docker/</span><br><span class="line">[root@localhost docker]# ls</span><br><span class="line">key.json</span><br><span class="line">[root@localhost docker]#</span><br></pre></td></tr></table></figure><ol start="2"><li>增加docker配置，并查看配置<br><a href="https://1mbc3b4s.mirror.aliyuncs.com的获取">https://1mbc3b4s.mirror.aliyuncs.com的获取</a>  <a href="https://cr.console.aliyun.com/undefined/instances/mirrors?spm=5176.12901015.0.i12901015.7fcb525ccA1UbT">阿里云镜像地址</a><br>如果之前启动过docker,修改完成之后需要重启<br>sudo systemctl daemon-reload &amp;&amp; sudo systemctl restart docker</li></ol><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-'EOF' </span><br><span class="line">&#123;</span><br><span class="line">    "registry-mirrors": ["https://1mbc3b4s.mirror.aliyuncs.com"],</span><br><span class="line">    "exec-opts": ["native.cgroupdriver=systemd"]</span><br><span class="line">&#125; </span><br><span class="line">EOF</span><br><span class="line">[root@localhost docker]# cat /etc/docker/daemon.json</span><br><span class="line">&#123;</span><br><span class="line">    "registry-mirrors": ["https://1mbc3b4s.mirror.aliyuncs.com"],</span><br><span class="line">    "exec-opts": ["native.cgroupdriver=systemd"]</span><br><span class="line">&#125;</span><br><span class="line">[root@localhost docker]#</span><br></pre></td></tr></table></figure><h4 id="七、-启动docker"><a href="#七、-启动docker" class="headerlink" title="七、 启动docker"></a>七、 启动docker</h4><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost /]# sudo systemctl start docker</span><br><span class="line">[root@localhost /]#</span><br></pre></td></tr></table></figure><h4 id="八、-查看docker是否安装成功"><a href="#八、-查看docker是否安装成功" class="headerlink" title="八、 查看docker是否安装成功"></a>八、 查看docker是否安装成功</h4><p>这里可以看到docker的版本为19.03.11，增加了docker0网络</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost /]# docker info</span><br><span class="line">Client:</span><br><span class="line"> Debug Mode: false</span><br><span class="line"></span><br><span class="line">Server:</span><br><span class="line"> Containers: 0</span><br><span class="line">  Running: 0</span><br><span class="line">  Paused: 0</span><br><span class="line">  Stopped: 0</span><br><span class="line"> Images: 0</span><br><span class="line"> Server Version: 19.03.11</span><br><span class="line"> Storage Driver: overlay2</span><br><span class="line">  Backing Filesystem: xfs</span><br><span class="line">  Supports d_type: true</span><br><span class="line">  Native Overlay Diff: true</span><br><span class="line"> Logging Driver: json-file</span><br><span class="line"> Cgroup Driver: systemd</span><br><span class="line"> Plugins:</span><br><span class="line">  Volume: local</span><br><span class="line">  Network: bridge host ipvlan macvlan null overlay</span><br><span class="line">  Log: awslogs fluentd gcplogs gelf journald json-file local logentries splunk syslog</span><br><span class="line"> Swarm: inactive</span><br><span class="line"> Runtimes: runc</span><br><span class="line"> Default Runtime: runc</span><br><span class="line"> Init Binary: docker-init</span><br><span class="line"> containerd version: 7ad184331fa3e55e52b890ea95e65ba581ae3429</span><br><span class="line"> runc version: dc9208a3303feef5b3839f4323d9beb36df0a9dd</span><br><span class="line"> init version: fec3683</span><br><span class="line"> Security Options:</span><br><span class="line">  seccomp</span><br><span class="line">   Profile: default</span><br><span class="line"> Kernel Version: 3.10.0-957.12.2.el7.x86_64</span><br><span class="line"> Operating System: CentOS Linux 7 (Core)</span><br><span class="line"> OSType: linux</span><br><span class="line"> Architecture: x86_64</span><br><span class="line"> CPUs: 4</span><br><span class="line"> Total Memory: 3.7GiB</span><br><span class="line"> Name: xincan.base.com</span><br><span class="line"> ID: IQSQ:3C2Y:CYZ6:UQVE:VEOH:HCVJ:NNUS:W2E5:NLRE:GAME:NH2L:2XHC</span><br><span class="line"> Docker Root Dir: /var/lib/docker</span><br><span class="line"> Debug Mode: false</span><br><span class="line"> Registry: https://index.docker.io/v1/</span><br><span class="line"> Labels:</span><br><span class="line"> Experimental: false</span><br><span class="line"> Insecure Registries:</span><br><span class="line">  127.0.0.0/8</span><br><span class="line"> Registry Mirrors:</span><br><span class="line">  https://1mbc3b4s.mirror.aliyuncs.com/</span><br><span class="line"> Live Restore Enabled: false</span><br><span class="line"></span><br><span class="line">[root@localhost /]#</span><br><span class="line">[root@localhost /]# ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether 52:54:00:8a:fe:e6 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 10.0.2.15/24 brd 10.0.2.255 scope global noprefixroute dynamic eth0</span><br><span class="line">       valid_lft 70167sec preferred_lft 70167sec</span><br><span class="line">    inet6 fe80::5054:ff:fe8a:fee6/64 scope link</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether 08:00:27:dd:2a:77 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.1.40/24 brd 192.168.1.255 scope global noprefixroute eth1</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::a00:27ff:fedd:2a77/64 scope link</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">4: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default</span><br><span class="line">    link/ether 02:42:49:69:f4:4a brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">[root@localhost /]#</span><br></pre></td></tr></table></figure><h4 id="九、-设置docker开机启动"><a href="#九、-设置docker开机启动" class="headerlink" title="九、 设置docker开机启动"></a>九、 设置docker开机启动</h4><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost /]# sudo systemctl enable docker</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/docker.service to /usr/lib/systemd/system/docker.service.</span><br><span class="line">[root@localhost /]#</span><br></pre></td></tr></table></figure><h4 id="十、-安装docker-compose（墙裂建议）-docker-compose安装文档地址"><a href="#十、-安装docker-compose（墙裂建议）-docker-compose安装文档地址" class="headerlink" title="十、 安装docker-compose（墙裂建议） docker-compose安装文档地址"></a>十、 安装docker-compose（墙裂建议） <a href="https://docs.docker.com/compose/install/">docker-compose安装文档地址</a></h4><ol><li>下载docker-compose<br> sudo curl -L “<a href="https://github.com/docker/compose/releases/download/1.26.0/docker-compose-$">https://github.com/docker/compose/releases/download/1.26.0/docker-compose-$</a>(uname -s)-$(uname -m)” -o /usr/local/bin/docker-compose</li><li>赋予docker-compose权限<br> sudo chmod +x /usr/local/bin/docker-compose</li><li>添加docker-compose软连接<br> sudo ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose</li></ol><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@xincan /]# sudo curl -L "https://github.com/docker/compose/releases/download/1.26.0/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose</span><br><span class="line"><span class="meta">  %</span><span class="bash"> Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span></span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">100   638  100   638    0     0    239      0  0:00:02  0:00:02 --:--:--   239</span><br><span class="line">100 11.6M  100 11.6M    0     0  1208k      0  0:00:09  0:00:09 --:--:-- 2430k</span><br><span class="line">[root@xincan /]# docker-compose --version</span><br><span class="line">-bash: /usr/local/bin/docker-compose: Permission denied</span><br><span class="line">[root@xincan /]# sudo chmod +x /usr/local/bin/docker-compose</span><br><span class="line">[root@xincan /]# sudo ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose</span><br><span class="line">[root@xincan /]# docker-compose --version</span><br><span class="line">docker-compose version 1.26.0, build d4451659</span><br><span class="line">[root@xincan /]#</span><br></pre></td></tr></table></figure><h4 id="十、-安装docker-compose（墙裂建议）"><a href="#十、-安装docker-compose（墙裂建议）" class="headerlink" title="十、 安装docker-compose（墙裂建议）"></a>十、 安装docker-compose（墙裂建议）</h4><ol><li>安装bash-completion<br> yum install -y bash-completion</li><li>赋予docker-compose权限<br> sudo chmod +x /usr/local/bin/docker-compose</li><li>添加docker-compose软连接<br> sudo ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose</li></ol><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@xincan /]#yum install -y bash-completion</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;环境准备&quot;&gt;&lt;a href=&quot;#环境准备&quot; class=&quot;headerlink&quot; title=&quot;环境准备&quot;&gt;&lt;/a&gt;环境准备&lt;/h3&gt;&lt;p&gt;准备一台虚拟机，请参照&lt;a href=&quot;http://xincan.github.io/posts/d05af695/&quot;&gt;centos基础环境构建&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="系统教程" scheme="https://xincan.github.io/categories/%E7%B3%BB%E7%BB%9F%E6%95%99%E7%A8%8B/"/>
    
      <category term="环境构建" scheme="https://xincan.github.io/categories/%E7%B3%BB%E7%BB%9F%E6%95%99%E7%A8%8B/%E7%8E%AF%E5%A2%83%E6%9E%84%E5%BB%BA/"/>
    
    
      <category term="系统教程" scheme="https://xincan.github.io/tags/%E7%B3%BB%E7%BB%9F%E6%95%99%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>centos单机基础环境构建</title>
    <link href="https://xincan.github.io/posts/d05af695/"/>
    <id>https://xincan.github.io/posts/d05af695/</id>
    <published>2020-06-02T01:15:25.000Z</published>
    <updated>2020-06-22T04:00:52.069Z</updated>
    
    <content type="html"><![CDATA[<h3 id="虚拟机配置"><a href="#虚拟机配置" class="headerlink" title="虚拟机配置"></a>虚拟机配置</h3><p> 准备一台虚拟机,本教程是以vagrant+vbox进行构建，默认用户名密码均为vagrant,下面开始设置系统，大家也可以自行安装系统。</p><a id="more"></a><h4 id="一、-关闭防火墙、并设置开机不启动防火墙"><a href="#一、-关闭防火墙、并设置开机不启动防火墙" class="headerlink" title="一、 关闭防火墙、并设置开机不启动防火墙"></a>一、 关闭防火墙、并设置开机不启动防火墙</h4><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl stop firewalld</span><br><span class="line">sudo systemctl disable firewalld</span><br></pre></td></tr></table></figure><h4 id="二、-开启远程访问"><a href="#二、-开启远程访问" class="headerlink" title="二、 开启远程访问"></a>二、 开启远程访问</h4><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo sed -i 's/PasswordAuthentication no/PasswordAuthentication yes/g' /etc/ssh/sshd_config</span><br><span class="line">sudo systemctl restart sshd</span><br></pre></td></tr></table></figure><h4 id="三、-永久关闭selinux"><a href="#三、-永久关闭selinux" class="headerlink" title="三、 永久关闭selinux"></a>三、 永久关闭selinux</h4><p>修改/etc/sysconfig/selinux文件设置</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo sed -i 's/SELINUX=permissive/SELINUX=disabled/' /etc/sysconfig/selinux</span><br><span class="line">sudo sed -i 's/SELINUX=enforcing/SELINUX=disabled/' /etc/sysconfig/selinux</span><br><span class="line">sudo sed -i 's/SELINUX=enforcing/SELINUX=disabled/g' /etc/selinux/config</span><br></pre></td></tr></table></figure><h4 id="四、-禁用swap交换分区"><a href="#四、-禁用swap交换分区" class="headerlink" title="四、 禁用swap交换分区"></a>四、 禁用swap交换分区</h4><p>打开/etc/fstab注释掉swap</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo sed -i 's/.*swap.*/#&amp;/' /etc/fstab</span><br><span class="line">sudo swapoff -a &amp;&amp; swapon -a</span><br><span class="line">sudo sysctl -p</span><br></pre></td></tr></table></figure><h4 id="五、-安装wget"><a href="#五、-安装wget" class="headerlink" title="五、 安装wget"></a>五、 安装wget</h4><p>提示<strong>Complete!</strong>则安装成功</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# sudo yum install -y wget</span><br><span class="line">Loaded plugins: fastestmirror</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line"> * base: mirrors.huaweicloud.com</span><br><span class="line"> * extras: mirrors.huaweicloud.com</span><br><span class="line"> * updates: mirrors.ustc.edu.cn</span><br><span class="line">Resolving Dependencies</span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Running transaction check</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package wget.x86_64 0:1.14-18.el7_6.1 will be installed</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Finished Dependency Resolution</span></span><br><span class="line"></span><br><span class="line">Dependencies Resolved</span><br><span class="line"></span><br><span class="line">===================================================================================================================================================================================================================</span><br><span class="line"> Package                                        Arch                                             Version                                                      Repository                                      Size</span><br><span class="line">===================================================================================================================================================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> wget                                           x86_64                                           1.14-18.el7_6.1                                              base                                           547 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">===================================================================================================================================================================================================================</span><br><span class="line">Install  1 Package</span><br><span class="line"></span><br><span class="line">Total download size: 547 k</span><br><span class="line">Installed size: 2.0 M</span><br><span class="line">Downloading packages:</span><br><span class="line">wget-1.14-18.el7_6.1.x86_64.rpm                                                                                                                                                             | 547 kB  00:00:04</span><br><span class="line">Running transaction check</span><br><span class="line">Running transaction test</span><br><span class="line">Transaction test succeeded</span><br><span class="line">Running transaction</span><br><span class="line">  Installing : wget-1.14-18.el7_6.1.x86_64                                                                                                                                                                     1/1</span><br><span class="line">  Verifying  : wget-1.14-18.el7_6.1.x86_64                                                                                                                                                                     1/1</span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  wget.x86_64 0:1.14-18.el7_6.1</span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line">[root@localhost ~]#</span><br></pre></td></tr></table></figure><h4 id="六、-更改系统默认镜像源为阿里镜像源"><a href="#六、-更改系统默认镜像源为阿里镜像源" class="headerlink" title="六、 更改系统默认镜像源为阿里镜像源"></a>六、 更改系统默认镜像源为阿里镜像源</h4><ol><li>切换到/etc/yum.repos.d/下查看当前镜像源</li></ol><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cd /etc/yum.repos.d/</span><br><span class="line">[root@localhost yum.repos.d]# ll</span><br><span class="line">total 32</span><br><span class="line">-rw-r--r--. 1 root root 1664 Nov 23  2018 CentOS-Base.repo</span><br><span class="line">-rw-r--r--. 1 root root 1309 Nov 23  2018 CentOS-CR.repo</span><br><span class="line">-rw-r--r--. 1 root root  649 Nov 23  2018 CentOS-Debuginfo.repo</span><br><span class="line">-rw-r--r--. 1 root root  314 Nov 23  2018 CentOS-fasttrack.repo</span><br><span class="line">-rw-r--r--. 1 root root  630 Nov 23  2018 CentOS-Media.repo</span><br><span class="line">-rw-r--r--. 1 root root 1331 Nov 23  2018 CentOS-Sources.repo</span><br><span class="line">-rw-r--r--. 1 root root 5701 Nov 23  2018 CentOS-Vault.repo</span><br><span class="line">[root@localhost ~]#</span><br></pre></td></tr></table></figure><ol start="2"><li>切换到/etc/yum.repos.d/目录下创建<strong>backup</strong>文件夹，并将上述镜像源移动到<strong>backup</strong>文件夹下</li></ol><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost yum.repos.d]# sudo mkdir /etc/yum.repos.d/backup &amp;&amp; mv /etc/yum.repos.d/*.repo /etc/yum.repos.d/backup</span><br><span class="line">[root@localhost yum.repos.d]# ll</span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x. 2 root root 187 Jun  4 04:48 backup</span><br><span class="line">[root@localhost yum.repos.d]#</span><br></pre></td></tr></table></figure><ol start="3"><li>拉取阿里云镜像源，看见<strong>saved</strong>则拉取成功</li></ol><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost yum.repos.d]# sudo wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class="line">--2020-06-04 04:48:58--  http://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class="line">Resolving mirrors.aliyun.com (mirrors.aliyun.com)... 124.200.113.116, 124.200.113.115, 219.238.20.87, ...</span><br><span class="line">Connecting to mirrors.aliyun.com (mirrors.aliyun.com)|124.200.113.116|:80... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 2523 (2.5K) [application/octet-stream]</span><br><span class="line">Saving to: '/etc/yum.repos.d/CentOS-Base.repo'</span><br><span class="line"></span><br><span class="line"><span class="meta">100%</span><span class="bash">[=========================================================================================================================================================================&gt;] 2,523       --.-K/s   <span class="keyword">in</span> 0s</span></span><br><span class="line"></span><br><span class="line">2020-06-04 04:48:58 (264 MB/s) - '/etc/yum.repos.d/CentOS-Base.repo' saved [2523/2523]</span><br><span class="line">[root@localhost yum.repos.d]#</span><br></pre></td></tr></table></figure><ol start="4"><li>查看目录结构</li></ol><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost yum.repos.d]# ll</span><br><span class="line">total 4</span><br><span class="line">drwxr-xr-x. 2 root root  187 Jun  4 04:48 backup</span><br><span class="line">-rw-r--r--. 1 root root 2523 Jun 15  2018 CentOS-Base.repo</span><br><span class="line">[root@localhost yum.repos.d]#</span><br></pre></td></tr></table></figure><ol start="5"><li>执行yum clean all清空镜像源缓存</li></ol><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost yum.repos.d]# sudo yum clean all</span><br><span class="line">Loaded plugins: fastestmirror</span><br><span class="line">Cleaning repos: base extras updates</span><br><span class="line">Cleaning up list of fastest mirrors</span><br><span class="line">[root@localhost yum.repos.d]#</span><br></pre></td></tr></table></figure><ol start="6"><li>执行yum makecache重新加载缓存，看到<strong>Metadata Cache Created</strong>则加载成功</li></ol><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost yum.repos.d]# sudo yum makecache</span><br><span class="line">Loaded plugins: fastestmirror</span><br><span class="line">Determining fastest mirrors</span><br><span class="line"> * base: mirrors.aliyun.com</span><br><span class="line"> * extras: mirrors.aliyun.com</span><br><span class="line"> * updates: mirrors.aliyun.com</span><br><span class="line">base                                                                                                                                                                                        | 3.6 kB  00:00:00</span><br><span class="line">extras                                                                                                                                                                                      | 2.9 kB  00:00:00</span><br><span class="line">updates                                                                                                                                                                                     | 2.9 kB  00:00:00</span><br><span class="line">(1/10): base/7/x86_64/group_gz                                                                                                                                                              | 153 kB  00:00:00</span><br><span class="line">(2/10): extras/7/x86_64/filelists_db                                                                                                                                                        | 205 kB  00:00:00</span><br><span class="line">(3/10): extras/7/x86_64/other_db                                                                                                                                                            | 122 kB  00:00:00</span><br><span class="line">(4/10): base/7/x86_64/other_db                                                                                                                                                              | 2.6 MB  00:00:00</span><br><span class="line">(5/10): updates/7/x86_64/primary_db                                                                                                                                                         | 1.3 MB  00:00:00</span><br><span class="line">(6/10): updates/7/x86_64/filelists_db                                                                                                                                                       | 997 kB  00:00:00</span><br><span class="line">(7/10): updates/7/x86_64/other_db                                                                                                                                                           | 192 kB  00:00:00</span><br><span class="line">(8/10): base/7/x86_64/primary_db                                                                                                                                                            | 6.1 MB  00:00:01</span><br><span class="line">(9/10): extras/7/x86_64/primary_db                                                                                                                                                          | 194 kB  00:00:00</span><br><span class="line">(10/10): base/7/x86_64/filelists_db                                                                                                                                                         | 7.1 MB  00:00:02</span><br><span class="line">Metadata Cache Created</span><br><span class="line">[root@localhost yum.repos.d]#</span><br></pre></td></tr></table></figure><h4 id="七、-查看服务器IP地址（非必须）"><a href="#七、-查看服务器IP地址（非必须）" class="headerlink" title="七、 查看服务器IP地址（非必须）"></a>七、 查看服务器IP地址（非必须）</h4><p>我个人的是在eth1下，对应的是192.168.1.40</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether 52:54:00:8a:fe:e6 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 10.0.2.15/24 brd 10.0.2.255 scope global noprefixroute dynamic eth0</span><br><span class="line">       valid_lft 77402sec preferred_lft 77402sec</span><br><span class="line">    inet6 fe80::5054:ff:fe8a:fee6/64 scope link</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether 08:00:27:dd:2a:77 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.1.40/24 brd 192.168.1.255 scope global noprefixroute eth1</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::a00:27ff:fedd:2a77/64 scope link</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">[root@localhost ~]#</span><br></pre></td></tr></table></figure><h4 id="八、-自定义服务器域名（非必须）"><a href="#八、-自定义服务器域名（非必须）" class="headerlink" title="八、 自定义服务器域名（非必须）"></a>八、 自定义服务器域名（<del>非必须</del>）</h4><p>也可以手动修改vi /etc/hostname(需要重启)</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# hostname xincan.base.com</span><br><span class="line">[root@localhost ~]# hostname</span><br><span class="line">xincan.base.com</span><br><span class="line">[root@localhost ~]#</span><br></pre></td></tr></table></figure><h4 id="九、-添加hosts自定义域名映射（非必须）"><a href="#九、-添加hosts自定义域名映射（非必须）" class="headerlink" title="九、 添加hosts自定义域名映射（非必须）"></a>九、 添加hosts自定义域名映射（<del>非必须</del>）</h4><ol><li>修改hosts配置</li></ol><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# vi /etc/hosts</span><br><span class="line">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line">192.168.1.40 xincan.base.com </span><br><span class="line">[root@localhost ~]#</span><br></pre></td></tr></table></figure><ol start="2"><li>查看hosts配置</li></ol><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cat /etc/hosts</span><br><span class="line">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line">192.168.1.40 xincan.base.com</span><br><span class="line">[root@localhost ~]#</span><br></pre></td></tr></table></figure><h4 id="十、-同步阿里云时间（墙裂建议）"><a href="#十、-同步阿里云时间（墙裂建议）" class="headerlink" title="十、 同步阿里云时间（墙裂建议）"></a>十、 同步阿里云时间（墙裂建议）</h4><ol><li>安装ntp，提示<strong>Complete!</strong>则安装成功</li></ol><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# sudo yum install -y ntp</span><br><span class="line">Loaded plugins: fastestmirror</span><br><span class="line">Determining fastest mirrors</span><br><span class="line"> * base: mirrors.huaweicloud.com</span><br><span class="line"> * extras: mirrors.huaweicloud.com</span><br><span class="line"> * updates: mirrors.ustc.edu.cn</span><br><span class="line">base                                                                                                                          | 3.6 kB  00:00:00</span><br><span class="line">extras                                                                                                                        | 2.9 kB  00:00:00</span><br><span class="line">updates                                                                                                                       | 2.9 kB  00:00:00</span><br><span class="line">(1/4): base/7/x86_64/group_gz                                                                                                 | 153 kB  00:00:00</span><br><span class="line">(2/4): extras/7/x86_64/primary_db                                                                                             | 194 kB  00:00:00</span><br><span class="line">(3/4): updates/7/x86_64/primary_db                                                                                            | 2.1 MB  00:00:01</span><br><span class="line">(4/4): base/7/x86_64/primary_db                                                                                               | 6.1 MB  00:00:05</span><br><span class="line">Resolving Dependencies</span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Running transaction check</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package ntp.x86_64 0:4.2.6p5-29.el7.centos will be installed</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Processing Dependency: ntpdate = 4.2.6p5-29.el7.centos <span class="keyword">for</span> package: ntp-4.2.6p5-29.el7.centos.x86_64</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Processing Dependency: libopts.so.25()(64bit) <span class="keyword">for</span> package: ntp-4.2.6p5-29.el7.centos.x86_64</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Running transaction check</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package autogen-libopts.x86_64 0:5.18-5.el7 will be installed</span></span><br><span class="line"><span class="meta">---&gt;</span><span class="bash"> Package ntpdate.x86_64 0:4.2.6p5-29.el7.centos will be installed</span></span><br><span class="line"><span class="meta">--&gt;</span><span class="bash"> Finished Dependency Resolution</span></span><br><span class="line"></span><br><span class="line">Dependencies Resolved</span><br><span class="line"></span><br><span class="line">=====================================================================================================================================================</span><br><span class="line"> Package                                Arch                          Version                                      Repository                   Size</span><br><span class="line">=====================================================================================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> ntp                                    x86_64                        4.2.6p5-29.el7.centos                        base                        548 k</span><br><span class="line">Installing for dependencies:</span><br><span class="line"> autogen-libopts                        x86_64                        5.18-5.el7                                   base                         66 k</span><br><span class="line"> ntpdate                                x86_64                        4.2.6p5-29.el7.centos                        base                         86 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">=====================================================================================================================================================</span><br><span class="line">Install  1 Package (+2 Dependent packages)</span><br><span class="line"></span><br><span class="line">Total download size: 701 k</span><br><span class="line">Installed size: 1.6 M</span><br><span class="line">Downloading packages:</span><br><span class="line">warning: /var/cache/yum/x86_64/7/base/packages/ntpdate-4.2.6p5-29.el7.centos.x86_64.rpm: Header V3 RSA/SHA256 Signature, key ID f4a80eb5: NOKEY- ETA</span><br><span class="line">Public key for ntpdate-4.2.6p5-29.el7.centos.x86_64.rpm is not installed</span><br><span class="line">(1/3): ntpdate-4.2.6p5-29.el7.centos.x86_64.rpm                                                                               |  86 kB  00:00:00</span><br><span class="line">(2/3): autogen-libopts-5.18-5.el7.x86_64.rpm                                                                                  |  66 kB  00:00:00</span><br><span class="line">(3/3): ntp-4.2.6p5-29.el7.centos.x86_64.rpm                                                                                   | 548 kB  00:00:00</span><br><span class="line">-----------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line">Total                                                                                                                956 kB/s | 701 kB  00:00:00</span><br><span class="line">Retrieving key from file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br><span class="line">Importing GPG key 0xF4A80EB5:</span><br><span class="line"> Userid     : "CentOS-7 Key (CentOS 7 Official Signing Key) &lt;security@centos.org&gt;"</span><br><span class="line"> Fingerprint: 6341 ab27 53d7 8a78 a7c2 7bb1 24c6 a8a7 f4a8 0eb5</span><br><span class="line"> Package    : centos-release-7-6.1810.2.el7.centos.x86_64 (@anaconda)</span><br><span class="line"> From       : /etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br><span class="line">Running transaction check</span><br><span class="line">Running transaction test</span><br><span class="line">Transaction test succeeded</span><br><span class="line">Running transaction</span><br><span class="line">  Installing : autogen-libopts-5.18-5.el7.x86_64                                                                                                 1/3</span><br><span class="line">  Installing : ntpdate-4.2.6p5-29.el7.centos.x86_64                                                                                              2/3</span><br><span class="line">  Installing : ntp-4.2.6p5-29.el7.centos.x86_64                                                                                                  3/3</span><br><span class="line">  Verifying  : ntp-4.2.6p5-29.el7.centos.x86_64                                                                                                  1/3</span><br><span class="line">  Verifying  : ntpdate-4.2.6p5-29.el7.centos.x86_64                                                                                              2/3</span><br><span class="line">  Verifying  : autogen-libopts-5.18-5.el7.x86_64                                                                                                 3/3</span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  ntp.x86_64 0:4.2.6p5-29.el7.centos</span><br><span class="line"></span><br><span class="line">Dependency Installed:</span><br><span class="line">  autogen-libopts.x86_64 0:5.18-5.el7                                     ntpdate.x86_64 0:4.2.6p5-29.el7.centos</span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line">[root@localhost ~]#</span><br></pre></td></tr></table></figure><ol start="2"><li>查看当前系统时间、并设置当前时间为上海</li></ol><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost /]# date</span><br><span class="line">Thu Jun  4 05:28:48 UTC 2020</span><br><span class="line">[root@localhost /]# ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span><br><span class="line">[root@localhost /]# date</span><br><span class="line">Thu Jun  4 13:29:01 CST 2020</span><br><span class="line">[root@localhost /]#</span><br></pre></td></tr></table></figure><ol start="3"><li><p>设置ntp，同步阿里云时间，执行vi /etc/ntp.conf<br>找到server四行代码注释掉，在其下面增加<strong>server aliyun.com iburst</strong>，然后通过<strong>sudo systemctl start ntpd</strong>启动服务，稍等一会执行<strong>ntpq -p</strong>查看是否同步，如果出现前面的*则，同步成功</p><p> systemctl start ntpd            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;启动ntp<br> systemctl restart ntpd          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;重启ntp<br> systemctl enable ntpd.service   &nbsp;&nbsp;开机启动<br> ntpdc -c loopinfo               &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;查看与时间同步服务器的时间差</p></li></ol><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost /]# vi /etc/ntp.conf</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> server 0.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> server 1.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> server 2.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> server 3.centos.pool.ntp.org iburst</span></span><br><span class="line"></span><br><span class="line">server ntp.aliyun.com iburst</span><br><span class="line"></span><br><span class="line">[root@localhost /]#</span><br><span class="line">[root@localhost /]# sudo systemctl start ntpd</span><br><span class="line">[root@localhost /]# systemctl enable ntpd.service</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/ntpd.service to /usr/lib/systemd/system/ntpd.service.</span><br><span class="line">[root@localhost /]# ntpq -p</span><br><span class="line">     remote           refid      st t when poll reach   delay   offset  jitter</span><br><span class="line">==============================================================================</span><br><span class="line">*203.107.6.88    10.137.38.86     2 u   37   64    1   53.476   -5.668   2.224</span><br><span class="line">[root@localhost /]#</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;虚拟机配置&quot;&gt;&lt;a href=&quot;#虚拟机配置&quot; class=&quot;headerlink&quot; title=&quot;虚拟机配置&quot;&gt;&lt;/a&gt;虚拟机配置&lt;/h3&gt;&lt;p&gt; 准备一台虚拟机,本教程是以vagrant+vbox进行构建，默认用户名密码均为vagrant,下面开始设置系统，大家也可以自行安装系统。&lt;/p&gt;
    
    </summary>
    
    
      <category term="系统教程" scheme="https://xincan.github.io/categories/%E7%B3%BB%E7%BB%9F%E6%95%99%E7%A8%8B/"/>
    
      <category term="环境构建" scheme="https://xincan.github.io/categories/%E7%B3%BB%E7%BB%9F%E6%95%99%E7%A8%8B/%E7%8E%AF%E5%A2%83%E6%9E%84%E5%BB%BA/"/>
    
    
      <category term="系统教程" scheme="https://xincan.github.io/tags/%E7%B3%BB%E7%BB%9F%E6%95%99%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>加密文章测试</title>
    <link href="https://xincan.github.io/posts/7e709353/"/>
    <id>https://xincan.github.io/posts/7e709353/</id>
    <published>2020-05-30T02:14:11.000Z</published>
    <updated>2020-06-02T12:37:29.588Z</updated>
    
    <content type="html"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="不好意思，密码没对哦，在检查检查呢！" data-whm="不好意思，信息无法验证！">  <div class="hbe-input-container">  <input type="password" id="hbePass" placeholder="" />    <label for="hbePass">嗨，请准确无误地输入密码查看哟（密码：123456）！</label>    <div class="bottom-line"></div>  </div>  <script id="hbeData" type="hbeData" data-hmacdigest="7c9df5696499b0943b0714a90278edc9cdb12f7962c2949648214eee27e824eb">42401e656a30ed09e8e3b0fbe2fbd18ae1b8c2138de0b629bd1233cbc0cc80918b020088b54c79621b8ef9a9af7b0f06b4f358e8c86ef99d097fb161589581b453752da7da2e21aa4d35b94c835c62d1204ab327d5d9241d6be3c6b4b1e68d3697229826ffa52b53920e92cbe496af209269f803aa7450ba136338b0e891ba54f6fe48d0d23c1ba5b981305fdee3badd054b7ad20712af650adf010b25c3fa117b769979c2ef7a2ccccee14b24ed84530b911e7b68c43d9f4592ba8687b2c7fb</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      咦，这是一篇加密文章，好像需要输入密码才能查看呢！
    
    </summary>
    
    
      <category term="private" scheme="https://xincan.github.io/categories/private/"/>
    
    
      <category term="加密文章" scheme="https://xincan.github.io/tags/%E5%8A%A0%E5%AF%86%E6%96%87%E7%AB%A0/"/>
    
  </entry>
  
  <entry>
    <title>不蒜子统计常见问题</title>
    <link href="https://xincan.github.io/posts/89986481/"/>
    <id>https://xincan.github.io/posts/89986481/</id>
    <published>2020-05-29T14:02:05.000Z</published>
    <updated>2020-06-02T12:40:17.724Z</updated>
    
    <content type="html"><![CDATA[<p>不蒜子统计官网：<a href="http://busuanzi.ibruce.info/">http://busuanzi.ibruce.info/</a></p><p>详细使用教程：<a href="http://ibruce.info/2015/04/04/busuanzi/">http://ibruce.info/2015/04/04/busuanzi/</a></p><p>目前支持的功能：（两行代码，搞定计数；方便、简洁、实用）</p><p>a、显示站点总访问量</p><p>b、显示单页面访问量</p><a id="more"></a><p>c、显示站点总访问量和单页面访问量</p><p>d、只计数不显示</p><p>关于怎么实现当天、昨天、本月、上月（即具体时间段）的访问量目前没有支持，请配合目前不蒜子支持的功能自行实现。</p><h3 id="1-常见问题400错误，统计不生效"><a href="#1-常见问题400错误，统计不生效" class="headerlink" title="1.常见问题400错误，统计不生效"></a>1.常见问题400错误，统计不生效</h3><p><img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20191221085006.png" alt="">            </p><p>如图<strong>（1）</strong>的地方没有加载出统计数据</p><p>此时F12打开浏览器控制台，找到<strong>（2）</strong>network地方，刷新一下页面找到<strong>（3）</strong>，请求统计的网址如图所示，查看<strong>（4）</strong>referrer-policy是否如图所示，如图的话是不能访问的，需要更改。</p><p><strong>导致此问题原因</strong>，检查网页源码中，一般header有如下标签</p><p><img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20191221085114.png" alt="">    </p><p><strong>解决方法</strong>，去掉此标签，之后访问如下<strong>（1）</strong>已有统计值，<strong>（2）</strong>已改变。可详细对比正常使用不蒜子统计网址<a href="https://removeif.github.io/">https://removeif.github.io/</a> 中请求<strong>busuanzi?jsonpCallback=BusuanziCallback_236107382952地址</strong>的请求和返回参数的差异！</p><p><img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20191221085231.png" alt=""></p><p><strong>这样设置带来的影响</strong>，可能有些图床的图片不能显示，会图裂，如新浪图床。解决方法，可以用其他不冲突的图床。</p><h3 id="2-统计访问数巨大（清零问题）"><a href="#2-统计访问数巨大（清零问题）" class="headerlink" title="2.统计访问数巨大（清零问题）"></a>2.统计访问数巨大（清零问题）</h3><p><a href="http://localhost:4000/">http://localhost:4000/</a> 或<a href="http://127.0.0.1:4000/">http://127.0.0.1:4000/</a> 访问时，统计数巨大，这是正常的，不用清零。部署到线上，用线上域名网址访问数据就正常了。</p><h3 id="3-统计无法访问如图所示"><a href="#3-统计无法访问如图所示" class="headerlink" title="3.统计无法访问如图所示"></a>3.统计无法访问如图所示</h3><p><img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20191221085258.png" alt=""></p><p>查看红色url部分如下所示</p><p><img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20191221085320.png" alt=""></p><p>此问题是Request URL填写错误，请确保Request URL前部分为<a href="http://busuanzi.ibruce.info/busuanzi?"><strong>http://busuanzi.ibruce.info/busuanzi?</strong></a><strong>，，，，如下</strong></p><p><img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20191221085345.png" alt=""></p><p>同时查看Response，出现如下数据，就是成功访问了不蒜子统计，如果网站中还没出统计数据，就是自己的代码写错了，检查代码</p><p><img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20191221085405.png" alt=""></p><h3 id="4-其余问题"><a href="#4-其余问题" class="headerlink" title="4.其余问题"></a>4.其余问题</h3><p><strong>(1)</strong>.同一个页面，同名的id标签确保只能放一个如下</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"busuanzi_container_site_uv"</span> <span class="attr">style</span>=<span class="string">"display: inline;"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"busuanzi_value_site_uv"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure><p>同一个页面id名为busuanzi_value_site_uv只能放一个!</p><p><strong>(2)</strong>.safari（包括移动端的safari）浏览器页面pv统计问题，如下，因为Safari浏览器referer在文章页面时也上送的域名（而单个页面的pv统计是根据页面路径，即上送的referer），所以此时页面的pv返回的站点的pv值。暂时没解决方法，可自行搜索解决方案构造正确的referer值。对于此问题可以换个浏览器看哇，比如Chrome，哈哈。</p><p><img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20191221085514.png" alt=""></p><p><strong>(3)</strong>.部分live2d可能与不蒜子统计有冲突，出现此问题时，请查看网页源码引用统计id处是否被隐藏，一般网页上会自动加上display: none;自行选择性的使用。网友的解决方法，修改源码为以下，并引用修改后的js文件</p><p>不蒜子源码文件：</p><p><img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20191221085823.png" alt=""></p><p> 修改为如下：</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">var bszCaller, bszTag;</span><br><span class="line"><span class="addition">!function() &#123;</span></span><br><span class="line">    var c, d, e, a = !1, b = [];</span><br><span class="line">    ready = function(c) &#123;</span><br><span class="line">        return a || "interactive" <span class="comment">=== document.readyState || "complete" === document.readyState ? c.call(document) : b.push(function() &#123;</span></span><br><span class="line">            return c.call(this)</span><br><span class="line">        &#125;),</span><br><span class="line">        this</span><br><span class="line">    &#125;</span><br><span class="line">    ,</span><br><span class="line">    d = function() &#123;</span><br><span class="line">        for (var a = 0, c = b.length; c &gt; a; a++)</span><br><span class="line">            b[a].apply(document);</span><br><span class="line">        b = []</span><br><span class="line">    &#125;</span><br><span class="line">    ,</span><br><span class="line">    e = function() &#123;</span><br><span class="line">        a || (a = !0,</span><br><span class="line">        d.call(window),</span><br><span class="line">        document.removeEventListener ? document.removeEventListener("DOMContentLoaded", e, !1) : document.attachEvent &amp;&amp; (document.detachEvent("onreadystatechange", e),</span><br><span class="line">        window == window.top &amp;&amp; (clearInterval(c),</span><br><span class="line">        c = null)))</span><br><span class="line">    &#125;</span><br><span class="line">    ,</span><br><span class="line">    document.addEventListener ? document.addEventListener("DOMContentLoaded", e, !1) : document.attachEvent &amp;&amp; (document.attachEvent("onreadystatechange", function() &#123;</span><br><span class="line">        /loaded|complete/.test(document.readyState) &amp;&amp; e()</span><br><span class="line">    &#125;),</span><br><span class="line">    window == window.top &amp;&amp; (c = setInterval(function() &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            a || document.documentElement.doScroll("left")</span><br><span class="line">        &#125; catch (b) &#123;</span><br><span class="line">            return</span><br><span class="line">        &#125;</span><br><span class="line">        e()</span><br><span class="line">    &#125;, 5)))</span><br><span class="line">&#125;(),</span><br><span class="line">bszCaller = &#123;</span><br><span class="line">    fetch: function(a, b) &#123;</span><br><span class="line">        var c = "BusuanziCallback_" + Math.floor(1099511627776 * Math.random());</span><br><span class="line">        window[c] = this.evalCall(b),</span><br><span class="line">        a = a.replace("=BusuanziCallback", "=" + c),</span><br><span class="line">        scriptTag = document.createElement("SCRIPT"),</span><br><span class="line">        scriptTag.type = "text/javascript",</span><br><span class="line">        scriptTag.defer = !0,</span><br><span class="line">        scriptTag.src = a,</span><br><span class="line">        document.getElementsByTagName("HEAD")[0].appendChild(scriptTag)</span><br><span class="line">    &#125;,</span><br><span class="line">    evalCall: function(a) &#123;</span><br><span class="line">        return function(b) &#123;</span><br><span class="line">            ready(function() &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    a(b), </span><br><span class="line"><span class="deletion">-                      // 此处为修改的逻辑</span></span><br><span class="line"><span class="deletion">-                      scriptTag.parentElement.removeChild(scriptTag)</span></span><br><span class="line"><span class="addition">+                      if(scriptTag != null &amp;&amp; scriptTag.parentElement != null)&#123;</span></span><br><span class="line"><span class="addition">+                       scriptTag.parentElement.removeChild(scriptTag)</span></span><br><span class="line"><span class="addition">+                      &#125;</span></span><br><span class="line">                &#125; catch (c) &#123;</span><br><span class="line">                    bszTag.hides()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br><span class="line">bszCaller.fetch("//busuanzi.ibruce.info/busuanzi?jsonpCallback=BusuanziCallback", function(a) &#123;</span><br><span class="line">    bszTag.texts(a),</span><br><span class="line">    bszTag.shows()</span><br><span class="line">&#125;),</span><br><span class="line">bszTag = &#123;</span><br><span class="line">    bszs: ["site_pv", "page_pv", "site_uv"],</span><br><span class="line">    texts: function(a) &#123;</span><br><span class="line">        this.bszs.map(function(b) &#123;</span><br><span class="line">            var c = document.getElementById("busuanzi_value_" + b);</span><br><span class="line">            c &amp;&amp; (c.innerHTML = a[b])</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    hides: function() &#123;</span><br><span class="line">        this.bszs.map(function(a) &#123;</span><br><span class="line">            var b = document.getElementById("busuanzi_container_" + a);</span><br><span class="line">            b &amp;&amp; (b.style.display = "none")</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    shows: function() &#123;</span><br><span class="line">        this.bszs.map(function(a) &#123;</span><br><span class="line">            var b = document.getElementById("busuanzi_container_" + a);</span><br><span class="line">            b &amp;&amp; (b.style.display = "inline")</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="5-官方群！！！"><a href="#5-官方群！！！" class="headerlink" title="5.官方群！！！"></a>5.官方群！！！</h3><p>群号：419260983，有其余问题进群讨论，<strong>提问时遇到其他的问题请同时发出问题的在线网址！！！</strong></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;不蒜子统计官网：&lt;a href=&quot;http://busuanzi.ibruce.info/&quot;&gt;http://busuanzi.ibruce.info/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;详细使用教程：&lt;a href=&quot;http://ibruce.info/2015/04/04/busuanzi/&quot;&gt;http://ibruce.info/2015/04/04/busuanzi/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;目前支持的功能：（两行代码，搞定计数；方便、简洁、实用）&lt;/p&gt;
&lt;p&gt;a、显示站点总访问量&lt;/p&gt;
&lt;p&gt;b、显示单页面访问量&lt;/p&gt;
    
    </summary>
    
    
      <category term="工具教程" scheme="https://xincan.github.io/categories/%E5%B7%A5%E5%85%B7%E6%95%99%E7%A8%8B/"/>
    
      <category term="博客统计插件" scheme="https://xincan.github.io/categories/%E5%B7%A5%E5%85%B7%E6%95%99%E7%A8%8B/%E5%8D%9A%E5%AE%A2%E7%BB%9F%E8%AE%A1%E6%8F%92%E4%BB%B6/"/>
    
    
      <category term="博客统计插件" scheme="https://xincan.github.io/tags/%E5%8D%9A%E5%AE%A2%E7%BB%9F%E8%AE%A1%E6%8F%92%E4%BB%B6/"/>
    
  </entry>
  
  <entry>
    <title>博客中gitalk最新评论的获取</title>
    <link href="https://xincan.github.io/posts/47c45f64/"/>
    <id>https://xincan.github.io/posts/47c45f64/</id>
    <published>2020-05-28T14:02:05.000Z</published>
    <updated>2020-06-02T12:40:38.204Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>博客中，对于网友的评论以及每篇文章的评论数还是很重要的。但是基于静态的页面想要存储动态的评论数据是比较难的，一般博客主题中都内置了评论插件，但是博客主题中对于最新评论的支持显示还是很少的，至少目前我是没怎么发现。博客 Powered by <a href="http://hexo.io/">Hexo</a> &amp; <a href="http://github.com/ppoffice/hexo-theme-icarus">Icarus</a>，采用<a href="https://github.com/gitalk/gitalk">Gitalk</a>评论，再次感谢此三位作者的辛勤码代码，才有了以下的内容。基于此背景基础上，聊聊最新评论的实现。</p></blockquote><a id="more"></a><p>博客的使用， <a href="http://hexo.io/">Hexo</a> &amp; <a href="http://github.com/ppoffice/hexo-theme-icarus">Icarus</a>，采用<a href="https://github.com/gitalk/gitalk">Gitalk</a>评论 的使用自行百度了。</p><h3 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h3><ul><li>最新评论列表</li><li>最热文章列表（基于评论数判断是否最热，也比较片面，但是侧面也能反映，问题不大）</li></ul><h3 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h3><p>主要参考自<a href="https://developer.github.com/v3/issues/">官方文档</a></p><p>目前主要用到<code>两个方法</code>，一个是获取仓库下所有的issue，每个issue节点下有相关的评论数，以及对应issue下的评论的url;还有一个是根据issue下评论的URL获取相应的所有的评论</p><h4 id="方法1：List-issues-for-a-repository"><a href="#方法1：List-issues-for-a-repository" class="headerlink" title="方法1：List issues for a repository"></a>方法1：<a href="https://developer.github.com/v3/issues/">List issues for a repository</a></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /orgs/:org/issues</span><br></pre></td></tr></table></figure><p>参数列表</p><table><thead><tr><th align="center">Name</th><th align="center">Type</th><th align="center">Description</th></tr></thead><tbody><tr><td align="center"><code>milestone</code></td><td align="center"><code>integer</code> or <code>string</code></td><td align="center">If an <code>integer</code> is passed, it should refer to a milestone by its <code>number</code> field. If the string <code>*</code> is passed, issues with any milestone are accepted. If the string <code>none</code> is passed, issues without milestones are returned.</td></tr><tr><td align="center"><code>state</code></td><td align="center"><code>string</code></td><td align="center">Indicates the state of the issues to return. Can be either <code>open</code>, <code>closed</code>, or <code>all</code>. Default: <code>open</code></td></tr><tr><td align="center"><code>assignee</code></td><td align="center"><code>string</code></td><td align="center">Can be the name of a user. Pass in <code>none</code> for issues with no assigned user, and <code>*</code> for issues assigned to any user.</td></tr><tr><td align="center"><code>creator</code></td><td align="center"><code>string</code></td><td align="center">The user that created the issue.</td></tr><tr><td align="center"><code>mentioned</code></td><td align="center"><code>string</code></td><td align="center">A user that’s mentioned in the issue.</td></tr><tr><td align="center"><code>labels</code></td><td align="center"><code>string</code></td><td align="center">A list of comma separated label names. Example: <code>bug,ui,@high</code></td></tr><tr><td align="center"><code>sort</code></td><td align="center"><code>string</code></td><td align="center">What to sort results by. Can be either <code>created</code>, <code>updated</code>, <code>comments</code>. Default: <code>created</code></td></tr><tr><td align="center"><code>direction</code></td><td align="center"><code>string</code></td><td align="center">The direction of the sort. Can be either <code>asc</code> or <code>desc</code>. Default: <code>desc</code></td></tr><tr><td align="center"><code>since</code></td><td align="center"><code>string</code></td><td align="center">Only issues updated at or after this time are returned. This is a timestamp in <a href="https://en.wikipedia.org/wiki/ISO_8601">ISO 8601</a> format: <code>YYYY-MM-DDTHH:MM:SSZ</code>.</td></tr></tbody></table><p>以上参数，主要用到 <code>sort 排序，page页数，per_page每页数量</code>，其余的参数看个人需要使用。<strong>注意文档中的说明，排序的字段和返回的稍许不太一样。</strong></p><h4 id="方法2：List-comments-on-an-issue"><a href="#方法2：List-comments-on-an-issue" class="headerlink" title="方法2：List comments on an issue"></a>方法2：<a href="https://developer.github.com/v3/issues/comments/">List comments on an issue</a></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /repos/:owner/:repo/issues/:issue_number/comments</span><br></pre></td></tr></table></figure><p>Issue Comments are ordered by ascending ID. 排序根据 ascending (上升的，增长的；升（序）的)ID.也就是说，从老到新。这个比较坑，对于我们获取最新评论来说。</p><p>参数如下</p><table><thead><tr><th align="center">Name</th><th align="center">Type</th><th align="center">Description</th></tr></thead><tbody><tr><td align="center"><code>since</code></td><td align="center"><code>string</code></td><td align="center">Only comments updated at or after this time are returned. This is a timestamp in <a href="https://en.wikipedia.org/wiki/ISO_8601">ISO 8601</a> format: <code>YYYY-MM-DDTHH:MM:SSZ</code>.</td></tr></tbody></table><p>根据尝试以及以上参数，试出<code>不支持排序，但是支持分页，page,per_page参数</code>，对于我们获取最新的评论来说可以根据评论数，算出分页数，拿到最后一条，即最新一条</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//如果只有一页</span></span><br><span class="line"><span class="keyword">int</span> page = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">int</span> per_page = <span class="number">1</span>;</span><br><span class="line"><span class="comment">// 如果超出一页的话</span></span><br><span class="line"><span class="keyword">int</span> page = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">int</span> per_page = commentsNumber-<span class="number">1</span>;<span class="comment">//commentsNumber:评论数</span></span><br></pre></td></tr></table></figure><h4 id="js代码中使用实例核心代码"><a href="#js代码中使用实例核心代码" class="headerlink" title="js代码中使用实例核心代码"></a>js代码中使用实例核心代码</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> timesSet = [];</span><br><span class="line"><span class="keyword">var</span> timesBodyMap = &#123;&#125;;</span><br><span class="line"><span class="keyword">var</span> timesSetMap = &#123;&#125;;</span><br><span class="line"><span class="keyword">var</span> resultArr = [];</span><br><span class="line"><span class="comment">// 方法1：sort=comments可以按评论数排序，此处更适合按更新时间排序,可以根据updated排序，但是0条评论的也会出来，所以此处还是根据评论数排序全部查出来，过滤掉0条评论的，拿到每个issue下最新的一条评论详情和时间，根据时间内存排序</span></span><br><span class="line"><span class="comment">// per_page 每页数量，根据需求配置</span></span><br><span class="line">$.getJSON(<span class="string">"https://api.github.com/repos/&#123;用户名&#125;/&#123;仓库&#125;/issues?per_page=100&amp;sort=comments"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">result</span>) </span>&#123;</span><br><span class="line">    $.each(result, <span class="function"><span class="keyword">function</span> (<span class="params">i, item</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> commentsCount = item.comments;</span><br><span class="line">        <span class="keyword">if</span> (commentsCount &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            $.ajaxSettings.async = <span class="literal">false</span>;</span><br><span class="line">            <span class="comment">// 此处保证是最后一条，api没有排序参数，只能分页取最后一条，保证最少的数据量传输，快速处理</span></span><br><span class="line">            <span class="keyword">var</span> page = <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">var</span> pageSize = commentsCount - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (commentsCount == <span class="number">1</span>) &#123;</span><br><span class="line">                page = <span class="number">1</span>;</span><br><span class="line">                pageSize = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 方法2：的使用</span></span><br><span class="line">            $.getJSON(item.comments_url + <span class="string">"?page="</span> + page + <span class="string">"&amp;per_page="</span> + pageSize, <span class="function"><span class="keyword">function</span> (<span class="params">commentResult</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">var</span> item1 = commentResult[<span class="number">0</span>];</span><br><span class="line">                <span class="keyword">var</span> contentStr = item1.body.trim();</span><br><span class="line">                <span class="keyword">if</span> (contentStr.length &gt; <span class="number">50</span>) &#123;</span><br><span class="line">                    contentStr = contentStr.substr(<span class="number">0</span>, <span class="number">60</span>);</span><br><span class="line">                    contentStr += <span class="string">"..."</span>;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">                timesSet.push(<span class="keyword">new</span> <span class="built_in">Date</span>(item1.created_at).getTime());</span><br><span class="line">                timesBodyMap[item1.created_at] = &#123;</span><br><span class="line">                    <span class="string">"title"</span>: item.title.substr(<span class="number">0</span>, item.title.indexOf(<span class="string">"-"</span>) - <span class="number">1</span>),</span><br><span class="line">                    <span class="string">"url"</span>: item.body.substr(<span class="number">0</span>, item.body.indexOf(<span class="string">"\n"</span>) - <span class="number">1</span>),</span><br><span class="line">                    <span class="string">"content"</span>: contentStr,</span><br><span class="line">                    <span class="string">"date"</span>: item1.created_at,</span><br><span class="line">                    <span class="string">"userName"</span>: item1[<span class="string">"user"</span>].login,</span><br><span class="line">                    <span class="string">"userUrl"</span>: item1[<span class="string">"user"</span>].html_url,</span><br><span class="line">                    <span class="string">"commentCount"</span>: commentsCount</span><br><span class="line">                &#125;;</span><br><span class="line">                timesSetMap[<span class="keyword">new</span> <span class="built_in">Date</span>(item1.created_at).getTime()] = item1.created_at;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 排序</span></span><br><span class="line"><span class="keyword">if</span> (timesSet.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    timesSet.sort();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 根据需要取10条</span></span><br><span class="line"><span class="keyword">if</span> (timesSet.length &gt; <span class="number">10</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = timesSet.length - <span class="number">1</span>; i &gt;= <span class="number">0</span> &amp;&amp; resultArr.length &lt; <span class="number">10</span>; i--) &#123;</span><br><span class="line">        resultArr.push(timesBodyMap[timesSetMap[timesSet[i]]]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = timesSet.length - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        resultArr.push(timesBodyMap[timesSetMap[timesSet[i]]]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="方法1：请求接口地址示例"><a href="#方法1：请求接口地址示例" class="headerlink" title="方法1：请求接口地址示例"></a>方法1：请求接口地址示例</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:<span class="comment">//api.github.com/repos/removeif/blog_comment/issues?per_page=100&amp;sort=comments</span></span><br></pre></td></tr></table></figure><p><strong>返回结果</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">"url"</span>: <span class="string">"https://api.github.com/repos/removeif/blog_comment/issues/3"</span>,</span><br><span class="line">    <span class="attr">"repository_url"</span>: <span class="string">"https://api.github.com/repos/removeif/blog_comment"</span>,</span><br><span class="line">    <span class="attr">"labels_url"</span>: <span class="string">"https://api.github.com/repos/removeif/blog_comment/issues/3/labels&#123;/name&#125;"</span>,</span><br><span class="line">    <span class="attr">"comments_url"</span>: <span class="string">"https://api.github.com/repos/removeif/blog_comment/issues/3/comments"</span>,</span><br><span class="line">    <span class="attr">"events_url"</span>: <span class="string">"https://api.github.com/repos/removeif/blog_comment/issues/3/events"</span>,</span><br><span class="line">    <span class="attr">"html_url"</span>: <span class="string">"https://github.com/removeif/blog_comment/issues/3"</span>,</span><br><span class="line">    <span class="attr">"id"</span>: <span class="number">458985510</span>,</span><br><span class="line">    <span class="attr">"node_id"</span>: <span class="string">"MDU6SXNzdWU0NTg5ODU1MTA="</span>,</span><br><span class="line">    <span class="attr">"number"</span>: <span class="number">3</span>,</span><br><span class="line">    <span class="attr">"title"</span>: <span class="string">"留言板 - 辣椒の酱"</span>,</span><br><span class="line">    <span class="attr">"user"</span>: &#123;</span><br><span class="line">      <span class="attr">"login"</span>: <span class="string">"removeif"</span>,</span><br><span class="line">      <span class="attr">"id"</span>: <span class="number">10427139</span>,</span><br><span class="line">      <span class="attr">"node_id"</span>: <span class="string">"MDQ6VXNlcjEwNDI3MTM5"</span>,</span><br><span class="line">      <span class="attr">"avatar_url"</span>: <span class="string">"https://avatars1.githubusercontent.com/u/10427139?v=4"</span>,</span><br><span class="line">      <span class="attr">"gravatar_id"</span>: <span class="string">""</span>,</span><br><span class="line">      <span class="attr">"url"</span>: <span class="string">"https://api.github.com/users/removeif"</span>,</span><br><span class="line">      <span class="attr">"html_url"</span>: <span class="string">"https://github.com/removeif"</span>,</span><br><span class="line">      <span class="attr">"followers_url"</span>: <span class="string">"https://api.github.com/users/removeif/followers"</span>,</span><br><span class="line">      <span class="attr">"following_url"</span>: <span class="string">"https://api.github.com/users/removeif/following&#123;/other_user&#125;"</span>,</span><br><span class="line">      <span class="attr">"gists_url"</span>: <span class="string">"https://api.github.com/users/removeif/gists&#123;/gist_id&#125;"</span>,</span><br><span class="line">      <span class="attr">"starred_url"</span>: <span class="string">"https://api.github.com/users/removeif/starred&#123;/owner&#125;&#123;/repo&#125;"</span>,</span><br><span class="line">      <span class="attr">"subscriptions_url"</span>: <span class="string">"https://api.github.com/users/removeif/subscriptions"</span>,</span><br><span class="line">      <span class="attr">"organizations_url"</span>: <span class="string">"https://api.github.com/users/removeif/orgs"</span>,</span><br><span class="line">      <span class="attr">"repos_url"</span>: <span class="string">"https://api.github.com/users/removeif/repos"</span>,</span><br><span class="line">      <span class="attr">"events_url"</span>: <span class="string">"https://api.github.com/users/removeif/events&#123;/privacy&#125;"</span>,</span><br><span class="line">      <span class="attr">"received_events_url"</span>: <span class="string">"https://api.github.com/users/removeif/received_events"</span>,</span><br><span class="line">      <span class="attr">"type"</span>: <span class="string">"User"</span>,</span><br><span class="line">      <span class="attr">"site_admin"</span>: <span class="literal">false</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"labels"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"id"</span>: <span class="number">1416043904</span>,</span><br><span class="line">        <span class="attr">"node_id"</span>: <span class="string">"MDU6TGFiZWwxNDE2MDQzOTA0"</span>,</span><br><span class="line">        <span class="attr">"url"</span>: <span class="string">"https://api.github.com/repos/removeif/blog_comment/labels/3306ea6632b94cc388b40cef9dda4a8f"</span>,</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"3306ea6632b94cc388b40cef9dda4a8f"</span>,</span><br><span class="line">        <span class="attr">"color"</span>: <span class="string">"0e8a16"</span>,</span><br><span class="line">        <span class="attr">"default"</span>: <span class="literal">false</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"id"</span>: <span class="number">1415994590</span>,</span><br><span class="line">        <span class="attr">"node_id"</span>: <span class="string">"MDU6TGFiZWwxNDE1OTk0NTkw"</span>,</span><br><span class="line">        <span class="attr">"url"</span>: <span class="string">"https://api.github.com/repos/removeif/blog_comment/labels/Gitalk"</span>,</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"Gitalk"</span>,</span><br><span class="line">        <span class="attr">"color"</span>: <span class="string">"5319e7"</span>,</span><br><span class="line">        <span class="attr">"default"</span>: <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"state"</span>: <span class="string">"open"</span>,</span><br><span class="line">    <span class="attr">"locked"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"assignee"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"assignees"</span>: [</span><br><span class="line"></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"milestone"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"comments"</span>: <span class="number">33</span>,</span><br><span class="line">    <span class="attr">"created_at"</span>: <span class="string">"2019-06-21T03:06:53Z"</span>,</span><br><span class="line">    <span class="attr">"updated_at"</span>: <span class="string">"2019-09-12T10:37:34Z"</span>,</span><br><span class="line">    <span class="attr">"closed_at"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"author_association"</span>: <span class="string">"OWNER"</span>,</span><br><span class="line">    <span class="attr">"body"</span>: <span class="string">"https://removeif.github.io/message/\r\n\r\n留言板信息。"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;...&#125;</span><br><span class="line">  ]</span><br></pre></td></tr></table></figure><h4 id="方法2：请求接口地址示例"><a href="#方法2：请求接口地址示例" class="headerlink" title="方法2：请求接口地址示例"></a>方法2：请求接口地址示例</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:<span class="comment">//api.github.com/repos/removeif/blog_comment/issues/3/comments?per_page=32&amp;page=2</span></span><br></pre></td></tr></table></figure><p><strong>返回结果</strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">"url"</span>: <span class="string">"https://api.github.com/repos/removeif/blog_comment/issues/comments/530767913"</span>,</span><br><span class="line">    <span class="attr">"html_url"</span>: <span class="string">"https://github.com/removeif/blog_comment/issues/3#issuecomment-530767913"</span>,</span><br><span class="line">    <span class="attr">"issue_url"</span>: <span class="string">"https://api.github.com/repos/removeif/blog_comment/issues/3"</span>,</span><br><span class="line">    <span class="attr">"id"</span>: <span class="number">530767913</span>,</span><br><span class="line">    <span class="attr">"node_id"</span>: <span class="string">"MDEyOklzc3VlQ29tbWVudDUzMDc2NzkxMw=="</span>,</span><br><span class="line">    <span class="attr">"user"</span>: &#123;</span><br><span class="line">      <span class="attr">"login"</span>: <span class="string">"removeif"</span>,</span><br><span class="line">      <span class="attr">"id"</span>: <span class="number">10427139</span>,</span><br><span class="line">      <span class="attr">"node_id"</span>: <span class="string">"MDQ6VXNlcjEwNDI3MTM5"</span>,</span><br><span class="line">      <span class="attr">"avatar_url"</span>: <span class="string">"https://avatars1.githubusercontent.com/u/10427139?v=4"</span>,</span><br><span class="line">      <span class="attr">"gravatar_id"</span>: <span class="string">""</span>,</span><br><span class="line">      <span class="attr">"url"</span>: <span class="string">"https://api.github.com/users/removeif"</span>,</span><br><span class="line">      <span class="attr">"html_url"</span>: <span class="string">"https://github.com/removeif"</span>,</span><br><span class="line">      <span class="attr">"followers_url"</span>: <span class="string">"https://api.github.com/users/removeif/followers"</span>,</span><br><span class="line">      <span class="attr">"following_url"</span>: <span class="string">"https://api.github.com/users/removeif/following&#123;/other_user&#125;"</span>,</span><br><span class="line">      <span class="attr">"gists_url"</span>: <span class="string">"https://api.github.com/users/removeif/gists&#123;/gist_id&#125;"</span>,</span><br><span class="line">      <span class="attr">"starred_url"</span>: <span class="string">"https://api.github.com/users/removeif/starred&#123;/owner&#125;&#123;/repo&#125;"</span>,</span><br><span class="line">      <span class="attr">"subscriptions_url"</span>: <span class="string">"https://api.github.com/users/removeif/subscriptions"</span>,</span><br><span class="line">      <span class="attr">"organizations_url"</span>: <span class="string">"https://api.github.com/users/removeif/orgs"</span>,</span><br><span class="line">      <span class="attr">"repos_url"</span>: <span class="string">"https://api.github.com/users/removeif/repos"</span>,</span><br><span class="line">      <span class="attr">"events_url"</span>: <span class="string">"https://api.github.com/users/removeif/events&#123;/privacy&#125;"</span>,</span><br><span class="line">      <span class="attr">"received_events_url"</span>: <span class="string">"https://api.github.com/users/removeif/received_events"</span>,</span><br><span class="line">      <span class="attr">"type"</span>: <span class="string">"User"</span>,</span><br><span class="line">      <span class="attr">"site_admin"</span>: <span class="literal">false</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"created_at"</span>: <span class="string">"2019-09-12T10:37:34Z"</span>,</span><br><span class="line">    <span class="attr">"updated_at"</span>: <span class="string">"2019-09-12T10:37:34Z"</span>,</span><br><span class="line">    <span class="attr">"author_association"</span>: <span class="string">"OWNER"</span>,</span><br><span class="line">    <span class="attr">"body"</span>: <span class="string">"&gt; 哇 大佬你博客弄的好厉害啊  可以指点指点吗\n&gt;&gt; @xuelangjing 还好吧😂，简简单单的，可以多看下网页上的源码，有什么问题可以讨论讨论哦"</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>博客中目前有两个页面使用,根据个人的需要放到各自的位置吧。</p><p><strong><a href="https://removeif.github.io/">首页热门推荐</a></strong></p><p><img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20190913005314.png" alt=""></p><p><strong><a href="https://removeif.github.io/comment/">还有个最新评论页：</a></strong></p><p><img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20190913005510.png" alt=""></p><h3 id="扩展一个方法"><a href="#扩展一个方法" class="headerlink" title="扩展一个方法"></a>扩展一个方法</h3><p>上面的实例程序，<code>每个issue（因为我的每个issue关联一个文章链接）</code>只取了一条最新的评论，假如每个issue下有两个都是最新的评论，而我也不管是不是同一个issue下的评论，获取所有的最新评论，还有一个方法比较好用。</p><h4 id="List-comments-in-a-repository"><a href="#List-comments-in-a-repository" class="headerlink" title="List comments in a repository"></a><a href="https://developer.github.com/v3/issues/comments/#list-comments-in-a-repository">List comments in a repository</a></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /repos/:owner/:repo/issues/comments</span><br></pre></td></tr></table></figure><p>By default, Issue Comments are ordered by ascending ID. 和上面一样，但是以下参数就不一样了</p><table><thead><tr><th align="center">Name</th><th align="center">Type</th><th align="center">Description</th></tr></thead><tbody><tr><td align="center"><code>sort</code></td><td align="center"><code>string</code></td><td align="center">Either <code>created</code> or <code>updated</code>. Default: <code>created</code></td></tr><tr><td align="center"><code>direction</code></td><td align="center"><code>string</code></td><td align="center">Either <code>asc</code> or <code>desc</code>. Ignored without the <code>sort</code> parameter.</td></tr><tr><td align="center"><code>since</code></td><td align="center"><code>string</code></td><td align="center">Only comments updated at or after this time are returned. This is a timestamp in <a href="https://en.wikipedia.org/wiki/ISO_8601">ISO 8601</a> format: <code>YYYY-MM-DDTHH:MM:SSZ</code>.</td></tr></tbody></table><p>多了<code>排序字段和排序方式，也有per和per_page</code>，这是相当的有用啊</p><h4 id="扩展方法：请求接口地址示例"><a href="#扩展方法：请求接口地址示例" class="headerlink" title="扩展方法：请求接口地址示例"></a>扩展方法：请求接口地址示例</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:<span class="comment">//api.github.com/repos/removeif/blog_comment/issues/comments?sort=updated&amp;direction=desc&amp;per_page=10&amp;page=1</span></span><br></pre></td></tr></table></figure><p>返回结果</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">"url"</span>: <span class="string">"https://api.github.com/repos/removeif/blog_comment/issues/comments/530767913"</span>,</span><br><span class="line">    <span class="attr">"html_url"</span>: <span class="string">"https://github.com/removeif/blog_comment/issues/3#issuecomment-530767913"</span>,</span><br><span class="line">    <span class="attr">"issue_url"</span>: <span class="string">"https://api.github.com/repos/removeif/blog_comment/issues/3"</span>,</span><br><span class="line">    <span class="attr">"id"</span>: <span class="number">530767913</span>,</span><br><span class="line">    <span class="attr">"node_id"</span>: <span class="string">"MDEyOklzc3VlQ29tbWVudDUzMDc2NzkxMw=="</span>,</span><br><span class="line">    <span class="attr">"user"</span>: &#123;</span><br><span class="line">      <span class="attr">"login"</span>: <span class="string">"removeif"</span>,</span><br><span class="line">      <span class="attr">"id"</span>: <span class="number">10427139</span>,</span><br><span class="line">      <span class="attr">"node_id"</span>: <span class="string">"MDQ6VXNlcjEwNDI3MTM5"</span>,</span><br><span class="line">      <span class="attr">"avatar_url"</span>: <span class="string">"https://avatars1.githubusercontent.com/u/10427139?v=4"</span>,</span><br><span class="line">      <span class="attr">"gravatar_id"</span>: <span class="string">""</span>,</span><br><span class="line">      <span class="attr">"url"</span>: <span class="string">"https://api.github.com/users/removeif"</span>,</span><br><span class="line">      <span class="attr">"html_url"</span>: <span class="string">"https://github.com/removeif"</span>,</span><br><span class="line">      <span class="attr">"followers_url"</span>: <span class="string">"https://api.github.com/users/removeif/followers"</span>,</span><br><span class="line">      <span class="attr">"following_url"</span>: <span class="string">"https://api.github.com/users/removeif/following&#123;/other_user&#125;"</span>,</span><br><span class="line">      <span class="attr">"gists_url"</span>: <span class="string">"https://api.github.com/users/removeif/gists&#123;/gist_id&#125;"</span>,</span><br><span class="line">      <span class="attr">"starred_url"</span>: <span class="string">"https://api.github.com/users/removeif/starred&#123;/owner&#125;&#123;/repo&#125;"</span>,</span><br><span class="line">      <span class="attr">"subscriptions_url"</span>: <span class="string">"https://api.github.com/users/removeif/subscriptions"</span>,</span><br><span class="line">      <span class="attr">"organizations_url"</span>: <span class="string">"https://api.github.com/users/removeif/orgs"</span>,</span><br><span class="line">      <span class="attr">"repos_url"</span>: <span class="string">"https://api.github.com/users/removeif/repos"</span>,</span><br><span class="line">      <span class="attr">"events_url"</span>: <span class="string">"https://api.github.com/users/removeif/events&#123;/privacy&#125;"</span>,</span><br><span class="line">      <span class="attr">"received_events_url"</span>: <span class="string">"https://api.github.com/users/removeif/received_events"</span>,</span><br><span class="line">      <span class="attr">"type"</span>: <span class="string">"User"</span>,</span><br><span class="line">      <span class="attr">"site_admin"</span>: <span class="literal">false</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"created_at"</span>: <span class="string">"2019-09-12T10:37:34Z"</span>,</span><br><span class="line">    <span class="attr">"updated_at"</span>: <span class="string">"2019-09-12T10:37:34Z"</span>,</span><br><span class="line">    <span class="attr">"author_association"</span>: <span class="string">"OWNER"</span>,</span><br><span class="line">    <span class="attr">"body"</span>: <span class="string">"&gt; 哇 大佬你博客弄的好厉害啊  可以指点指点吗\n&gt;&gt; @xuelangjing 还好吧😂，简简单单的，可以多看下网页上的源码，有什么问题可以讨论讨论哦"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">  ]</span><br></pre></td></tr></table></figure><h4 id="总结此扩展方法"><a href="#总结此扩展方法" class="headerlink" title="总结此扩展方法"></a>总结此扩展方法</h4><p><strong>优点：</strong>对于不在乎issue数量，只在乎最新评论的就比较适用，能够精准拿出前10条，很赞<br><strong>不足：</strong>一个issue下多个最新评论，如果想要显示的最新评论列表还包括文章标题，看起来可能不太好看，很多重复，但是看个人需要吧</p><h4 id="注意事项，采坑环节"><a href="#注意事项，采坑环节" class="headerlink" title="注意事项，采坑环节"></a>注意事项，采坑环节</h4><ul><li>对应接口的请求限制，目前接口有请求的限制，所以使用中不能频繁请求，调试的时候一会儿又限制，一会儿又限制比较麻烦，限制十几分钟之后就解除了。</li><li>对于页面中，一般很多个地方可能都需要展示这个列表，所以不能每次都去请求，必须缓存起来，一般缓存到本地，我的是存的cookie中，十分钟去请求一次，所以调好后一般不会出现限制情况。但是马上评论了的就看不到，有10分钟的延迟，不过也还好。</li><li>对于如果issue以及评论太多的情况，尽量的少请求，比如上面的分页优化，取最后一条。以及页面中请求时做出异步请求的方式，不要阻止其他元素的渲染。</li></ul><p>本人主要做后端，对前端的<code>set/排序</code>不太熟悉，上面实现排序代码比较繁琐😂，如果有什么更好的方法，麻烦也告知一下，互相学习共同进步。</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;博客中，对于网友的评论以及每篇文章的评论数还是很重要的。但是基于静态的页面想要存储动态的评论数据是比较难的，一般博客主题中都内置了评论插件，但是博客主题中对于最新评论的支持显示还是很少的，至少目前我是没怎么发现。博客 Powered by &lt;a href=&quot;http://hexo.io/&quot;&gt;Hexo&lt;/a&gt; &amp;amp; &lt;a href=&quot;http://github.com/ppoffice/hexo-theme-icarus&quot;&gt;Icarus&lt;/a&gt;，采用&lt;a href=&quot;https://github.com/gitalk/gitalk&quot;&gt;Gitalk&lt;/a&gt;评论，再次感谢此三位作者的辛勤码代码，才有了以下的内容。基于此背景基础上，聊聊最新评论的实现。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
      <category term="工具教程" scheme="https://xincan.github.io/categories/%E5%B7%A5%E5%85%B7%E6%95%99%E7%A8%8B/"/>
    
      <category term="主题工具" scheme="https://xincan.github.io/categories/%E5%B7%A5%E5%85%B7%E6%95%99%E7%A8%8B/%E4%B8%BB%E9%A2%98%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="icarus主题配置" scheme="https://xincan.github.io/tags/icarus%E4%B8%BB%E9%A2%98%E9%85%8D%E7%BD%AE/"/>
    
      <category term="hexo主题" scheme="https://xincan.github.io/tags/hexo%E4%B8%BB%E9%A2%98/"/>
    
  </entry>
  
  <entry>
    <title>博客源码分享</title>
    <link href="https://xincan.github.io/posts/1a54ada2/"/>
    <id>https://xincan.github.io/posts/1a54ada2/</id>
    <published>2020-05-27T14:02:05.000Z</published>
    <updated>2020-06-02T12:40:50.860Z</updated>
    
    <content type="html"><![CDATA[<h3 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h3><blockquote><p>博客源码包括两个主题<a href="http://github.com/ppoffice/hexo-theme-icarus">icarus</a>和<a href="https://github.com/iissnan/hexo-theme-next">next</a>，在主题基础之上参照各网友博客，以及自己的一些想法做出的一些修改以及增加部分新元素。  以下是修改后的需要的部分配置，其余的配置参照<a href="http://github.com/ppoffice/hexo-theme-icarus">icarus主题配置</a>和<a href="https://github.com/iissnan/hexo-theme-next">next主题配置</a>。<br>因为修改了原作者源码，有什么问题请先联系我，不要去麻烦原作者了，能自己解决的问题就不要麻烦别人了，每个人的时间都很宝贵。<br>膜拜和感谢所有模块的原作者,orz👻,辛苦了。  </p></blockquote><p>欢迎围观：<a href="https://github.com/removeif/hexo-theme-icarus-removeif.git">博客+主题源码</a>、<a href="https://github.com/removeif/hexo-theme-amazing.git">纯主题源码</a>、<a href="https://removeif.github.io/">博主博客</a></p><a id="more"></a><h3 id="一、icarus主题之上主要改动"><a href="#一、icarus主题之上主要改动" class="headerlink" title="一、icarus主题之上主要改动"></a>一、icarus主题之上主要改动</h3><ul><li>新增gitalk最新评论widget</li><li>首页增加热门推荐</li><li>增加弹性配置影音（可加音乐、视频）模块</li><li>丰富弹性配置about页面</li><li>新增弹性配置友链模块</li><li>整体布局左右拉伸了一点，紧凑一些</li><li>文章页双栏模式、固定导航栏</li><li>引入可配置看板娘</li><li>归档页加入了一个文章贡献概览</li><li>置顶文章的设置</li><li>文章列表评论数显示</li><li>文章中推荐文章模块配置 </li><li>增加深色主题切换</li><li>加入加密文章</li><li>碎碎念功能</li><li>透明无界样式</li><li>简化部分widget数据，加入<code>查看全部</code>按钮</li><li>gitalk评论增加评论开关，评论列表中标记博主</li><li>还有什么新的，好的feature欢迎大家随时提出来，有能力有时间就做出来</li></ul><h3 id="二、部分配置说明："><a href="#二、部分配置说明：" class="headerlink" title="二、部分配置说明："></a>二、部分配置说明：</h3><h4 id="本机环境："><a href="#本机环境：" class="headerlink" title="本机环境："></a>本机环境：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">192:hexo-theme-icarus-removeif xx$ node -v</span><br><span class="line">v11.1.0</span><br><span class="line">192:hexo-theme-icarus-removeif xx$ npm -v</span><br><span class="line">6.4.1</span><br><span class="line">&#96;&#96;&#96;  </span><br><span class="line">#### 克隆博客代码到本地</span><br><span class="line">&#96;&#96;&#96;jshelllanguage</span><br><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;removeif&#x2F;hexo-theme-icarus-removeif.git</span><br></pre></td></tr></table></figure><h4 id="开始部分配置："><a href="#开始部分配置：" class="headerlink" title="开始部分配置："></a>开始部分配置：</h4><p><strong>敲黑板！！！！首先全局以及主题中的<code>_config.yml</code>配置成自己的对应参数。</strong></p><h4 id="1-热门推荐，最新评论："><a href="#1-热门推荐，最新评论：" class="headerlink" title="1.热门推荐，最新评论："></a>1.热门推荐，最新评论：</h4><p><strong>仅针对gitalk评论有效，如果配置完后显示<a href="https://removeif.github.io/">本博客</a>相关评论、推荐，请详细阅读这一条</strong><br>热门推荐，最新评论，文章评论数关联的js文件路径：themes/icarus/source/js/comment-issue-data.js<br>以下引号里的地址改成自己对应的博客评论的issues的仓库相关的值。repoIssuesUrl改两个值（removeif和blog_comment改成自己对应的）</p><figure class="highlight yaml"><figcaption><span>themes/icarus/source/js/comment-issue-data.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">//</span> <span class="string">评论issues仓库</span> <span class="string">by.removeif</span> <span class="string">https://removeif.github.io/</span></span><br><span class="line"><span class="string">var</span> <span class="string">repoIssuesUrl</span> <span class="string">=</span> <span class="string">"https://api.github.com/repos/removeif/blog_comment/issues"</span><span class="string">;</span> <span class="string">//</span> <span class="string">removeif：用户名，blog_comment：评论的issue仓库</span></span><br><span class="line"><span class="string">//</span> <span class="string">评论issues仓库</span> <span class="string">clientId、clientSecret怎么申请自行搜索，关于这暴露两个参数的安全问题，查看</span> <span class="string">https://removeif.github.io/2019/09/19/博客源码分享.html#1-热门推荐，最新评论：</span></span><br><span class="line"><span class="string">var</span> <span class="string">clientId</span> <span class="string">=</span> <span class="string">"46a9f3481b46ea0129d8"</span><span class="string">;</span></span><br><span class="line"><span class="string">var</span> <span class="string">clientSecret</span> <span class="string">=</span> <span class="string">"79c7c9cb847e141757d7864453bcbf89f0655b24"</span><span class="string">;</span></span><br></pre></td></tr></table></figure><p>github api 详情可以参照<a href="https://developer.github.com/v3/#rate-limiting">官方api说明</a><br>关于配置暴露client_id和client_secret安全性问题，gitalk作者有<a href="https://github.com/gitalk/gitalk/issues/150">解释</a><br>对应主题中的<code>_config.yml</code>要开启如下配置，xxx换成自己的，否则无效。</p><figure class="highlight yaml"><figcaption><span>themes/icarus/_config.yml >folded</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">comment:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">gitalk</span></span><br><span class="line">    <span class="attr">owner:</span> <span class="string">xxx</span>         <span class="comment"># (required) GitHub user name</span></span><br><span class="line">    <span class="attr">repo:</span> <span class="string">xxx</span>          <span class="comment"># (required) GitHub repository name</span></span><br><span class="line">    <span class="attr">client_id:</span> <span class="string">xxx</span>     <span class="comment"># (required) OAuth application client id</span></span><br><span class="line">    <span class="attr">client_secret:</span> <span class="string">xxx</span> <span class="comment"># (required) OAuth application client secret</span></span><br><span class="line">    <span class="attr">admin:</span> <span class="string">xxx</span>  <span class="comment">#此账户一般为用户名 GitHub user name 文章中能创建issue需要此用户登录才可以，点了创建issue后刷新一遍才能看到！！！！</span></span><br><span class="line">    <span class="attr">create_issue_manually:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">distraction_free_mode:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">has_hot_recommend:</span> <span class="literal">true</span> <span class="comment"># 是否有热门推荐</span></span><br><span class="line">    <span class="attr">has_latest_comment:</span> <span class="literal">true</span> <span class="comment">#是否有最新评论</span></span><br></pre></td></tr></table></figure><p>说明：</p><ul><li><code>has_hot_recommend: true</code> 是否开启首页热评，false-不开启，true-开启</li><li><code>has_latest_comment: true</code> 是否开启最新评论，false-不开启，true-开启</li><li>热门推荐数据为评论数最多的文章，🔥后面的数字：根据文章的评论数*101 。  </li><li>最新评论：为该仓库下，所有issue中的最新评论。  </li><li>目前的最新评论有1分钟的本地缓存，评论后可能1分钟后才能看见最新评论，出于性能优化，每次请求接口处理还是挺耗时，comment-issue-data.js中可以自己去掉。  </li></ul><h4 id="2-友链数据文件："><a href="#2-友链数据文件：" class="headerlink" title="2.友链数据文件："></a>2.友链数据文件：</h4><p>文件路径：themes/icarus/source/js/friend.js<br>相应格式增加自己需要的数据。</p><h4 id="3-影音数据文件："><a href="#3-影音数据文件：" class="headerlink" title="3.影音数据文件："></a>3.影音数据文件：</h4><p>文件路径：<br>音乐：themes/icarus/source/json_data/music.json<br>视频：themes/icarus/source/json_data/video.json<br>相应格式增加自己需要的数据。    </p><h4 id="4-关于页面时间轴记录数据文件："><a href="#4-关于页面时间轴记录数据文件：" class="headerlink" title="4.关于页面时间轴记录数据文件："></a>4.关于页面时间轴记录数据文件：</h4><p>文件路径：themes/icarus/source/json_data/record.json<br>相应格式增加自己需要的数据。</p><h4 id="5-看板娘配置"><a href="#5-看板娘配置" class="headerlink" title="5.看板娘配置"></a>5.看板娘配置</h4><p>主题中的<code>_config.yml</code>配置如下设置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">live2Dswitch: off #live2D开关 on为打开,off为关闭</span><br></pre></td></tr></table></figure><h4 id="6-置顶设置："><a href="#6-置顶设置：" class="headerlink" title="6.置顶设置："></a>6.置顶设置：</h4><p>.md文章头部数据中加入top值，top值越大越靠前，大于0显示置顶图标。<br>修改依赖包中文件removeif/node_modules/hexo-generator-index/lib/generator.js如下：</p><figure class="highlight js"><figcaption><span>node_modules/hexo-generator-index/lib/generator.js >folded</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"><span class="keyword">const</span> pagination = <span class="built_in">require</span>(<span class="string">'hexo-pagination'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">locals</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> config = <span class="keyword">this</span>.config;</span><br><span class="line">    <span class="keyword">var</span> posts = locals.posts;</span><br><span class="line">    posts.data = posts.data.sort(<span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(a.top == <span class="literal">undefined</span>)&#123;</span><br><span class="line">            a.top = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(b.top == <span class="literal">undefined</span>)&#123;</span><br><span class="line">            b.top = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(a.top == b.top)&#123;</span><br><span class="line">            <span class="keyword">return</span> b.date - a.date;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">           <span class="keyword">return</span> b.top - a.top;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">var</span> paginationDir = config.pagination_dir || <span class="string">'page'</span>;</span><br><span class="line">    <span class="keyword">return</span> pagination(<span class="string">''</span>, posts, &#123;</span><br><span class="line">        perPage: config.index_generator.per_page,</span><br><span class="line">        layout: [<span class="string">'index'</span>, <span class="string">'archive'</span>],</span><br><span class="line">        format: paginationDir + <span class="string">'/%d/'</span>,</span><br><span class="line">        data: &#123;</span><br><span class="line">            __index: <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="7-配置文章中推荐文章模块"><a href="#7-配置文章中推荐文章模块" class="headerlink" title="7.配置文章中推荐文章模块"></a>7.配置文章中推荐文章模块</h4><p>根据配置的recommend值（必须大于0），值越大越靠前，相等取最新的，最多取5条。recommend（6.中top值也在下面示例）配置在.md文章头中，如下  </p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">title:</span> <span class="string">博客源码分享</span></span><br><span class="line"><span class="attr">top:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">toc:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">recommend:</span> <span class="number">1</span> </span><br><span class="line"><span class="attr">keywords:</span> <span class="string">categories-github</span></span><br><span class="line"><span class="attr">date:</span> <span class="number">2019</span><span class="number">-09</span><span class="number">-19</span> <span class="number">22</span><span class="string">:10:43</span></span><br><span class="line"><span class="attr">thumbnail:</span> <span class="string">https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20190919221611.png</span></span><br><span class="line"><span class="attr">tags:</span> <span class="string">工具教程</span></span><br><span class="line"><span class="attr">categories:</span> <span class="string">[工具教程,主题工具]</span></span><br></pre></td></tr></table></figure><h4 id="8-文章中某个代码块折叠的方法"><a href="#8-文章中某个代码块折叠的方法" class="headerlink" title="8.文章中某个代码块折叠的方法"></a>8.文章中某个代码块折叠的方法</h4><p>代码块头部加入标记 <code>&gt;folded</code>，如下代码块中使用。</p><figure class="highlight java"><figcaption><span>main.java >folded</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用示例，.md 文件中头行标记"&gt;folded"</span></span><br><span class="line"><span class="comment">// ```java main.java &gt;folded</span></span><br><span class="line"><span class="comment">// import main.java</span></span><br><span class="line"><span class="comment">// private static void main()&#123;</span></span><br><span class="line"><span class="comment">//     // test</span></span><br><span class="line"><span class="comment">//     int i = 0;</span></span><br><span class="line"><span class="comment">//     return i;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// \\```</span></span><br></pre></td></tr></table></figure><h4 id="9-加入加密文章"><a href="#9-加入加密文章" class="headerlink" title="9.加入加密文章"></a>9.加入加密文章</h4><p>如下需要加密的文章头部加入以下代码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: 2019成长记01</span><br><span class="line">top: -1</span><br><span class="line">toc: true</span><br><span class="line">keywords: categories-java</span><br><span class="line"></span><br><span class="line">#以下为文章加密信息</span><br><span class="line">encrypt: true</span><br><span class="line">password: 123456 #此处为文章密码</span><br><span class="line">abstract: 咦，这是一篇加密文章，好像需要输入密码才能查看呢！</span><br><span class="line">message: 嗨，请准确无误地输入密码查看哟！</span><br><span class="line">wrong_pass_message: 不好意思，密码没对哦，在检查检查呢！</span><br><span class="line">wrong_hash_message: 不好意思，信息无法验证！</span><br><span class="line">---</span><br></pre></td></tr></table></figure><p>注：<strong>加密文章不会出现在最新文章列表widget中，也不会出现在文章中推荐列表中，首页列表中需要设置top: -1 让它排在最后比较合理一些。</strong></p><h4 id="10-碎碎念的使用"><a href="#10-碎碎念的使用" class="headerlink" title="10.碎碎念的使用"></a>10.碎碎念的使用</h4><p>在github中，创建碎碎念issue，并且打上对应的label（<code>eg:666666</code>）对应配置中为id，填写到source/self-talking/index.md文件中如下对应位置，其余配置也要改成自己的，如clientID等。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="keyword">var</span> gitalk = <span class="keyword">new</span> Gitalk(&#123;</span><br><span class="line">        clientID: <span class="string">'46a9f3481b46ea0129d8'</span>,</span><br><span class="line">        clientSecret: <span class="string">'79c7c9cb847e141757d7864453bcbf89f0655b24'</span>,</span><br><span class="line">        id: <span class="string">'666666'</span>,</span><br><span class="line">        repo: <span class="string">'issue_database'</span>,</span><br><span class="line">        owner: <span class="string">'removeif'</span>,</span><br><span class="line">        admin: <span class="string">"removeif"</span>,</span><br><span class="line">        createIssueManually: <span class="literal">true</span>,</span><br><span class="line">        distractionFreeMode: <span class="literal">false</span></span><br><span class="line">    &#125;)</span><br><span class="line">    gitalk.render(<span class="string">'comment-container1'</span>)</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p>如下：<br><img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2020/20200119181607.png" alt="碎碎念"></p><h4 id="11-本博客样式（透明无界）"><a href="#11-本博客样式（透明无界）" class="headerlink" title="11.本博客样式（透明无界）"></a>11.本博客样式（透明无界）</h4><p>只需要放开themes/icarus/source/css/base.styl文件中以下样式代码注释即可，默认是注释的没启用</p><figure class="highlight"><figcaption><span>base.styl >folded</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">//=================本博客使用样式   start</span><br><span class="line"></span><br><span class="line">// 首页去图</span><br><span class="line"><span class="selector-class">.body_hot_comment</span> <span class="selector-class">.comment-content</span> <span class="selector-class">.card-comment-item</span> <span class="selector-class">.ava</span>, <span class="selector-class">.media-left</span>, <span class="selector-class">.is-6-widescreen</span> <span class="selector-class">.card-image</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">hover-color = #deeafb;</span><br><span class="line">// 去card</span><br><span class="line"><span class="selector-class">.card</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: unset;</span><br><span class="line">    //box-shadow: unset;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.navbar</span>, <span class="selector-tag">footer</span><span class="selector-class">.footer</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: unset;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">body</span><span class="selector-pseudo">:not(.night)</span> <span class="selector-class">.navbar</span><span class="selector-pseudo">:hover</span>,</span><br><span class="line"><span class="selector-tag">body</span><span class="selector-pseudo">:not(.night)</span> <span class="selector-class">.footer</span><span class="selector-pseudo">:hover</span>,</span><br><span class="line"><span class="selector-tag">body</span><span class="selector-pseudo">:not(.night)</span> <span class="selector-class">.card</span><span class="selector-pseudo">:hover</span>,</span><br><span class="line"><span class="selector-tag">body</span><span class="selector-pseudo">:not(.night)</span> <span class="selector-class">.pagination</span><span class="selector-pseudo">:hover</span>,</span><br><span class="line"><span class="selector-tag">body</span><span class="selector-pseudo">:not(.night)</span> <span class="selector-class">.post-navigation</span><span class="selector-pseudo">:hover</span>&#123;</span><br><span class="line">    <span class="attribute">background-color</span>: hover-color;</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">4px</span> <span class="number">10px</span> <span class="built_in">rgba</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0.05</span>),<span class="number">0</span> <span class="number">0</span> <span class="number">1px</span> <span class="built_in">rgba</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0.1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.pagination</span>, <span class="selector-class">.post-navigation</span>&#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.pagination</span> <span class="selector-class">.pagination-link</span><span class="selector-pseudo">:not(.is-current)</span>, <span class="selector-class">.pagination</span> <span class="selector-class">.pagination-previous</span>, <span class="selector-class">.pagination</span> <span class="selector-class">.pagination-next</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>:<span class="built_in">rgba</span>(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>,<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.timeline</span> <span class="selector-class">.media</span><span class="selector-pseudo">:last-child</span><span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: unset;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.footer</span> &#123;</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="number">0px</span> <span class="number">4px</span> <span class="number">10px</span> <span class="number">10px</span> <span class="built_in">rgba</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0.05</span>);</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">3rem</span> <span class="number">1.5rem</span> <span class="number">2rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">@media</span> screen <span class="keyword">and</span> (<span class="attribute">max-width:</span> <span class="number">1087px</span>)</span><br><span class="line">    .navbar-menu &#123;</span><br><span class="line">        <span class="selector-tag">background-color</span>: <span class="selector-tag">unset</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">//=================本博客使用样式   end</span><br></pre></td></tr></table></figure><p>如下：<br><img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2020/20200218084713.png" alt="无界样式"></p><h4 id="精简部分widget数据"><a href="#精简部分widget数据" class="headerlink" title="精简部分widget数据"></a>精简部分widget数据</h4><p>widget中的归档和分类和标签精简了，数据多时很丑，改为了分别展示5条和10条和20条，增加了查看全部。<br><img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2020/20200119181201.png" alt="查看全部"></p><h4 id="gitalk评论增加评论开关，评论列表中标记博主"><a href="#gitalk评论增加评论开关，评论列表中标记博主" class="headerlink" title="gitalk评论增加评论开关，评论列表中标记博主"></a>gitalk评论增加评论开关，评论列表中标记博主</h4><p>需要关闭评论的在文章头部加入 <code>comments: false</code>,原来已经评论的依然会显示，如下<br><img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2020/20200218084943.png" alt=""></p><p>原来已有博客文章的迁移，只需要把原来对应的文章放到source/_posts里即可。然后去对应文章下面创建评论issue。  </p><h4 id="以上配置好后"><a href="#以上配置好后" class="headerlink" title="以上配置好后"></a>以上配置好后</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">$</span> <span class="string">npm</span> <span class="string">install</span> <span class="comment">#安装依赖包（只需要执行一次）ps:如果是纯主题仓库，可直接把本文最后的json文件复制到博客下面的依赖文件package.json后在执行此命令</span></span><br><span class="line"><span class="string">$</span> <span class="string">hexo</span> <span class="string">clean</span> <span class="comment">#清除缓存</span></span><br><span class="line"><span class="string">$</span> <span class="string">hexo</span> <span class="string">g</span> <span class="comment">#编译 </span></span><br><span class="line"><span class="string">$</span> <span class="string">hexo</span> <span class="string">s</span> <span class="comment">#启动服务 </span></span><br><span class="line"><span class="string">$</span> <span class="string">hexo</span> <span class="string">d</span> <span class="comment">#推到远程</span></span><br></pre></td></tr></table></figure><p>安装依赖包（只需要执行一次），以后修改了代码 只需要执行后面几条就好。  </p><p>ok,enjoy it!！👏👏</p><p>有什么问题，欢迎issue里讨论。</p><h3 id="写在后面"><a href="#写在后面" class="headerlink" title="写在后面"></a>写在后面</h3><p>如果你有问题请反馈: <a href="https://github.com/removeif/hexo-theme-icarus-removeif/issues">issues</a> （请务必先于issues中寻找答案）<br>如果你喜欢该主题: <a href="https://github.com/removeif/hexo-theme-icarus-removeif">star</a><br>如果你想定制主题: <a href="https://github.com/removeif/hexo-theme-icarus-removeif">fork</a> </p><h3 id="文章中横竖图demo；对于横竖图推荐分开使用，且长宽一致的，如统一手机拍照、电脑截图"><a href="#文章中横竖图demo；对于横竖图推荐分开使用，且长宽一致的，如统一手机拍照、电脑截图" class="headerlink" title="文章中横竖图demo；对于横竖图推荐分开使用，且长宽一致的，如统一手机拍照、电脑截图"></a>文章中横竖图demo；对于横竖图推荐分开使用，且长宽一致的，如统一手机拍照、电脑截图</h3><p>使用方法：md文章中放入以下代码</p><figure class="highlight html"><figcaption><span>index.html>folded</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">+ 横竖图</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"justified-gallery"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">![张芷溪](http://wx1.sinaimg.cn/large/b5d1b710ly1g6bz7n92s7j212w0nr1kx.jpg) ![李一桐](http://wx2.sinaimg.cn/mw1024/005RAHfgly1fvfc4f19qfj33402c0qv9.jpg) ![gakki](http://wx1.sinaimg.cn/mw1024/70396e5agy1g5qe457i6yj21660ogtap.jpg) ![李一桐](http://wx1.sinaimg.cn/mw1024/005RAHfgly1fuzz17s2q3j32e43cku0x.jpg) ![彭小苒](http://wx1.sinaimg.cn/mw1024/d79c9b94ly1g1pb1uthr5j21f02iox6t.jpg)<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">+ 横图4</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"img-x"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">![v4](https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20191022182226.png) ![v3](https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20191018114126.png) ![v4](https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20191022182226.png) ![v3](https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20191018114126.png)<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">+ 竖图5</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"img-y"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">![电池](https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20191024145940.jpg) ![打王者荣耀](https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20191024141906.jpg) ![支付宝付款](https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20191024141926.jpg) ![锤子便签](https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20191024145956.jpg) ![电池](https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20191024145940.jpg)<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="效果如下（多图左右拉查看）"><a href="#效果如下（多图左右拉查看）" class="headerlink" title="效果如下（多图左右拉查看）"></a>效果如下（多图左右拉查看）</h4><ul><li>横竖图</li></ul><div class="justified-gallery"><p><img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20191128222602.jpg" alt="李庚希"> <img src="http://wx4.sinaimg.cn/mw1024/d79c9b94ly1g0pmoa18rkj23wm2lrb2e.jpg" alt="彭小苒"> <img src="http://wx1.sinaimg.cn/mw1024/d79c9b94ly1g1pb1uthr5j21f02iox6t.jpg" alt="彭小苒"> <img src="http://wx3.sinaimg.cn/mw1024/63112839gy1g423ovlwzaj234022ou0y.jpg" alt="唐艺昕"> <img src="http://wx3.sinaimg.cn/mw1024/0068cFqEgy1g5v23wwjwdj30sg0ld0vo.jpg" alt="张芷溪"> <img src="http://wx3.sinaimg.cn/mw1024/005RAHfgly1g2jhakgz41j31sc2dsx6u.jpg" alt="李一桐"> <img src="http://wx4.sinaimg.cn/large/70396e5agy1fml9habgdcg20p00hd7wz.gif" alt="gakki"></div></p><ul><li>横图4</li></ul><div class="img-x"><p><img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20191022182226.png" alt="v4"> <img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20191018114126.png" alt="v3"> <img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20191022182226.png" alt="v4"> <img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20191018114126.png" alt="v3"></div></p><ul><li>竖图5</li></ul><div class="img-y"><p><img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20191024145940.jpg" alt="电池"> <img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20191024141906.jpg" alt="打王者荣耀"> <img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20191024141926.jpg" alt="支付宝付款"> <img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20191024145956.jpg" alt="锤子便签"> <img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20191024145940.jpg" alt="电池"></div></p><h3 id="博客快照："><a href="#博客快照：" class="headerlink" title="博客快照："></a>博客快照：</h3><ul><li>主页</li></ul><div class="img-x"><p><img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20191107231051.png" alt="v5"> <img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20191022182226.png" alt="v4"> <img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20191018114126.png" alt="v3"> <img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20191014183620.png" alt="v2"> <img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20190919221347.png" alt="v1"></div></p><ul><li>深色主题<br><img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2020/20200218085241.png" alt=""></li><li>置顶<br><img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20190926210437.png" alt=""></li><li>文章评论数<br><img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20191016133335.png" alt=""></li><li>推荐文章模块<br><img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20191107131513.png" alt=""></li><li>归档<br><img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2020/20200214190807.png" alt=""></li><li>留言<br><img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20190919221820.png" alt=""></li><li>友链<br><img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2020/20200218085424.png" alt=""></li><li>美图<br><img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20190919221949.png" alt=""></li><li>影音<br><img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20190919222030.png" alt=""></li><li>关于<br><img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20190919222131.png" alt=""></li></ul><h3 id="提供hexo博客目录下依赖包-package-json"><a href="#提供hexo博客目录下依赖包-package-json" class="headerlink" title="提供hexo博客目录下依赖包 package.json"></a>提供hexo博客目录下依赖包 package.json</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"hexo-site"</span>,</span><br><span class="line">  <span class="attr">"version"</span>: <span class="string">"3.0.0"</span>,</span><br><span class="line">  <span class="attr">"private"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"build"</span>: <span class="string">"hexo generate"</span>,</span><br><span class="line">    <span class="attr">"clean"</span>: <span class="string">"hexo clean"</span>,</span><br><span class="line">    <span class="attr">"deploy"</span>: <span class="string">"hexo deploy"</span>,</span><br><span class="line">    <span class="attr">"server"</span>: <span class="string">"hexo server"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"hexo"</span>: &#123;</span><br><span class="line">    <span class="attr">"version"</span>: <span class="string">"4.2.0"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"dependencies"</span>: &#123;</span><br><span class="line">    <span class="attr">"ajv"</span>: <span class="string">"^6.10.2"</span>,</span><br><span class="line">    <span class="attr">"bulma-stylus"</span>: <span class="string">"0.8.0"</span>,</span><br><span class="line">    <span class="attr">"deepmerge"</span>: <span class="string">"^4.2.2"</span>,</span><br><span class="line">    <span class="attr">"hexo"</span>: <span class="string">"^4.2.0"</span>,</span><br><span class="line">    <span class="attr">"hexo-blog-encrypt"</span>: <span class="string">"^3.0.3"</span>,</span><br><span class="line">    <span class="attr">"hexo-deployer-git"</span>: <span class="string">"^2.1.0"</span>,</span><br><span class="line">    <span class="attr">"hexo-generator-archive"</span>: <span class="string">"^1.0.0"</span>,</span><br><span class="line">    <span class="attr">"hexo-generator-category"</span>: <span class="string">"^1.0.0"</span>,</span><br><span class="line">    <span class="attr">"hexo-generator-feed"</span>: <span class="string">"^2.2.0"</span>,</span><br><span class="line">    <span class="attr">"hexo-generator-index"</span>: <span class="string">"^1.0.0"</span>,</span><br><span class="line">    <span class="attr">"hexo-generator-tag"</span>: <span class="string">"^1.0.0"</span>,</span><br><span class="line">    <span class="attr">"hexo-log"</span>: <span class="string">"^1.0.0"</span>,</span><br><span class="line">    <span class="attr">"hexo-pagination"</span>: <span class="string">"^1.0.0"</span>,</span><br><span class="line">    <span class="attr">"hexo-renderer-ejs"</span>: <span class="string">"^1.0.0"</span>,</span><br><span class="line">    <span class="attr">"hexo-renderer-inferno"</span>: <span class="string">"^0.1.1"</span>,</span><br><span class="line">    <span class="attr">"hexo-renderer-marked"</span>: <span class="string">"^2.0.0"</span>,</span><br><span class="line">    <span class="attr">"hexo-renderer-stylus"</span>: <span class="string">"^1.1.0"</span>,</span><br><span class="line">    <span class="attr">"hexo-server"</span>: <span class="string">"^1.0.0"</span>,</span><br><span class="line">    <span class="attr">"hexo-util"</span>: <span class="string">"^1.8.0"</span>,</span><br><span class="line">    <span class="attr">"inferno"</span>: <span class="string">"^7.3.3"</span>,</span><br><span class="line">    <span class="attr">"inferno-create-element"</span>: <span class="string">"^7.3.3"</span>,</span><br><span class="line">    <span class="attr">"js-yaml"</span>: <span class="string">"^3.13.1"</span>,</span><br><span class="line">    <span class="attr">"moment"</span>: <span class="string">"^2.22.2"</span>,</span><br><span class="line">    <span class="attr">"save"</span>: <span class="string">"^2.4.0"</span>,</span><br><span class="line">    <span class="attr">"semver"</span>: <span class="string">"&gt;=5.0.0"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;写在前面&quot;&gt;&lt;a href=&quot;#写在前面&quot; class=&quot;headerlink&quot; title=&quot;写在前面&quot;&gt;&lt;/a&gt;写在前面&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;博客源码包括两个主题&lt;a href=&quot;http://github.com/ppoffice/hexo-theme-icarus&quot;&gt;icarus&lt;/a&gt;和&lt;a href=&quot;https://github.com/iissnan/hexo-theme-next&quot;&gt;next&lt;/a&gt;，在主题基础之上参照各网友博客，以及自己的一些想法做出的一些修改以及增加部分新元素。  以下是修改后的需要的部分配置，其余的配置参照&lt;a href=&quot;http://github.com/ppoffice/hexo-theme-icarus&quot;&gt;icarus主题配置&lt;/a&gt;和&lt;a href=&quot;https://github.com/iissnan/hexo-theme-next&quot;&gt;next主题配置&lt;/a&gt;。&lt;br&gt;因为修改了原作者源码，有什么问题请先联系我，不要去麻烦原作者了，能自己解决的问题就不要麻烦别人了，每个人的时间都很宝贵。&lt;br&gt;膜拜和感谢所有模块的原作者,orz👻,辛苦了。  &lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;欢迎围观：&lt;a href=&quot;https://github.com/removeif/hexo-theme-icarus-removeif.git&quot;&gt;博客+主题源码&lt;/a&gt;、&lt;a href=&quot;https://github.com/removeif/hexo-theme-amazing.git&quot;&gt;纯主题源码&lt;/a&gt;、&lt;a href=&quot;https://removeif.github.io/&quot;&gt;博主博客&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="工具教程" scheme="https://xincan.github.io/categories/%E5%B7%A5%E5%85%B7%E6%95%99%E7%A8%8B/"/>
    
      <category term="主题工具" scheme="https://xincan.github.io/categories/%E5%B7%A5%E5%85%B7%E6%95%99%E7%A8%8B/%E4%B8%BB%E9%A2%98%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="工具教程" scheme="https://xincan.github.io/tags/%E5%B7%A5%E5%85%B7%E6%95%99%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>博客图片上传picgo工具github图传使用</title>
    <link href="https://xincan.github.io/posts/9e7c733f/"/>
    <id>https://xincan.github.io/posts/9e7c733f/</id>
    <published>2020-05-26T14:02:05.000Z</published>
    <updated>2020-06-02T12:41:21.587Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>摘要<br>对于每一个写博客的人来说，图片是至关重要。这一路经历了多次图片的烦恼，之前选择了微博个人文章那里粘贴图片的方式上传，感觉也挺方便的。但是由于新浪的图片显示问题，如果header中不设置<!-- <meta name="referrer" content="no-referrer" /> 解决图片过期问题--> 标签就不能异步访问图片，导致图裂，那之恶心。然而设置之后又与网站访客统计的插件冲突，使之不能统计，真是神仙打架。无赖之下使用了PicGo工具，使用后感觉真XX方便！</p></blockquote><a id="more"></a><h2 id="PicGo工具下载安装配置"><a href="#PicGo工具下载安装配置" class="headerlink" title="PicGo工具下载安装配置"></a>PicGo工具下载安装配置</h2><h3 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h3><ul><li><p>.<a href="https://github.com/Molunerfinn/PicGo">PicGo下载</a> github网站提供三个版本的下载，MacOs、linux、windows覆盖市面上90%系统，还是很给力了。</p></li><li><p>我是mac用户，直接使用brew cask来安装PicGo: <strong>brew cask install picgo</strong>，简直方便到爆。</p></li></ul><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><ul><li><p>PicGo配置(使用github图传，免费方便，同时配合github.io博客真是方便)</p><p><img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/20190620173723.png" alt=""></p></li></ul><p>选上必填的就ok,一开始不知道token的设置，附赠token获取方法</p><p>图片上传相关的设置</p><p><img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/20190620173650.png" alt=""></p><p>链接格式：选择适合自己的，一般用户md文件中，选第一个，然后就可以疯狂使用了。</p><h3 id="使用github图传，获取token"><a href="#使用github图传，获取token" class="headerlink" title="使用github图传，获取token"></a>使用github图传，获取token</h3><p>在github-&gt;setting-&gt;developer settings 选择generate new token</p><p><img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/20190620170732.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/20190620171238.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/20190620173443.png" alt=""></p><p>勾选好之后生成就好了</p><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><ul><li><p>PicGo使用，简直方便</p><p>1).默认网页上直接右键复制图片</p><p><img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/20190620172136.png" alt=""></p><p>2).点击等待中的图片，开始上传</p><p><img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/20190620172046.png" alt=""></p><p>3).上传完之后有个提示，同时粘贴板也会自动粘贴上</p><p><img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/20190620173543.png" alt=""></p><p>4).直接粘贴到想要的地方</p><p>或者也可以直接截图，然后点击图片里的图片上传，很方便</p></li><li><p>PicGo上传动图gif</p><p>如果直接复制网页上的动图，去上传的话是截取的某帧，是静图。应该下载到本地，然后在拖进去上传就可以了。</p></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;摘要&lt;br&gt;对于每一个写博客的人来说，图片是至关重要。这一路经历了多次图片的烦恼，之前选择了微博个人文章那里粘贴图片的方式上传，感觉也挺方便的。但是由于新浪的图片显示问题，如果header中不设置&lt;!-- &lt;meta name=&quot;referrer&quot; content=&quot;no-referrer&quot; /&gt; 解决图片过期问题--&gt; 标签就不能异步访问图片，导致图裂，那之恶心。然而设置之后又与网站访客统计的插件冲突，使之不能统计，真是神仙打架。无赖之下使用了PicGo工具，使用后感觉真XX方便！&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
      <category term="工具教程" scheme="https://xincan.github.io/categories/%E5%B7%A5%E5%85%B7%E6%95%99%E7%A8%8B/"/>
    
      <category term="主题工具" scheme="https://xincan.github.io/categories/%E5%B7%A5%E5%85%B7%E6%95%99%E7%A8%8B/%E4%B8%BB%E9%A2%98%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="工具教程" scheme="https://xincan.github.io/tags/%E5%B7%A5%E5%85%B7%E6%95%99%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>github Issue 作为博客微型数据库的应用</title>
    <link href="https://xincan.github.io/posts/e7fe3cc/"/>
    <id>https://xincan.github.io/posts/e7fe3cc/</id>
    <published>2020-05-25T14:02:05.000Z</published>
    <updated>2020-06-02T12:43:56.635Z</updated>
    
    <content type="html"><![CDATA[<h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>众所周知，对于hexo框架搭建的静态博客，难免会产生一些动态的数据，比如一些碎碎念、友链、音乐、时间轴等微型数据。目前一般的做法:</p><p>a.是创建一个json数据，来存储这些微型数据，但是如果数据太多的话，一是比较慢，二是有个硬伤问题，就是json数据不能分页请求，只能一次拿完，太多的话网络带宽占用太多。</p><a id="more"></a><p>b.或者有的直接后台写一些接口服务啥的，还得在买个服务器部署上去，然后博客中访问接口。</p><p>c.或者有些可能就直接写到html中。</p><p>对于a、c方法都比较麻烦，每次更新了都要编译部署，不能很方便的动态更新。对于b的话，成本以及技术要求可能就更多一些了。</p><p>基于上面出现的问题，目前想到的一个解决方案就是，利用github 的issue作为一个微型数据库。能够很方便的动态更新，也能分页，也不需要啥json文件，想想都很方便。</p><h3 id="issue数据库使用步骤"><a href="#issue数据库使用步骤" class="headerlink" title="issue数据库使用步骤"></a>issue数据库使用步骤</h3><h4 id="issue的创建"><a href="#issue的创建" class="headerlink" title="issue的创建"></a>issue的创建</h4><p>先创建一个Repository，对于此Repository可以专门作为微型的数据库，取名issue_database。创建好之后建立一些issue</p><p>如下所示</p><p><img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20191128213154.png" alt=""></p><p>目前博客中，所有的动态数据都放到issue中了。</p><h4 id="issue中存储数据"><a href="#issue中存储数据" class="headerlink" title="issue中存储数据"></a>issue中存储数据</h4><p>对于创建好的issue，就可以往里面写数据了，比如我的友链数据为issue：blog_friends</p><p><img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20191128213427.png" alt=""></p><p>对于issue中存储的数据最好存json格式的，因为可以方便后面取出来使用。存储好数据后，如果太多的话，可以点击hide,隐藏起来。同时这个issue最好给<code>Lock conversation</code>这样的好处是，防止别人往里面加些脏数据，只能自己往里写数据。哈哈，一般也没有闲的无聊的网友恶作剧。这样就存储好数据了。</p><h4 id="博客中获取issue数据"><a href="#博客中获取issue数据" class="headerlink" title="博客中获取issue数据"></a>博客中获取issue数据</h4><p>博客中通过js获取issue中的数据，以博客友链为例，以下是获取代码，以及处理</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// author by removef</span></span><br><span class="line"><span class="comment">// https://removeif.github.io/</span></span><br><span class="line">$(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="comment">//获取处理友链数据，来自issue，一次取完</span></span><br><span class="line">    $.getJSON(<span class="string">"https://api.github.com/repos/removeif/issue_database/issues/2/comments?per_page=100&amp;client_id=46a9f3481b46ea0129d8&amp;client_secret=79c7c9cb847e141757d7864453bcbf89f0655b24"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">source</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> data = [];</span><br><span class="line">        <span class="keyword">var</span> source1;</span><br><span class="line">        source1 = source;</span><br><span class="line">      <span class="comment">// 以后每次更新的都在后面，此处倒序，按时间降序排</span></span><br><span class="line">        source1.reverse();</span><br><span class="line">      <span class="comment">// 把所有的数据放到data的列表中</span></span><br><span class="line">        $.each(source1, <span class="function"><span class="keyword">function</span> (<span class="params">i, e</span>) </span>&#123;</span><br><span class="line">            data.push(...JSON.parse(e.body));</span><br><span class="line">        &#125;);</span><br><span class="line">      </span><br><span class="line">        $.each(data, <span class="function"><span class="keyword">function</span> (<span class="params">i, e</span>) </span>&#123;</span><br><span class="line">          <span class="comment">// 博客中html文件的构建，渲染</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>上面代码中client_id、client_secret在另一篇文章中<strong><a href="https://removeif.github.io/2019/09/19/%E5%8D%9A%E5%AE%A2%E6%BA%90%E7%A0%81%E5%88%86%E4%BA%AB.html">博客源码分享</a></strong>有详细的说明,可以查看一下。这样就能获取到相应的数据，进行操作。</p><h4 id="issue数据的更新"><a href="#issue数据的更新" class="headerlink" title="issue数据的更新"></a>issue数据的更新</h4><p>比如想更新任意一项数据都可以进github中对应的仓库的issue下进行更新，添加。然后实时去博客中查看。</p><h3 id="扩展一下"><a href="#扩展一下" class="headerlink" title="扩展一下"></a>扩展一下</h3><p>对于有些爱唠叨的人（比如我），弄个类似碎碎念的东西就比较实用了。之前想过各种方案，存json数据太不方便；后台写个服务部署服务器也太麻烦。最后思来想去还是利用了下现成的优秀项目<a href="https://github.com/gitalk/gitalk">gitalk</a>,稍稍改改就能很好使用。</p><h4 id="博客中的碎碎念"><a href="#博客中的碎碎念" class="headerlink" title="博客中的碎碎念"></a>博客中的碎碎念</h4><p>对于博主而言，有发表框和修改的操作，能够方便发表和修改。</p><p><img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20191128215148.png" alt=""></p><p>可能有时候还会发表一些图片，对图片的样式做了一些控制</p><p><img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20191128215345.png" alt=""></p><p>对于网友的话只能查看以及点赞加❤️</p><p><img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20191128215555.png" alt=""></p><p>做法就是源码中改下返回html的文件内容，如果是管理员和非管理员返回一些不同的元素，能够很好的实现碎碎念的功能。<br>查看<a href="https://removeif.github.io/self-talking/">碎碎念</a>。</p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>静态博客的动态数据是个痛点，GitHub Issue有很多可利用的地方。多去探索发掘其中的奥妙。</p><p>利用GitHub Issue来解决目前也是一种解决方法。希望后面会出现更好的解决方案。</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;背景&quot;&gt;&lt;a href=&quot;#背景&quot; class=&quot;headerlink&quot; title=&quot;背景&quot;&gt;&lt;/a&gt;背景&lt;/h3&gt;&lt;p&gt;众所周知，对于hexo框架搭建的静态博客，难免会产生一些动态的数据，比如一些碎碎念、友链、音乐、时间轴等微型数据。目前一般的做法:&lt;/p&gt;
&lt;p&gt;a.是创建一个json数据，来存储这些微型数据，但是如果数据太多的话，一是比较慢，二是有个硬伤问题，就是json数据不能分页请求，只能一次拿完，太多的话网络带宽占用太多。&lt;/p&gt;
    
    </summary>
    
    
      <category term="工具教程" scheme="https://xincan.github.io/categories/%E5%B7%A5%E5%85%B7%E6%95%99%E7%A8%8B/"/>
    
      <category term="主题工具" scheme="https://xincan.github.io/categories/%E5%B7%A5%E5%85%B7%E6%95%99%E7%A8%8B/%E4%B8%BB%E9%A2%98%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="工具教程" scheme="https://xincan.github.io/tags/%E5%B7%A5%E5%85%B7%E6%95%99%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>github page网站cdn优化加速</title>
    <link href="https://xincan.github.io/posts/346ce02e/"/>
    <id>https://xincan.github.io/posts/346ce02e/</id>
    <published>2020-05-25T14:02:05.000Z</published>
    <updated>2020-06-02T12:42:22.284Z</updated>
    
    <content type="html"><![CDATA[<p>CDN的全称是Content Delivery Network，即内容分发网络。CDN是构建在网络之上的内容分发网络，依靠部署在各地的边缘服务器，通过中心平台的负载均衡、内容分发、调度等功能模块，使用户就近获取所需内容，降低网络拥塞，提高用户访问响应速度和命中率。CDN的关键技术主要有内容存储和分发技术。——百度百科</p><p>放在Github的资源在国内加载速度比较慢，因此需要使用CDN加速来优化网站打开速度，jsDelivr + Github便是免费且好用的CDN，非常适合博客网站使用。</p><a id="more"></a><h3 id="图片加速"><a href="#图片加速" class="headerlink" title="图片加速"></a>图片加速</h3><p>关于图传以及GitHub作为图库的使用方法请参考文章：<a href="https://removeif.github.io/2019/06/20/博客图片上传picgo工具github图传使用.html">博客图片上传picgo工具github图传使用</a>。</p><p>在上面参考文章的基础之上只需要修改以下配置：<strong>（指定相关cdn域名）</strong></p><p><img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20190925161709.png" alt=""></p><p>原来项目中使用了原来的方式，进行全局替换，<strong>Mac idea</strong>直接快捷键<code>command+shift+R</code>全局替换</p><p><img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20190925162235.png" alt=""></p><p><strong>【ps：题外话】</strong>原来是统一用的GitHub的仓库中的图片，通过这样替换，可以看到图片统一管理是多么的重要，多么的方便管理操作。</p><p>至此，博客中的相关图片都加上了cdn。</p><h3 id="其余资源文件"><a href="#其余资源文件" class="headerlink" title="其余资源文件"></a>其余资源文件</h3><p>用法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;gh&#x2F;你的用户名&#x2F;你的仓库名@发布的版本号&#x2F;文件路径</span><br></pre></td></tr></table></figure><p>例如：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;gh&#x2F;TRHX&#x2F;CDN-for-itrhx.com@1.0&#x2F;images&#x2F;trhx.png</span><br><span class="line">https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;gh&#x2F;TRHX&#x2F;CDN-for-itrhx.com@2.0.1&#x2F;css&#x2F;style.css</span><br><span class="line">https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;gh&#x2F;moezx&#x2F;cdn@3.1.3&#x2F;&#x2F;The%20Pet%20Girl%20of%20Sakurasou.mp4</span><br></pre></td></tr></table></figure><p>注意：版本号不是必需的，是为了区分新旧资源，如果不使用版本号，将会直接引用最新资源，除此之外还可以使用某个范围内的版本，查看所有资源等，具体使用方法如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 加载任何Github发布、提交或分支</span><br><span class="line">https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;gh&#x2F;user&#x2F;repo@version&#x2F;file</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 加载 jQuery v3.2.1</span><br><span class="line">https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;gh&#x2F;jquery&#x2F;jquery@3.2.1&#x2F;dist&#x2F;jquery.min.js</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 使用版本范围而不是特定版本</span><br><span class="line">https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;gh&#x2F;jquery&#x2F;jquery@3.2&#x2F;dist&#x2F;jquery.min.js</span><br><span class="line">https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;gh&#x2F;jquery&#x2F;jquery@3&#x2F;dist&#x2F;jquery.min.js</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 完全省略该版本以获取最新版本</span><br><span class="line">https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;gh&#x2F;jquery&#x2F;jquery&#x2F;dist&#x2F;jquery.min.js</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 将“.min”添加到任何JS&#x2F;CSS文件中以获取缩小版本，如果不存在，将为会自动生成</span><br><span class="line">https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;gh&#x2F;jquery&#x2F;jquery@3.2.1&#x2F;src&#x2F;core.min.js</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 在末尾添加 &#x2F; 以获取资源目录列表</span><br><span class="line">https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;gh&#x2F;jquery&#x2F;jquery&#x2F;</span><br></pre></td></tr></table></figure><p>至此，github page 博客基本需要加速的完成。</p><p>参考文章:<br><a href="https://blog.csdn.net/qq_36759224/article/details/86936453">参考链接1</a><br><a href="https://blog.csdn.net/qq_36759224/article/details/98058240">参考链接2</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;CDN的全称是Content Delivery Network，即内容分发网络。CDN是构建在网络之上的内容分发网络，依靠部署在各地的边缘服务器，通过中心平台的负载均衡、内容分发、调度等功能模块，使用户就近获取所需内容，降低网络拥塞，提高用户访问响应速度和命中率。CDN的关键技术主要有内容存储和分发技术。——百度百科&lt;/p&gt;
&lt;p&gt;放在Github的资源在国内加载速度比较慢，因此需要使用CDN加速来优化网站打开速度，jsDelivr + Github便是免费且好用的CDN，非常适合博客网站使用。&lt;/p&gt;
    
    </summary>
    
    
      <category term="工具教程" scheme="https://xincan.github.io/categories/%E5%B7%A5%E5%85%B7%E6%95%99%E7%A8%8B/"/>
    
      <category term="主题工具" scheme="https://xincan.github.io/categories/%E5%B7%A5%E5%85%B7%E6%95%99%E7%A8%8B/%E4%B8%BB%E9%A2%98%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="工具教程" scheme="https://xincan.github.io/tags/%E5%B7%A5%E5%85%B7%E6%95%99%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>博客换肤的一种实现方式思路</title>
    <link href="https://xincan.github.io/posts/1c5449cf/"/>
    <id>https://xincan.github.io/posts/1c5449cf/</id>
    <published>2020-05-25T14:02:05.000Z</published>
    <updated>2020-06-02T12:41:42.732Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>当博客内容很多的时候，比如需要加载很多资源文件，许多炫酷的东西的时候，可能相应的就是比较慢了（正可谓时间和空间不能兼得）。虽然目前也有很多方式手段可以提高访问速度，但是博客提供一个简洁模式还是很有必要的，萝卜青菜，各有所爱嘛。说不定很多网友就当纯的想看看文字，不需要那些花里胡哨的东西。这时候提供个清爽模式就相当有用了。</p></blockquote><a id="more"></a><h3 id="正常模式和精简模式"><a href="#正常模式和精简模式" class="headerlink" title="正常模式和精简模式"></a>正常模式和精简模式</h3><p><code>hexo框架2仓2主题</code>，采用正常模式一个仓库，一个主题；精简模式另一个仓库，另一个主题。</p><p>本博客采用的github Page部署网站。大家都知道，一个github的账户名，只能够指定一个<code>username.github.io</code>的网址，所以两个仓库，两个主题的话，就必须有一个挂在<code>username.github.io</code>之上，比如正常模式<code>username.github.io</code>，精简模式为<code>username.github.io/name.io</code>。</p><h4 id="正常模式"><a href="#正常模式" class="headerlink" title="正常模式"></a>正常模式</h4><p>正常模式里面可以放各种炫酷的东西，提供丰富的页面。</p><h4 id="精简模式"><a href="#精简模式" class="headerlink" title="精简模式"></a>精简模式</h4><p>只提供必要的文章，归档，分类，搜索基本的东西就够了。看个人需要，既然要简洁，就尽量的少弄一些。</p><h3 id="配置方法"><a href="#配置方法" class="headerlink" title="配置方法"></a>配置方法</h3><p>关于<strong>_config.yml</strong>主配置文件的注意事项。</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="addition">+ root: /remove.io/ #精简模式</span></span><br><span class="line"><span class="deletion">- root: /  #正常模式</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">deploy:</span><br><span class="line">  type: git</span><br><span class="line"><span class="addition">+ repo: https://github.com/removeif/remove.io.git  #精简模式</span></span><br><span class="line"><span class="deletion">- repo: https://github.com/removeif/removeif.github.io.git  #正常模式</span></span><br><span class="line"></span><br><span class="line"><span class="addition">+ theme: icarus #正常模式</span></span><br><span class="line"><span class="deletion">- theme: nextn #精简模式</span></span><br></pre></td></tr></table></figure><p>对于root 根节点的说明，因为精简模式的所有资源文件都是挂在 username.github.io/remove.io/ 所以相当于根节点为/remove.io/ </p><h3 id="总结注意事项"><a href="#总结注意事项" class="headerlink" title="总结注意事项"></a>总结注意事项</h3><ul><li>对于页面中对于对应模式下资源文件的引用，一定加上域名地址 ，比如原来图片访问<code>/image/tuizi.jpg</code>，在精简模式的时候如果继续这样用，就找不到，对应模式下的图片了，需要加上前面的<code>username.github.io/remove.io/</code> 地址。</li><li>对于精简模式下，能去掉的东西就尽量去掉，尽量少加载一些，速度更快。</li><li>对于冲突页面的处理，一般对于文章或者关于页面都是通用。文章一般没啥影响，但是关于页面，可能有些也有很炫酷的模块。对于精简模式，可能不需要，此时就需要多new 一个page页面，分开配置，比如下面主题中的<code>_config.yml</code>配置。</li></ul><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="addition">+ /remove.io/abouta/ #精简模式</span></span><br><span class="line"><span class="deletion">- /abouta/ #正常模式</span></span><br></pre></td></tr></table></figure><p>本博客<a href="https://removeif.github.io/">正常模式</a></p><p><img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20190917190717.png" alt=""></p><p><a href="https://removeif.github.io/remove.io/">精简模式</a></p><p><img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20190917190818.png" alt=""></p><p>以上只是提供了一种解决方法思路，肯定还有更好的方式。</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;当博客内容很多的时候，比如需要加载很多资源文件，许多炫酷的东西的时候，可能相应的就是比较慢了（正可谓时间和空间不能兼得）。虽然目前也有很多方式手段可以提高访问速度，但是博客提供一个简洁模式还是很有必要的，萝卜青菜，各有所爱嘛。说不定很多网友就当纯的想看看文字，不需要那些花里胡哨的东西。这时候提供个清爽模式就相当有用了。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
      <category term="工具教程" scheme="https://xincan.github.io/categories/%E5%B7%A5%E5%85%B7%E6%95%99%E7%A8%8B/"/>
    
      <category term="主题工具" scheme="https://xincan.github.io/categories/%E5%B7%A5%E5%85%B7%E6%95%99%E7%A8%8B/%E4%B8%BB%E9%A2%98%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="工具教程" scheme="https://xincan.github.io/tags/%E5%B7%A5%E5%85%B7%E6%95%99%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>安装、部分配置icarus主题中文版</title>
    <link href="https://xincan.github.io/posts/52c38f29/"/>
    <id>https://xincan.github.io/posts/52c38f29/</id>
    <published>2020-05-25T14:02:05.000Z</published>
    <updated>2020-06-02T12:43:53.251Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>摘要<br>发现icarus主题还不错，花了一两个小时研究了下安装、部分配置icarus主题中文版</p></blockquote><a id="more"></a><h2 id="安装icarus"><a href="#安装icarus" class="headerlink" title="安装icarus"></a>安装icarus</h2><ul><li>直接下载主题模块放到blog项目 ,blog项目根目录执行</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https:<span class="comment">//github.com/ppoffice/hexo-theme-icarus.git themes/icarus</span></span><br></pre></td></tr></table></figure><p>此时已经下载到项目中。</p><ul><li><p>顶级_config.yml中选择<code>icarus</code>主题</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># Extensions</span><br><span class="line">## Plugins: https://hexo.io/plugins/</span><br><span class="line">## Themes: https://hexo.io/themes/</span><br><span class="line">theme: icarus</span><br></pre></td></tr></table></figure></li><li><p>此时主题已经安装好，清除、编译、部署可以看到效果了</p><p><img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/20190620160640.png" alt=""></p></li></ul><h2 id="配置icarus"><a href="#配置icarus" class="headerlink" title="配置icarus"></a>配置icarus</h2><ul><li>完全参照<a href="https://blog.zhangruipeng.me/hexo-theme-icarus/categories/Configuration/Posts/">官网</a>配置，进行翻译解说</li></ul><h3 id="配置文章部分"><a href="#配置文章部分" class="headerlink" title="配置文章部分"></a>配置文章部分</h3><h4 id="顶部图片添加"><a href="#顶部图片添加" class="headerlink" title="顶部图片添加"></a>顶部图片添加</h4><p>icarus 主题中的配置_config.yml中开启图片开关</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">article:</span><br><span class="line">    thumbnail: <span class="keyword">true</span></span><br></pre></td></tr></table></figure><p>文章.md文件头中添加图片绝对/相对地址</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">title: Getting Started with Icarus</span><br><span class="line">thumbnail: /gallery/thumbnails/desert.jpg</span><br><span class="line"><span class="comment">// thumbnail:https://cdn.jsdelivr.net/gh/removeif/blog_image/20190620152744.png</span></span><br><span class="line">---</span><br><span class="line">Post content...</span><br></pre></td></tr></table></figure><p>配置完成后部署显示效果如下(最新文章列表显示缩略图、文章开头显示一张设置图片)</p><p><img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/20190620160657.png" alt=""></p><h4 id="左边文章导航栏开启"><a href="#左边文章导航栏开启" class="headerlink" title="左边文章导航栏开启"></a>左边文章导航栏开启</h4><p>icarus 主题中的配置_config.yml中开关</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">widgets:</span><br><span class="line">    -</span><br><span class="line">        type: toc</span><br><span class="line">        position: left</span><br></pre></td></tr></table></figure><p>同事文章顶部加入标签</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">title: Table of Contents Example</span><br><span class="line">toc: <span class="keyword">true</span></span><br><span class="line">---</span><br><span class="line">Post content...</span><br></pre></td></tr></table></figure><p>配置效果</p><p><img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/20190620160721.png" alt=""></p><h5 id="评论系统开启"><a href="#评论系统开启" class="headerlink" title="评论系统开启"></a>评论系统开启</h5><p>icarus 主题中的配置_config.yml中开启（部分评论系统需要翻墙才能使用，valine不用翻墙个人推荐，<a href="https://valine.js.org/quickstart.html">valine安装参考</a>）</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">comment:</span><br><span class="line">    type: valine</span><br><span class="line">    app_id: xxxxxxxx        # (required) LeanCloud application id</span><br><span class="line">    app_key: xxxxxxxx       # (required) LeanCloud application key</span><br><span class="line">    notify: false           # (optional) receive email notification</span><br><span class="line">    verify: false           # (optional) show verification code</span><br><span class="line">    placeholder: xxxxxxxx   # (optional) comment box placeholder text</span><br></pre></td></tr></table></figure><p>开启效果</p><p><img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/20190620160740.png" alt=""></p><h4 id="捐赠收款开启"><a href="#捐赠收款开启" class="headerlink" title="捐赠收款开启"></a>捐赠收款开启</h4><p>icarus 主题中的配置_config.yml中开启 注意如果默认不配置，编译时有报错，可以# 把它注释掉，不启用功能 </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">donate:</span><br><span class="line">    -</span><br><span class="line">        # Donation entry name</span><br><span class="line">        type: alipay</span><br><span class="line">        # Qrcode image URL</span><br><span class="line">        qrcode: <span class="string">'https://wx2.sinaimg.cn/large/b5d1b710gy1g0lvxdcwm0j20p011i4bg.jpg'</span> </span><br><span class="line">    -</span><br><span class="line">        # Donation entry name</span><br><span class="line">        type: wechat</span><br><span class="line">        # Qrcode image URL</span><br><span class="line">        qrcode: <span class="string">'https://wx2.sinaimg.cn/large/b5d1b710gy1g0lvwdcpb5j20u014qgy2.jpg'</span></span><br></pre></td></tr></table></figure><p>开启配置效果如下</p><p><img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/20190620160805.png" alt=""></p><h3 id="全局搜索开启"><a href="#全局搜索开启" class="headerlink" title="全局搜索开启"></a>全局搜索开启</h3><p>icarus 主题中的配置_config.yml中开启,不同的搜索类型需要<a href="https://blog.zhangruipeng.me/hexo-theme-icarus/categories/Plugins/Search/">安装插件参考官网</a>,type: insight此类型不需要安装，已经内置</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">search:</span><br><span class="line">    type: insight</span><br></pre></td></tr></table></figure><p>效果如下</p><p><img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/20190620161155.png" alt=""></p><h3 id="更多配置请参考官网配置"><a href="#更多配置请参考官网配置" class="headerlink" title="更多配置请参考官网配置"></a>更多配置请参考官网配置</h3><p>目前配置基本已经够使用，还需要更多配置请参考<a href="https://blog.zhangruipeng.me/hexo-theme-icarus/categories/Configuration/Posts/">连接</a></p><p><a href="https://blog.zhangruipeng.me/hexo-theme-icarus/categories/Configuration/Posts/">参考自</a></p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;摘要&lt;br&gt;发现icarus主题还不错，花了一两个小时研究了下安装、部分配置icarus主题中文版&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
      <category term="工具教程" scheme="https://xincan.github.io/categories/%E5%B7%A5%E5%85%B7%E6%95%99%E7%A8%8B/"/>
    
      <category term="主题工具" scheme="https://xincan.github.io/categories/%E5%B7%A5%E5%85%B7%E6%95%99%E7%A8%8B/%E4%B8%BB%E9%A2%98%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="icarus主题配置" scheme="https://xincan.github.io/tags/icarus%E4%B8%BB%E9%A2%98%E9%85%8D%E7%BD%AE/"/>
    
      <category term="hexo主题" scheme="https://xincan.github.io/tags/hexo%E4%B8%BB%E9%A2%98/"/>
    
  </entry>
  
</feed>
